!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("crypto"),require("buffer")):"function"==typeof define&&define.amd?define(["crypto","buffer"],r):(t=t||self)["@wonderlandlabs/mirror"]=r(t.crypto,t.buffer)}(this,(function(t,r){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var n=function(t,r){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])})(t,r)};function o(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function e(){this.constructor=t}n(t,r),t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)}function i(t){var r="function"==typeof Symbol&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(t,r){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var n,o,i=e.call(t),a=[];try{for(;(void 0===r||r-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return a}function u(t,r){for(var e=0,n=r.length,o=t.length;e<n;e++,o++)t[o]=r[e];return t}function s(t){return"function"==typeof t}function c(t){var r=t((function(t){Error.call(t),t.stack=(new Error).stack}));return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var f=c((function(t){return function(r){t(this),this.message=r?r.length+" errors occurred during unsubscription:\n"+r.map((function(t,r){return r+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=r}}));function l(t,r){if(t){var e=t.indexOf(r);0<=e&&t.splice(e,1)}}var h=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}var r;return t.prototype.unsubscribe=function(){var t,r,e,n,o;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var l=i(c),h=l.next();!h.done;h=l.next()){h.value.remove(this)}}catch(r){t={error:r}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}else c.remove(this);var p=this.initialTeardown;if(s(p))try{p()}catch(t){o=t instanceof f?t.errors:[t]}var d=this._teardowns;if(d){this._teardowns=null;try{for(var y=i(d),b=y.next();!b.done;b=y.next()){var _=b.value;try{v(_)}catch(t){o=null!=o?o:[],t instanceof f?o=u(u([],a(o)),a(t.errors)):o.push(t)}}}catch(t){e={error:t}}finally{try{b&&!b.done&&(n=y.return)&&n.call(y)}finally{if(e)throw e.error}}}if(o)throw new f(o)}},t.prototype.add=function(r){var e;if(r&&r!==this)if(this.closed)v(r);else{if(r instanceof t){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._teardowns=null!==(e=this._teardowns)&&void 0!==e?e:[]).push(r)}},t.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},t.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},t.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&l(r,t)},t.prototype.remove=function(r){var e=this._teardowns;e&&l(e,r),r instanceof t&&r._removeParent(this)},t.EMPTY=((r=new t).closed=!0,r),t}(),p=h.EMPTY;function d(t){return t instanceof h||t&&"closed"in t&&s(t.remove)&&s(t.add)&&s(t.unsubscribe)}function v(t){s(t)?t():t.unsubscribe()}var y={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},b={setTimeout:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var e=b.delegate;return((null==e?void 0:e.setTimeout)||setTimeout).apply(void 0,u([],a(t)))},clearTimeout:function(t){var r=b.delegate;return((null==r?void 0:r.clearTimeout)||clearTimeout)(t)},delegate:void 0};function _(t){b.setTimeout((function(){throw t}))}function g(){}function m(t){t()}var $=function(t){function r(r){var e=t.call(this)||this;return e.isStopped=!1,r?(e.destination=r,d(r)&&r.add(e)):e.destination=O,e}return o(r,t),r.create=function(t,r,e){return new w(t,r,e)},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},r.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},r}(h),w=function(t){function r(r,e,n){var o,i=t.call(this)||this;if(s(r))o=r;else if(r){var a;o=r.next,e=r.error,n=r.complete,i&&y.useDeprecatedNextContext?(a=Object.create(r)).unsubscribe=function(){return i.unsubscribe()}:a=r,o=null==o?void 0:o.bind(a),e=null==e?void 0:e.bind(a),n=null==n?void 0:n.bind(a)}return i.destination={next:o?E(o):g,error:E(null!=e?e:j),complete:n?E(n):g},i}return o(r,t),r}($);function E(t,r){return function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];try{t.apply(void 0,u([],a(r)))}catch(t){_(t)}}}function j(t){throw t}var O={closed:!0,next:g,error:j,complete:g},S="function"==typeof Symbol&&Symbol.observable||"@@observable";function P(t){return t}function A(t){return 0===t.length?P:1===t.length?t[0]:function(r){return t.reduce((function(t,r){return r(t)}),r)}}var x=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(r){var e=new t;return e.source=this,e.operator=r,e},t.prototype.subscribe=function(t,r,e){var n,o=this,i=(n=t)&&n instanceof $||function(t){return t&&s(t.next)&&s(t.error)&&s(t.complete)}(n)&&d(n)?t:new w(t,r,e);return m((function(){var t=o,r=t.operator,e=t.source;i.add(r?r.call(i,e):e?o._subscribe(i):o._trySubscribe(i))})),i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},t.prototype.forEach=function(t,r){var e=this;return new(r=T(r))((function(r,n){var o;o=e.subscribe((function(r){try{t(r)}catch(t){n(t),null==o||o.unsubscribe()}}),n,r)}))},t.prototype._subscribe=function(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)},t.prototype[S]=function(){return this},t.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return A(t)(this)},t.prototype.toPromise=function(t){var r=this;return new(t=T(t))((function(t,e){var n;r.subscribe((function(t){return n=t}),(function(t){return e(t)}),(function(){return t(n)}))}))},t.create=function(r){return new t(r)},t}();function T(t){var r;return null!==(r=null!=t?t:y.Promise)&&void 0!==r?r:Promise}function C(t){return function(r){if(function(t){return s(null==t?void 0:t.lift)}(r))return r.lift((function(r){try{return t(r,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}var k=function(t){function r(r,e,n,o,i){var a=t.call(this,r)||this;return a.onFinalize=i,a._next=e?function(t){try{e(t)}catch(t){r.error(t)}}:t.prototype._next,a._error=o?function(t){try{o(t)}catch(t){r.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=n?function(){try{n()}catch(t){r.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return o(r,t),r.prototype.unsubscribe=function(){var r,e=this.closed;t.prototype.unsubscribe.call(this),!e&&(null===(r=this.onFinalize)||void 0===r||r.call(this))},r}($),I=c((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),N=function(t){function r(){var r=t.call(this)||this;return r.closed=!1,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return o(r,t),r.prototype.lift=function(t){var r=new D(this,this);return r.operator=t,r},r.prototype._throwIfClosed=function(){if(this.closed)throw new I},r.prototype.next=function(t){var r=this;m((function(){var e,n;if(r._throwIfClosed(),!r.isStopped){var o=r.observers.slice();try{for(var a=i(o),u=a.next();!u.done;u=a.next()){u.value.next(t)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}}))},r.prototype.error=function(t){var r=this;m((function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var e=r.observers;e.length;)e.shift().error(t)}}))},r.prototype.complete=function(){var t=this;m((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}}))},r.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(r.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),r.prototype._trySubscribe=function(r){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,r)},r.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},r.prototype._innerSubscribe=function(t){var r=this.hasError,e=this.isStopped,n=this.observers;return r||e?p:(n.push(t),new h((function(){return l(n,t)})))},r.prototype._checkFinalizedStatuses=function(t){var r=this.hasError,e=this.thrownError,n=this.isStopped;r?t.error(e):n&&t.complete()},r.prototype.asObservable=function(){var t=new x;return t.source=this,t},r.create=function(t,r){return new D(t,r)},r}(x),D=function(t){function r(r,e){var n=t.call(this)||this;return n.destination=r,n.source=e,n}return o(r,t),r.prototype.next=function(t){var r,e;null===(e=null===(r=this.destination)||void 0===r?void 0:r.next)||void 0===e||e.call(r,t)},r.prototype.error=function(t){var r,e;null===(e=null===(r=this.destination)||void 0===r?void 0:r.error)||void 0===e||e.call(r,t)},r.prototype.complete=function(){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===r||r.call(t)},r.prototype._subscribe=function(t){var r,e;return null!==(e=null===(r=this.source)||void 0===r?void 0:r.subscribe(t))&&void 0!==e?e:p},r}(N),M=function(t){function r(r){var e=t.call(this)||this;return e._value=r,e}return o(r,t),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),r.prototype._subscribe=function(r){var e=t.prototype._subscribe.call(this,r);return!e.closed&&r.next(this._value),e},r.prototype.getValue=function(){var t=this.hasError,r=this.thrownError,e=this._value;if(t)throw r;return this._throwIfClosed(),e},r.prototype.next=function(r){t.prototype.next.call(this,this._value=r)},r}(N);const z=new Uint8Array(256);let B=z.length;function F(){return B>z.length-16&&(t.randomFillSync(z),B=0),z.slice(B,B+=16)}var V=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function R(t){return"string"==typeof t&&V.test(t)}const U=[];for(let t=0;t<256;++t)U.push((t+256).toString(16).substr(1));function L(t,r=0){const e=(U[t[r+0]]+U[t[r+1]]+U[t[r+2]]+U[t[r+3]]+"-"+U[t[r+4]]+U[t[r+5]]+"-"+U[t[r+6]]+U[t[r+7]]+"-"+U[t[r+8]]+U[t[r+9]]+"-"+U[t[r+10]]+U[t[r+11]]+U[t[r+12]]+U[t[r+13]]+U[t[r+14]]+U[t[r+15]]).toLowerCase();if(!R(e))throw TypeError("Stringified UUID is invalid");return e}let Y,q,K=0,W=0;function G(t){if(!R(t))throw TypeError("Invalid UUID");let r;const e=new Uint8Array(16);return e[0]=(r=parseInt(t.slice(0,8),16))>>>24,e[1]=r>>>16&255,e[2]=r>>>8&255,e[3]=255&r,e[4]=(r=parseInt(t.slice(9,13),16))>>>8,e[5]=255&r,e[6]=(r=parseInt(t.slice(14,18),16))>>>8,e[7]=255&r,e[8]=(r=parseInt(t.slice(19,23),16))>>>8,e[9]=255&r,e[10]=(r=parseInt(t.slice(24,36),16))/1099511627776&255,e[11]=r/4294967296&255,e[12]=r>>>24&255,e[13]=r>>>16&255,e[14]=r>>>8&255,e[15]=255&r,e}function H(t,r,e){function n(t,n,o,i){if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));const r=[];for(let e=0;e<t.length;++e)r.push(t.charCodeAt(e));return r}(t)),"string"==typeof n&&(n=G(n)),16!==n.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let a=new Uint8Array(16+t.length);if(a.set(n),a.set(t,n.length),a=e(a),a[6]=15&a[6]|r,a[8]=63&a[8]|128,o){i=i||0;for(let t=0;t<16;++t)o[i+t]=a[t];return o}return L(a)}try{n.name=t}catch(t){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n}const J=H("v3",48,(function(r){return Array.isArray(r)?r=Buffer.from(r):"string"==typeof r&&(r=Buffer.from(r,"utf8")),t.createHash("md5").update(r).digest()}));const X=H("v5",80,(function(r){return Array.isArray(r)?r=Buffer.from(r):"string"==typeof r&&(r=Buffer.from(r,"utf8")),t.createHash("sha1").update(r).digest()}));for(var Q=Object.freeze({__proto__:null,v1:function(t,r,e){let n=r&&e||0;const o=r||new Array(16);let i=(t=t||{}).node||Y,a=void 0!==t.clockseq?t.clockseq:q;if(null==i||null==a){const r=t.random||(t.rng||F)();null==i&&(i=Y=[1|r[0],r[1],r[2],r[3],r[4],r[5]]),null==a&&(a=q=16383&(r[6]<<8|r[7]))}let u=void 0!==t.msecs?t.msecs:Date.now(),s=void 0!==t.nsecs?t.nsecs:W+1;const c=u-K+(s-W)/1e4;if(c<0&&void 0===t.clockseq&&(a=a+1&16383),(c<0||u>K)&&void 0===t.nsecs&&(s=0),s>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");K=u,W=s,q=a,u+=122192928e5;const f=(1e4*(268435455&u)+s)%4294967296;o[n++]=f>>>24&255,o[n++]=f>>>16&255,o[n++]=f>>>8&255,o[n++]=255&f;const l=u/4294967296*1e4&268435455;o[n++]=l>>>8&255,o[n++]=255&l,o[n++]=l>>>24&15|16,o[n++]=l>>>16&255,o[n++]=a>>>8|128,o[n++]=255&a;for(let t=0;t<6;++t)o[n+t]=i[t];return r||L(o)},v3:J,v4:function(t,r,e){const n=(t=t||{}).random||(t.rng||F)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,r){e=e||0;for(let t=0;t<16;++t)r[e+t]=n[t];return r}return L(n)},v5:X,NIL:"00000000-0000-0000-0000-000000000000",version:function(t){if(!R(t))throw TypeError("Invalid UUID");return parseInt(t.substr(14,1),16)},validate:R,stringify:L,parse:G}),Z="function"==typeof t.randomUUID?t.randomUUID:Q.v4,tt=[],rt={},et=0;et<256;et++)tt[et]=(et+256).toString(16).substr(1),rt[tt[et]]=et;var nt={parse:function(t,r,e){var n=r&&e||0,o=0;for(r=r||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,(function(t){o<16&&(r[n+o++]=rt[t])}));o<16;)r[n+o++]=0;return r},unparse:function(t,r){var e=r||0,n=tt;return n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+"-"+n[t[e++]]+n[t[e++]]+"-"+n[t[e++]]+n[t[e++]]+"-"+n[t[e++]]+n[t[e++]]+"-"+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]+n[t[e++]]}};const ot=Math.pow(2,31)-1,it=r.Buffer;function at(t,r){let e=it.from(nt.parse(t)).toString("base64");const n=e.length;return r?("="===e[n-2]&&"="===e[n-1]&&(e=e.substr(0,n-2)+"-"),e.replace(/\+/g,"_").replace(/\//g,"-")):"="===e[n-2]&&"="===e[n-1]?e.substr(0,n-2)+"/":e}function ut(t,r){!!(r=r||{}).urlSafe&&(t=t.replace(/-/g,"/").replace(/_/g,"+"));const e=t.lastIndexOf("/");if(-1===e)return null;const n=t.substring(0,e),o=Number(t.substring(e+1));if(!n||isNaN(o))return null;return{uuid:nt.unparse(it.from(n+"==","base64")),count:o}}var st=function(t){let r=!1,e=!1;"boolean"==typeof t?r=t:(e=!!(t=t||{}).urlSafe,r=!!t.fixedLength),i.uuid=Z(),i.decode=ut;let n=at(i.uuid,e),o=Math.floor(t.startFrom||0);if(isNaN(o)||!(ot>o&&o>=0))throw new Error([`when passed, opts.startFrom must be a number between 0 and ${ot}.`,"Only the integer part matters.","- got: "+t.startFrom].join("\n"));return i;function i(){const t=r?n+function(t){return t<10?"000000000"+t:t<100?"00000000"+t:t<1e3?"0000000"+t:t<1e4?"000000"+t:t<1e5?"00000"+t:t<1e6?"0000"+t:t<1e7?"000"+t:t<1e8?"00"+t:t<1e9?"0"+t:t}(o++):n+o++;return o===ot&&(i.uuid=Z(),n=at(i.uuid,e),o=0),t}},ct=ut;st.decode=ct;const ft=st();function lt(){return ft()}var ht=Object.freeze({__proto__:null,default:lt});function pt(t){for(var r=arguments.length,e=Array(r>1?r-1:0),n=1;n<r;n++)e[n-1]=arguments[n];if("production"!==process.env.NODE_ENV){var o=tr[t],i=o?"function"==typeof o?o.apply(null,e):o:"unknown error nr: "+t;throw Error("[Immer] "+i)}throw Error("[Immer] minified error nr: "+t+(e.length?" "+e.map((function(t){return"'"+t+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function dt(t){return!!t&&!!t[Zt]}function vt(t){return!!t&&(function(t){if(!t||"object"!=typeof t)return!1;var r=Object.getPrototypeOf(t);if(null===r)return!0;var e=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return e===Object||"function"==typeof e&&Function.toString.call(e)===rr}(t)||Array.isArray(t)||!!t[Qt]||!!t.constructor[Qt]||mt(t)||$t(t))}function yt(t,r,e){void 0===e&&(e=!1),0===bt(t)?(e?Object.keys:er)(t).forEach((function(n){e&&"symbol"==typeof n||r(n,t[n],t)})):t.forEach((function(e,n){return r(n,e,t)}))}function bt(t){var r=t[Zt];return r?r.i>3?r.i-4:r.i:Array.isArray(t)?1:mt(t)?2:$t(t)?3:0}function _t(t,r){return 2===bt(t)?t.has(r):Object.prototype.hasOwnProperty.call(t,r)}function gt(t,r,e){var n=bt(t);2===n?t.set(r,e):3===n?(t.delete(r),t.add(e)):t[r]=e}function mt(t){return Gt&&t instanceof Map}function $t(t){return Ht&&t instanceof Set}function wt(t){return t.o||t.t}function Et(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var r=nr(t);delete r[Zt];for(var e=er(r),n=0;n<e.length;n++){var o=e[n],i=r[o];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(r[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:t[o]})}return Object.create(Object.getPrototypeOf(t),r)}function jt(t,r){return void 0===r&&(r=!1),St(t)||dt(t)||!vt(t)||(bt(t)>1&&(t.set=t.add=t.clear=t.delete=Ot),Object.freeze(t),r&&yt(t,(function(t,r){return jt(r,!0)}),!0)),t}function Ot(){pt(2)}function St(t){return null==t||"object"!=typeof t||Object.isFrozen(t)}function Pt(t){var r=or[t];return r||pt(18,t),r}function At(){return"production"===process.env.NODE_ENV||Kt||pt(0),Kt}function xt(t,r){r&&(Pt("Patches"),t.u=[],t.s=[],t.v=r)}function Tt(t){Ct(t),t.p.forEach(It),t.p=null}function Ct(t){t===Kt&&(Kt=t.l)}function kt(t){return Kt={p:[],l:Kt,h:t,m:!0,_:0}}function It(t){var r=t[Zt];0===r.i||1===r.i?r.j():r.O=!0}function Nt(t,r){r._=r.p.length;var e=r.p[0],n=void 0!==t&&t!==e;return r.h.g||Pt("ES5").S(r,t,n),n?(e[Zt].P&&(Tt(r),pt(4)),vt(t)&&(t=Dt(r,t),r.l||zt(r,t)),r.u&&Pt("Patches").M(e[Zt],t,r.u,r.s)):t=Dt(r,e,[]),Tt(r),r.u&&r.v(r.u,r.s),t!==Xt?t:void 0}function Dt(t,r,e){if(St(r))return r;var n=r[Zt];if(!n)return yt(r,(function(o,i){return Mt(t,n,r,o,i,e)}),!0),r;if(n.A!==t)return r;if(!n.P)return zt(t,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var o=4===n.i||5===n.i?n.o=Et(n.k):n.o;yt(3===n.i?new Set(o):o,(function(r,i){return Mt(t,n,o,r,i,e)})),zt(t,o,!1),e&&t.u&&Pt("Patches").R(n,e,t.u,t.s)}return n.o}function Mt(t,r,e,n,o,i){if("production"!==process.env.NODE_ENV&&o===e&&pt(5),dt(o)){var a=Dt(t,o,i&&r&&3!==r.i&&!_t(r.D,n)?i.concat(n):void 0);if(gt(e,n,a),!dt(a))return;t.m=!1}if(vt(o)&&!St(o)){if(!t.h.F&&t._<1)return;Dt(t,o),r&&r.A.l||zt(t,o)}}function zt(t,r,e){void 0===e&&(e=!1),t.h.F&&t.m&&jt(r,e)}function Bt(t,r){var e=t[Zt];return(e?wt(e):t)[r]}function Ft(t,r){if(r in t)for(var e=Object.getPrototypeOf(t);e;){var n=Object.getOwnPropertyDescriptor(e,r);if(n)return n;e=Object.getPrototypeOf(e)}}function Vt(t){t.P||(t.P=!0,t.l&&Vt(t.l))}function Rt(t){t.o||(t.o=Et(t.t))}function Ut(t,r,e){var n=mt(r)?Pt("MapSet").N(r,e):$t(r)?Pt("MapSet").T(r,e):t.g?function(t,r){var e=Array.isArray(t),n={i:e?1:0,A:r?r.A:At(),P:!1,I:!1,D:{},l:r,t:t,k:null,o:null,j:null,C:!1},o=n,i=ir;e&&(o=[n],i=ar);var a=Proxy.revocable(o,i),u=a.revoke,s=a.proxy;return n.k=s,n.j=u,s}(r,e):Pt("ES5").J(r,e);return(e?e.A:At()).p.push(n),n}function Lt(t){return dt(t)||pt(22,t),function t(r){if(!vt(r))return r;var e,n=r[Zt],o=bt(r);if(n){if(!n.P&&(n.i<4||!Pt("ES5").K(n)))return n.t;n.I=!0,e=Yt(r,o),n.I=!1}else e=Yt(r,o);return yt(e,(function(r,o){n&&function(t,r){return 2===bt(t)?t.get(r):t[r]}(n.t,r)===o||gt(e,r,t(o))})),3===o?new Set(e):e}(t)}function Yt(t,r){switch(r){case 2:return new Map(t);case 3:return Array.from(t)}return Et(t)}var qt,Kt,Wt="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),Gt="undefined"!=typeof Map,Ht="undefined"!=typeof Set,Jt="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,Xt=Wt?Symbol.for("immer-nothing"):((qt={})["immer-nothing"]=!0,qt),Qt=Wt?Symbol.for("immer-draftable"):"__$immer_draftable",Zt=Wt?Symbol.for("immer-state"):"__$immer_state",tr={0:"Illegal state",1:"Immer drafts cannot have computed properties",2:"This object has been frozen and should not be mutated",3:function(t){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+t},4:"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.",5:"Immer forbids circular references",6:"The first or second argument to `produce` must be a function",7:"The third argument to `produce` must be a function or undefined",8:"First argument to `createDraft` must be a plain object, an array, or an immerable object",9:"First argument to `finishDraft` must be a draft returned by `createDraft`",10:"The given draft is already finalized",11:"Object.defineProperty() cannot be used on an Immer draft",12:"Object.setPrototypeOf() cannot be used on an Immer draft",13:"Immer only supports deleting array indices",14:"Immer only supports setting array indices and the 'length' property",15:function(t){return"Cannot apply patch, path doesn't resolve: "+t},16:'Sets cannot have "replace" patches.',17:function(t){return"Unsupported patch operation: "+t},18:function(t){return"The plugin for '"+t+"' has not been loaded into Immer. To enable the plugin, import and call `enable"+t+"()` when initializing your application."},20:"Cannot use proxies if Proxy, Proxy.revocable or Reflect are not available",21:function(t){return"produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '"+t+"'"},22:function(t){return"'current' expects a draft, got: "+t},23:function(t){return"'original' expects a draft, got: "+t},24:"Patching reserved attributes like __proto__, prototype and constructor is not allowed"},rr=""+Object.prototype.constructor,er="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,nr=Object.getOwnPropertyDescriptors||function(t){var r={};return er(t).forEach((function(e){r[e]=Object.getOwnPropertyDescriptor(t,e)})),r},or={},ir={get:function(t,r){if(r===Zt)return t;var e=wt(t);if(!_t(e,r))return function(t,r,e){var n,o=Ft(r,e);return o?"value"in o?o.value:null===(n=o.get)||void 0===n?void 0:n.call(t.k):void 0}(t,e,r);var n=e[r];return t.I||!vt(n)?n:n===Bt(t.t,r)?(Rt(t),t.o[r]=Ut(t.A.h,n,t)):n},has:function(t,r){return r in wt(t)},ownKeys:function(t){return Reflect.ownKeys(wt(t))},set:function(t,r,e){var n=Ft(wt(t),r);if(null==n?void 0:n.set)return n.set.call(t.k,e),!0;if(!t.P){var o=Bt(wt(t),r),i=null==o?void 0:o[Zt];if(i&&i.t===e)return t.o[r]=e,t.D[r]=!1,!0;if(function(t,r){return t===r?0!==t||1/t==1/r:t!=t&&r!=r}(e,o)&&(void 0!==e||_t(t.t,r)))return!0;Rt(t),Vt(t)}return t.o[r]===e&&"number"!=typeof e&&(void 0!==e||r in t.o)||(t.o[r]=e,t.D[r]=!0,!0)},deleteProperty:function(t,r){return void 0!==Bt(t.t,r)||r in t.t?(t.D[r]=!1,Rt(t),Vt(t)):delete t.D[r],t.o&&delete t.o[r],!0},getOwnPropertyDescriptor:function(t,r){var e=wt(t),n=Reflect.getOwnPropertyDescriptor(e,r);return n?{writable:!0,configurable:1!==t.i||"length"!==r,enumerable:n.enumerable,value:e[r]}:n},defineProperty:function(){pt(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){pt(12)}},ar={};yt(ir,(function(t,r){ar[t]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}})),ar.deleteProperty=function(t,r){return"production"!==process.env.NODE_ENV&&isNaN(parseInt(r))&&pt(13),ir.deleteProperty.call(this,t[0],r)},ar.set=function(t,r,e){return"production"!==process.env.NODE_ENV&&"length"!==r&&isNaN(parseInt(r))&&pt(14),ir.set.call(this,t[0],r,e,t[0])};var ur=new(function(){function t(t){var r=this;this.g=Jt,this.F=!0,this.produce=function(t,e,n){if("function"==typeof t&&"function"!=typeof e){var o=e;e=t;var i=r;return function(t){var r=this;void 0===t&&(t=o);for(var n=arguments.length,a=Array(n>1?n-1:0),u=1;u<n;u++)a[u-1]=arguments[u];return i.produce(t,(function(t){var n;return(n=e).call.apply(n,[r,t].concat(a))}))}}var a;if("function"!=typeof e&&pt(6),void 0!==n&&"function"!=typeof n&&pt(7),vt(t)){var u=kt(r),s=Ut(r,t,void 0),c=!0;try{a=e(s),c=!1}finally{c?Tt(u):Ct(u)}return"undefined"!=typeof Promise&&a instanceof Promise?a.then((function(t){return xt(u,n),Nt(t,u)}),(function(t){throw Tt(u),t})):(xt(u,n),Nt(a,u))}if(!t||"object"!=typeof t){if((a=e(t))===Xt)return;return void 0===a&&(a=t),r.F&&jt(a,!0),a}pt(21,t)},this.produceWithPatches=function(t,e){return"function"==typeof t?function(e){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];return r.produceWithPatches(e,(function(r){return t.apply(void 0,[r].concat(o))}))}:[r.produce(t,e,(function(t,r){n=t,o=r})),n,o];var n,o},"boolean"==typeof(null==t?void 0:t.useProxies)&&this.setUseProxies(t.useProxies),"boolean"==typeof(null==t?void 0:t.autoFreeze)&&this.setAutoFreeze(t.autoFreeze)}var r=t.prototype;return r.createDraft=function(t){vt(t)||pt(8),dt(t)&&(t=Lt(t));var r=kt(this),e=Ut(this,t,void 0);return e[Zt].C=!0,Ct(r),e},r.finishDraft=function(t,r){var e=t&&t[Zt];"production"!==process.env.NODE_ENV&&(e&&e.C||pt(9),e.I&&pt(10));var n=e.A;return xt(n,r),Nt(void 0,n)},r.setAutoFreeze=function(t){this.F=t},r.setUseProxies=function(t){t&&!Jt&&pt(20),this.g=t},r.applyPatches=function(t,r){var e;for(e=r.length-1;e>=0;e--){var n=r[e];if(0===n.path.length&&"replace"===n.op){t=n.value;break}}var o=Pt("Patches").$;return dt(t)?o(t,r):this.produce(t,(function(t){return o(t,r.slice(e+1))}))},t}()),sr=ur.produce;ur.produceWithPatches.bind(ur),ur.setAutoFreeze.bind(ur),ur.setUseProxies.bind(ur),ur.applyPatches.bind(ur),ur.createDraft.bind(ur),ur.finishDraft.bind(ur);var cr=function(){this.__data__=[],this.size=0};var fr=function(t,r){return t===r||t!=t&&r!=r};var lr=function(t,r){for(var e=t.length;e--;)if(fr(t[e][0],r))return e;return-1},hr=Array.prototype.splice;var pr=function(t){var r=this.__data__,e=lr(r,t);return!(e<0)&&(e==r.length-1?r.pop():hr.call(r,e,1),--this.size,!0)};var dr=function(t){var r=this.__data__,e=lr(r,t);return e<0?void 0:r[e][1]};var vr=function(t){return lr(this.__data__,t)>-1};var yr=function(t,r){var e=this.__data__,n=lr(e,t);return n<0?(++this.size,e.push([t,r])):e[n][1]=r,this};function br(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}br.prototype.clear=cr,br.prototype.delete=pr,br.prototype.get=dr,br.prototype.has=vr,br.prototype.set=yr;var _r=br;var gr=function(){this.__data__=new _r,this.size=0};var mr=function(t){var r=this.__data__,e=r.delete(t);return this.size=r.size,e};var $r=function(t){return this.__data__.get(t)};var wr=function(t){return this.__data__.has(t)},Er="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function jr(t,r){return t(r={exports:{}},r.exports),r.exports}var Or="object"==typeof Er&&Er&&Er.Object===Object&&Er,Sr="object"==typeof self&&self&&self.Object===Object&&self,Pr=Or||Sr||Function("return this")(),Ar=Pr.Symbol,xr=Object.prototype,Tr=xr.hasOwnProperty,Cr=xr.toString,kr=Ar?Ar.toStringTag:void 0;var Ir=function(t){var r=Tr.call(t,kr),e=t[kr];try{t[kr]=void 0;var n=!0}catch(t){}var o=Cr.call(t);return n&&(r?t[kr]=e:delete t[kr]),o},Nr=Object.prototype.toString;var Dr=function(t){return Nr.call(t)},Mr=Ar?Ar.toStringTag:void 0;var zr=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Mr&&Mr in Object(t)?Ir(t):Dr(t)};var Br=function(t){var r=typeof t;return null!=t&&("object"==r||"function"==r)};var Fr,Vr=function(t){if(!Br(t))return!1;var r=zr(t);return"[object Function]"==r||"[object GeneratorFunction]"==r||"[object AsyncFunction]"==r||"[object Proxy]"==r},Rr=Pr["__core-js_shared__"],Ur=(Fr=/[^.]+$/.exec(Rr&&Rr.keys&&Rr.keys.IE_PROTO||""))?"Symbol(src)_1."+Fr:"";var Lr=function(t){return!!Ur&&Ur in t},Yr=Function.prototype.toString;var qr=function(t){if(null!=t){try{return Yr.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Kr=/^\[object .+?Constructor\]$/,Wr=Function.prototype,Gr=Object.prototype,Hr=Wr.toString,Jr=Gr.hasOwnProperty,Xr=RegExp("^"+Hr.call(Jr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Qr=function(t){return!(!Br(t)||Lr(t))&&(Vr(t)?Xr:Kr).test(qr(t))};var Zr=function(t,r){return null==t?void 0:t[r]};var te=function(t,r){var e=Zr(t,r);return Qr(e)?e:void 0},re=te(Pr,"Map"),ee=te(Object,"create");var ne=function(){this.__data__=ee?ee(null):{},this.size=0};var oe=function(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r},ie=Object.prototype.hasOwnProperty;var ae=function(t){var r=this.__data__;if(ee){var e=r[t];return"__lodash_hash_undefined__"===e?void 0:e}return ie.call(r,t)?r[t]:void 0},ue=Object.prototype.hasOwnProperty;var se=function(t){var r=this.__data__;return ee?void 0!==r[t]:ue.call(r,t)};var ce=function(t,r){var e=this.__data__;return this.size+=this.has(t)?0:1,e[t]=ee&&void 0===r?"__lodash_hash_undefined__":r,this};function fe(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}fe.prototype.clear=ne,fe.prototype.delete=oe,fe.prototype.get=ae,fe.prototype.has=se,fe.prototype.set=ce;var le=fe;var he=function(){this.size=0,this.__data__={hash:new le,map:new(re||_r),string:new le}};var pe=function(t){var r=typeof t;return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t};var de=function(t,r){var e=t.__data__;return pe(r)?e["string"==typeof r?"string":"hash"]:e.map};var ve=function(t){var r=de(this,t).delete(t);return this.size-=r?1:0,r};var ye=function(t){return de(this,t).get(t)};var be=function(t){return de(this,t).has(t)};var _e=function(t,r){var e=de(this,t),n=e.size;return e.set(t,r),this.size+=e.size==n?0:1,this};function ge(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}ge.prototype.clear=he,ge.prototype.delete=ve,ge.prototype.get=ye,ge.prototype.has=be,ge.prototype.set=_e;var me=ge;var $e=function(t,r){var e=this.__data__;if(e instanceof _r){var n=e.__data__;if(!re||n.length<199)return n.push([t,r]),this.size=++e.size,this;e=this.__data__=new me(n)}return e.set(t,r),this.size=e.size,this};function we(t){var r=this.__data__=new _r(t);this.size=r.size}we.prototype.clear=gr,we.prototype.delete=mr,we.prototype.get=$r,we.prototype.has=wr,we.prototype.set=$e;var Ee=we;var je=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var Oe=function(t){return this.__data__.has(t)};function Se(t){var r=-1,e=null==t?0:t.length;for(this.__data__=new me;++r<e;)this.add(t[r])}Se.prototype.add=Se.prototype.push=je,Se.prototype.has=Oe;var Pe=Se;var Ae=function(t,r){for(var e=-1,n=null==t?0:t.length;++e<n;)if(r(t[e],e,t))return!0;return!1};var xe=function(t,r){return t.has(r)};var Te=function(t,r,e,n,o,i){var a=1&e,u=t.length,s=r.length;if(u!=s&&!(a&&s>u))return!1;var c=i.get(t),f=i.get(r);if(c&&f)return c==r&&f==t;var l=-1,h=!0,p=2&e?new Pe:void 0;for(i.set(t,r),i.set(r,t);++l<u;){var d=t[l],v=r[l];if(n)var y=a?n(v,d,l,r,t,i):n(d,v,l,t,r,i);if(void 0!==y){if(y)continue;h=!1;break}if(p){if(!Ae(r,(function(t,r){if(!xe(p,r)&&(d===t||o(d,t,e,n,i)))return p.push(r)}))){h=!1;break}}else if(d!==v&&!o(d,v,e,n,i)){h=!1;break}}return i.delete(t),i.delete(r),h},Ce=Pr.Uint8Array;var ke=function(t){var r=-1,e=Array(t.size);return t.forEach((function(t,n){e[++r]=[n,t]})),e};var Ie=function(t){var r=-1,e=Array(t.size);return t.forEach((function(t){e[++r]=t})),e},Ne=Ar?Ar.prototype:void 0,De=Ne?Ne.valueOf:void 0;var Me=function(t,r,e,n,o,i,a){switch(e){case"[object DataView]":if(t.byteLength!=r.byteLength||t.byteOffset!=r.byteOffset)return!1;t=t.buffer,r=r.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=r.byteLength||!i(new Ce(t),new Ce(r)));case"[object Boolean]":case"[object Date]":case"[object Number]":return fr(+t,+r);case"[object Error]":return t.name==r.name&&t.message==r.message;case"[object RegExp]":case"[object String]":return t==r+"";case"[object Map]":var u=ke;case"[object Set]":var s=1&n;if(u||(u=Ie),t.size!=r.size&&!s)return!1;var c=a.get(t);if(c)return c==r;n|=2,a.set(t,r);var f=Te(u(t),u(r),n,o,i,a);return a.delete(t),f;case"[object Symbol]":if(De)return De.call(t)==De.call(r)}return!1};var ze=function(t,r){for(var e=-1,n=r.length,o=t.length;++e<n;)t[o+e]=r[e];return t},Be=Array.isArray;var Fe=function(t,r,e){var n=r(t);return Be(t)?n:ze(n,e(t))};var Ve=function(t,r){for(var e=-1,n=null==t?0:t.length,o=0,i=[];++e<n;){var a=t[e];r(a,e,t)&&(i[o++]=a)}return i};var Re=function(){return[]},Ue=Object.prototype.propertyIsEnumerable,Le=Object.getOwnPropertySymbols,Ye=Le?function(t){return null==t?[]:(t=Object(t),Ve(Le(t),(function(r){return Ue.call(t,r)})))}:Re;var qe=function(t,r){for(var e=-1,n=Array(t);++e<t;)n[e]=r(e);return n};var Ke=function(t){return null!=t&&"object"==typeof t};var We=function(t){return Ke(t)&&"[object Arguments]"==zr(t)},Ge=Object.prototype,He=Ge.hasOwnProperty,Je=Ge.propertyIsEnumerable,Xe=We(function(){return arguments}())?We:function(t){return Ke(t)&&He.call(t,"callee")&&!Je.call(t,"callee")};var Qe=function(){return!1},Ze=jr((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e?Pr.Buffer:void 0,i=(o?o.isBuffer:void 0)||Qe;t.exports=i})),tn=/^(?:0|[1-9]\d*)$/;var rn=function(t,r){var e=typeof t;return!!(r=null==r?9007199254740991:r)&&("number"==e||"symbol"!=e&&tn.test(t))&&t>-1&&t%1==0&&t<r};var en=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},nn={};nn["[object Float32Array]"]=nn["[object Float64Array]"]=nn["[object Int8Array]"]=nn["[object Int16Array]"]=nn["[object Int32Array]"]=nn["[object Uint8Array]"]=nn["[object Uint8ClampedArray]"]=nn["[object Uint16Array]"]=nn["[object Uint32Array]"]=!0,nn["[object Arguments]"]=nn["[object Array]"]=nn["[object ArrayBuffer]"]=nn["[object Boolean]"]=nn["[object DataView]"]=nn["[object Date]"]=nn["[object Error]"]=nn["[object Function]"]=nn["[object Map]"]=nn["[object Number]"]=nn["[object Object]"]=nn["[object RegExp]"]=nn["[object Set]"]=nn["[object String]"]=nn["[object WeakMap]"]=!1;var on=function(t){return Ke(t)&&en(t.length)&&!!nn[zr(t)]};var an=function(t){return function(r){return t(r)}},un=jr((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e&&Or.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),sn=un&&un.isTypedArray,cn=sn?an(sn):on,fn=Object.prototype.hasOwnProperty;var ln=function(t,r){var e=Be(t),n=!e&&Xe(t),o=!e&&!n&&Ze(t),i=!e&&!n&&!o&&cn(t),a=e||n||o||i,u=a?qe(t.length,String):[],s=u.length;for(var c in t)!r&&!fn.call(t,c)||a&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||rn(c,s))||u.push(c);return u},hn=Object.prototype;var pn=function(t){var r=t&&t.constructor;return t===("function"==typeof r&&r.prototype||hn)};var dn=function(t,r){return function(e){return t(r(e))}}(Object.keys,Object),vn=Object.prototype.hasOwnProperty;var yn=function(t){if(!pn(t))return dn(t);var r=[];for(var e in Object(t))vn.call(t,e)&&"constructor"!=e&&r.push(e);return r};var bn=function(t){return null!=t&&en(t.length)&&!Vr(t)};var _n=function(t){return bn(t)?ln(t):yn(t)};var gn=function(t){return Fe(t,_n,Ye)},mn=Object.prototype.hasOwnProperty;var $n=function(t,r,e,n,o,i){var a=1&e,u=gn(t),s=u.length;if(s!=gn(r).length&&!a)return!1;for(var c=s;c--;){var f=u[c];if(!(a?f in r:mn.call(r,f)))return!1}var l=i.get(t),h=i.get(r);if(l&&h)return l==r&&h==t;var p=!0;i.set(t,r),i.set(r,t);for(var d=a;++c<s;){var v=t[f=u[c]],y=r[f];if(n)var b=a?n(y,v,f,r,t,i):n(v,y,f,t,r,i);if(!(void 0===b?v===y||o(v,y,e,n,i):b)){p=!1;break}d||(d="constructor"==f)}if(p&&!d){var _=t.constructor,g=r.constructor;_==g||!("constructor"in t)||!("constructor"in r)||"function"==typeof _&&_ instanceof _&&"function"==typeof g&&g instanceof g||(p=!1)}return i.delete(t),i.delete(r),p},wn=te(Pr,"DataView"),En=te(Pr,"Promise"),jn=te(Pr,"Set"),On=te(Pr,"WeakMap"),Sn=qr(wn),Pn=qr(re),An=qr(En),xn=qr(jn),Tn=qr(On),Cn=zr;(wn&&"[object DataView]"!=Cn(new wn(new ArrayBuffer(1)))||re&&"[object Map]"!=Cn(new re)||En&&"[object Promise]"!=Cn(En.resolve())||jn&&"[object Set]"!=Cn(new jn)||On&&"[object WeakMap]"!=Cn(new On))&&(Cn=function(t){var r=zr(t),e="[object Object]"==r?t.constructor:void 0,n=e?qr(e):"";if(n)switch(n){case Sn:return"[object DataView]";case Pn:return"[object Map]";case An:return"[object Promise]";case xn:return"[object Set]";case Tn:return"[object WeakMap]"}return r});var kn=Cn,In=Object.prototype.hasOwnProperty;var Nn=function(t,r,e,n,o,i){var a=Be(t),u=Be(r),s=a?"[object Array]":kn(t),c=u?"[object Array]":kn(r),f="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s),l="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),h=s==c;if(h&&Ze(t)){if(!Ze(r))return!1;a=!0,f=!1}if(h&&!f)return i||(i=new Ee),a||cn(t)?Te(t,r,e,n,o,i):Me(t,r,s,e,n,o,i);if(!(1&e)){var p=f&&In.call(t,"__wrapped__"),d=l&&In.call(r,"__wrapped__");if(p||d){var v=p?t.value():t,y=d?r.value():r;return i||(i=new Ee),o(v,y,e,n,i)}}return!!h&&(i||(i=new Ee),$n(t,r,e,n,o,i))};var Dn=function t(r,e,n,o,i){return r===e||(null==r||null==e||!Ke(r)&&!Ke(e)?r!=r&&e!=e:Nn(r,e,n,o,t,i))};var Mn=function(t,r){return Dn(t,r)};var zn=function(t,r,e,n){for(var o=t.length,i=e+(n?1:-1);n?i--:++i<o;)if(r(t[i],i,t))return i;return-1};var Bn=function(t){return t!=t};var Fn=function(t,r,e){for(var n=e-1,o=t.length;++n<o;)if(t[n]===r)return n;return-1};var Vn=function(t,r,e){return r==r?Fn(t,r,e):zn(t,Bn,e)};var Rn=function(t,r){return!!(null==t?0:t.length)&&Vn(t,r,0)>-1};var Un=function(t,r,e){for(var n=-1,o=null==t?0:t.length;++n<o;)if(e(r,t[n]))return!0;return!1};var Ln=function(){},Yn=jn&&1/Ie(new jn([,-0]))[1]==1/0?function(t){return new jn(t)}:Ln;var qn=function(t,r,e){var n=-1,o=Rn,i=t.length,a=!0,u=[],s=u;if(e)a=!1,o=Un;else if(i>=200){var c=r?null:Yn(t);if(c)return Ie(c);a=!1,o=xe,s=new Pe}else s=r?[]:u;t:for(;++n<i;){var f=t[n],l=r?r(f):f;if(f=e||0!==f?f:0,a&&l==l){for(var h=s.length;h--;)if(s[h]===l)continue t;r&&s.push(l),u.push(f)}else o(s,l,e)||(s!==u&&s.push(l),u.push(f))}return u};var Kn=function(t){return t&&t.length?qn(t):[]};var Wn=function(t){return"symbol"==typeof t||Ke(t)&&"[object Symbol]"==zr(t)},Gn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hn=/^\w*$/;var Jn=function(t,r){if(Be(t))return!1;var e=typeof t;return!("number"!=e&&"symbol"!=e&&"boolean"!=e&&null!=t&&!Wn(t))||(Hn.test(t)||!Gn.test(t)||null!=r&&t in Object(r))};function Xn(t,r){if("function"!=typeof t||null!=r&&"function"!=typeof r)throw new TypeError("Expected a function");var e=function(){var n=arguments,o=r?r.apply(this,n):n[0],i=e.cache;if(i.has(o))return i.get(o);var a=t.apply(this,n);return e.cache=i.set(o,a)||i,a};return e.cache=new(Xn.Cache||me),e}Xn.Cache=me;var Qn=Xn;var Zn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,to=/\\(\\)?/g,ro=function(t){var r=Qn(t,(function(t){return 500===e.size&&e.clear(),t})),e=r.cache;return r}((function(t){var r=[];return 46===t.charCodeAt(0)&&r.push(""),t.replace(Zn,(function(t,e,n,o){r.push(n?o.replace(to,"$1"):e||t)})),r}));var eo=function(t,r){for(var e=-1,n=null==t?0:t.length,o=Array(n);++e<n;)o[e]=r(t[e],e,t);return o},no=Ar?Ar.prototype:void 0,oo=no?no.toString:void 0;var io=function t(r){if("string"==typeof r)return r;if(Be(r))return eo(r,t)+"";if(Wn(r))return oo?oo.call(r):"";var e=r+"";return"0"==e&&1/r==-1/0?"-0":e};var ao=function(t){return null==t?"":io(t)};var uo=function(t,r){return Be(t)?t:Jn(t,r)?[t]:ro(ao(t))};var so=function(t){if("string"==typeof t||Wn(t))return t;var r=t+"";return"0"==r&&1/t==-1/0?"-0":r};var co=function(t,r){for(var e=0,n=(r=uo(r,t)).length;null!=t&&e<n;)t=t[so(r[e++])];return e&&e==n?t:void 0};var fo=function(t,r,e){var n=null==t?void 0:co(t,r);return void 0===n?e:n},lo=Ar?Ar.isConcatSpreadable:void 0;var ho=function(t){return Be(t)||Xe(t)||!!(lo&&t&&t[lo])};var po=function t(r,e,n,o,i){var a=-1,u=r.length;for(n||(n=ho),i||(i=[]);++a<u;){var s=r[a];e>0&&n(s)?e>1?t(s,e-1,n,o,i):ze(i,s):o||(i[i.length]=s)}return i};var vo=function(t,r,e,n){var o=e.length,i=o,a=!n;if(null==t)return!i;for(t=Object(t);o--;){var u=e[o];if(a&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++o<i;){var s=(u=e[o])[0],c=t[s],f=u[1];if(a&&u[2]){if(void 0===c&&!(s in t))return!1}else{var l=new Ee;if(n)var h=n(c,f,s,t,r,l);if(!(void 0===h?Dn(f,c,3,n,l):h))return!1}}return!0};var yo=function(t){return t==t&&!Br(t)};var bo=function(t){for(var r=_n(t),e=r.length;e--;){var n=r[e],o=t[n];r[e]=[n,o,yo(o)]}return r};var _o=function(t,r){return function(e){return null!=e&&(e[t]===r&&(void 0!==r||t in Object(e)))}};var go=function(t){var r=bo(t);return 1==r.length&&r[0][2]?_o(r[0][0],r[0][1]):function(e){return e===t||vo(e,t,r)}};var mo=function(t,r){return null!=t&&r in Object(t)};var $o=function(t,r,e){for(var n=-1,o=(r=uo(r,t)).length,i=!1;++n<o;){var a=so(r[n]);if(!(i=null!=t&&e(t,a)))break;t=t[a]}return i||++n!=o?i:!!(o=null==t?0:t.length)&&en(o)&&rn(a,o)&&(Be(t)||Xe(t))};var wo=function(t,r){return null!=t&&$o(t,r,mo)};var Eo=function(t,r){return Jn(t)&&yo(r)?_o(so(t),r):function(e){var n=fo(e,t);return void 0===n&&n===r?wo(e,t):Dn(r,n,3)}};var jo=function(t){return t};var Oo=function(t){return function(r){return null==r?void 0:r[t]}};var So=function(t){return function(r){return co(r,t)}};var Po=function(t){return Jn(t)?Oo(so(t)):So(t)};var Ao=function(t){return"function"==typeof t?t:null==t?jo:"object"==typeof t?Be(t)?Eo(t[0],t[1]):go(t):Po(t)};var xo=function(t){return function(r,e,n){for(var o=-1,i=Object(r),a=n(r),u=a.length;u--;){var s=a[t?u:++o];if(!1===e(i[s],s,i))break}return r}}();var To=function(t,r){return function(e,n){if(null==e)return e;if(!bn(e))return t(e,n);for(var o=e.length,i=r?o:-1,a=Object(e);(r?i--:++i<o)&&!1!==n(a[i],i,a););return e}}((function(t,r){return t&&xo(t,r,_n)}));var Co=function(t,r){var e=-1,n=bn(t)?Array(t.length):[];return To(t,(function(t,o,i){n[++e]=r(t,o,i)})),n};var ko=function(t,r){var e=t.length;for(t.sort(r);e--;)t[e]=t[e].value;return t};var Io=function(t,r){if(t!==r){var e=void 0!==t,n=null===t,o=t==t,i=Wn(t),a=void 0!==r,u=null===r,s=r==r,c=Wn(r);if(!u&&!c&&!i&&t>r||i&&a&&s&&!u&&!c||n&&a&&s||!e&&s||!o)return 1;if(!n&&!i&&!c&&t<r||c&&e&&o&&!n&&!i||u&&e&&o||!a&&o||!s)return-1}return 0};var No=function(t,r,e){for(var n=-1,o=t.criteria,i=r.criteria,a=o.length,u=e.length;++n<a;){var s=Io(o[n],i[n]);if(s)return n>=u?s:s*("desc"==e[n]?-1:1)}return t.index-r.index};var Do=function(t,r,e){r=r.length?eo(r,(function(t){return Be(t)?function(r){return co(r,1===t.length?t[0]:t)}:t})):[jo];var n=-1;r=eo(r,an(Ao));var o=Co(t,(function(t,e,o){return{criteria:eo(r,(function(r){return r(t)})),index:++n,value:t}}));return ko(o,(function(t,r){return No(t,r,e)}))};var Mo=function(t,r,e){switch(e.length){case 0:return t.call(r);case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2])}return t.apply(r,e)},zo=Math.max;var Bo=function(t,r,e){return r=zo(void 0===r?t.length-1:r,0),function(){for(var n=arguments,o=-1,i=zo(n.length-r,0),a=Array(i);++o<i;)a[o]=n[r+o];o=-1;for(var u=Array(r+1);++o<r;)u[o]=n[o];return u[r]=e(a),Mo(t,this,u)}};var Fo=function(t){return function(){return t}},Vo=function(){try{var t=te(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Ro=Vo?function(t,r){return Vo(t,"toString",{configurable:!0,enumerable:!1,value:Fo(r),writable:!0})}:jo,Uo=Date.now;var Lo=function(t){var r=0,e=0;return function(){var n=Uo(),o=16-(n-e);if(e=n,o>0){if(++r>=800)return arguments[0]}else r=0;return t.apply(void 0,arguments)}}(Ro);var Yo=function(t,r,e){if(!Br(e))return!1;var n=typeof r;return!!("number"==n?bn(e)&&rn(r,e.length):"string"==n&&r in e)&&fr(e[r],t)},qo=function(t,r){return Lo(Bo(t,r,jo),t+"")}((function(t,r){if(null==t)return[];var e=r.length;return e>1&&Yo(t,r[0],r[1])?r=[]:e>2&&Yo(r[0],r[1],r[2])&&(r=[r[0]]),Do(t,po(r,1),[])}));var Ko=function(t){for(var r=-1,e=null==t?0:t.length,n=0,o=[];++r<e;){var i=t[r];i&&(o[n++]=i)}return o};const Wo=Symbol("type:map"),Go=Symbol("type:object"),Ho=Symbol("type:value"),Jo=Symbol("type:array"),Xo=Symbol("type:mirror"),Qo=Symbol("unnamed"),Zo=Symbol("ABSENT"),ti=Symbol("next"),ri=Symbol("set"),ei=Symbol("debug"),ni=Symbol("clean"),oi=Symbol("event:acceptFrom"),ii=Symbol("event:removeFrom"),ai=Symbol("event:commit"),ui=Symbol("event:action"),si=Symbol("event:mutate"),ci=Symbol("event:validate"),fi=/^set(.+)$/i,li=Symbol("mirror-event-state:active"),hi=Symbol("mirror-state:error"),pi=Symbol("mirror-state:stopped"),di=Symbol("mirror-state:complete");var vi=Object.freeze({__proto__:null,TYPE_MAP:Wo,TYPE_OBJECT:Go,TYPE_VALUE:Ho,TYPE_ARRAY:Jo,TYPE_MIRROR:Xo,NAME_UNNAMED:Qo,ABSENT:Zo,EVENT_TYPE_NEXT:ti,EVENT_TYPE_SET:ri,EVENT_TYPE_DEBUG:ei,EVENT_TYPE_CLEAN:ni,EVENT_TYPE_ACCEPT_FROM:oi,EVENT_TYPE_REMOVE_FROM:ii,EVENT_TYPE_FLUSH_ACTIVE:ai,EVENT_TYPE_ACTION:ui,EVENT_TYPE_MUTATE:si,EVENT_TYPE_VALIDATE:ci,SET_RE:fi,MIRROR_EVENT_STATE_ACTIVE:li,MIRROR_EVENT_STATE_ERROR:hi,MIRROR_EVENT_STATE_STOPPED:pi,MIRROR_EVENT_STATE_COMPLETE:di});let yi=null;const bi=t=>t instanceof yi,_i=(...t)=>new yi(...t),gi=require("lodash/isNumber");function mi(t){return![Zo,Qo,void 0].includes(t)}function $i(t){return Pi(t,!0)?t.charAt(0).toUpperCase()+t.slice(1):""}function wi(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!(t instanceof Map)}function Ei(t,r=!1){return Array.isArray(t)&&(!r||t.length)}const ji=t=>t&&t instanceof Map,Oi=t=>"function"==typeof t,Si=(t,r={})=>("string"==typeof t&&(t=new Error(t)),mi(r)?wi(r)||(r={notes:r}):r={},Object.assign(t,r));function Pi(t,r=!1){return"string"==typeof t&&(!r||!!t)}function Ai(t){if(bi(t))return Xo;let r=Ho;return ji(t)&&(r=Wo),Ei(t)&&(r=Jo),wi(t)&&(r=Go),r}function xi(t,r,e=null){e||(e=Ai(t));let n=!1;switch(e){case Ho:n=!1;break;case Go:n=r in t;break;case Wo:n=t.has(r);break;case Jo:n=!(!Ei(t)||Ti(r))&&r<t.length;break;default:n=!1}return n}function Ti(t){return!!gi(t)&&(t>=0&&!(t%2))}function Ci(t,r,e=null){e||(e=Ai(t));let n=null;switch(e){case Ho:n=null;break;case Go:n=t[r];break;case Wo:n=t.get(r);break;case Jo:n=t[r];break;default:n=null}return n}function ki(t,r,e,n=null){switch(n||(n=Ai(t)),n){case Go:t[r]=e;break;case Wo:t.set(r,e);break;case Jo:t[r]=e}return t}function Ii(t,r){if(t instanceof Map)return r?new Map(t):t;const e=new Map;return Object.keys(t).forEach(r=>e.set(r,t[r])),e}function Ni(t){try{return sr(t,t=>t)}catch(r){return t}}var Di=Object.freeze({__proto__:null,lazy:function(t,r,e){const n=e(t,r);return Object.defineProperty(t,r,{value:n}),n},produce:sr,isEqual:Mn,uniq:Kn,lGet:fo,sortBy:qo,asImmer:Ni,compact:Ko,getKey:Ci,setKey:ki,isNumber:gi,isThere:mi,ucFirst:$i,isObj:wi,isArr:Ei,isMap:ji,isFn:Oi,e:Si,isStr:Pi,typeOfValue:Ai,hasKey:xi,isWhole:Ti,toMap:Ii,toObj:function(t,r=!1){if(!wi(t)&&!ji(t))throw Si("cannot convert target to object",{target:t});let e=t;return wi(t)?r&&(e={...t}):ji(t)&&(e={},t.forEach((r,n)=>{if(gi(r)||Pi(r,!0))try{e[n]=r}catch(r){console.warn("toObj map/object conversion -- skipping exporting of child key",n,"of ",t)}})),e}});let Mi=0;class zi{constructor(t,r,e){this.value=t,this.$type=r,this.$target=e,this.$id=lt(),this.$order=Mi,Mi+=1,this._state=li}get state(){return this._state}set state(t){this.isStopped||(this._state=t)}get hasError(){return this.state===hi}get isStopped(){return this.state!==li}matches(t){return t===this||t===this.$id}$isAfter(t){return gi(t)?this.$order>t:t instanceof zi&&this.$isAfter(t.$order)}$isBefore(t){return gi(t)?this.$order<t:t instanceof zi&&this.$isBefore(t.$order)}error(t){this.state=hi,this.thrownError=t}complete(){this.state=di}}var Bi=t=>class extends t{constructor(...t){super(...t),this.$on(ti,(t,r,e)=>{e.$_addToChangeBuffer(r)}),this.$on(ai,(t,r,e)=>{t.hasError&&(e.$root.$send(ii,t.$order,!0),r.error(t.thrownError)),e.$root.$send(oi,t.$order)}),this.$on(ii,(t,r,e)=>{e.$children.forEach(r=>{r.$send(ii,t,!0)}),e.$_removeFromBuffer(t,!0)}),this.$on(oi,(t,r,e)=>{if(e.$_allBuffers.find(r=>r.$type===ui&&r.$isBefore(t)))return;e.$children.forEach(r=>{r.$send(oi,t)});const n=e.$lastChange;n&&!n.$isBefore(t)&&e.$next(n.value),e.$_removeFromBuffer(t,!0)})}get $events(){return this.$_events||(this.$_events=new N),this.$_events}get $_changeBuffer(){return this.$__buffer||(this.$__buffer=[]),this.$__buffer}get $_allBuffers(){if(this.$parent)return this.$root.$_downBuffers;let t=[...this.$_changeBuffer];return this.$_hasChildren&&this.$children.forEach(r=>{t=[...t,...r.$_downBuffers]}),Ko(t)}get $_downBuffers(){let t=[...this.$_changeBuffer];return this.$_hasChildren&&this.$children.forEach(r=>{t=[...t,...r.$_downBuffers]}),Ko(t)}set $_changeBuffer(t){Ei(t)&&(this.$__buffer=t,this.$watchActive&&this.$watchActive(t))}$_removeFromBuffer(t,r=!1){let e=[...this.$_changeBuffer];e=r?e.filter(r=>r.$isBefore(t)):gi(t)?e.filter(r=>r.$order!==t):e.filter(r=>!r.matches(t)),e.length!==this.$_changeBuffer.length&&(this.$_changeBuffer=e)}$_addToChangeBuffer(t){return this.$_changeBuffer=[...this.$_changeBuffer,t],t}get $lastChange(){return this.$__buffer?this.$_changeBuffer.reduce((t,r)=>r.$type!==ti||r.hasError?t:r,null):null}$send(t,r,e=!1){const n=new zi(r,t,this);return this.$events.next(n),e&&!n.isStopped&&n.complete(),n}$on(t,r){const e=this;return this.$events.pipe((n=r=>r.$type===t,C((function(t,r){var e=0;t.subscribe(new k(r,(function(t){return n.call(o,t,e++)&&r.next(t)})))})))).subscribe({next(t){if(!t.isStopped)try{r(t.value,t,e)}catch(r){console.log("--- error on handler: ",r),t.isStopped||t.error(r)}}});var n,o}};function Fi(t){return t.$_doProxy?t.$_doProxy:"undefined"==typeof Proxy?function(t){const r={};switch(t.$_actions.forEach((t,e)=>{try{r[e]=t}catch(t){}}),t.$type){case Go:Object.keys(t.value).forEach(e=>{const n="set"+$i(e);r[n]=r=>t.$set(e,r)});break;case Wo:t.value.keys().forEach(e=>{const n="set"+$i(e);r[n]=r=>t.$set(e,r)})}return r}(t):new Proxy(t,{get(t,r){if(t.$_actions.has(r))return t.$_actions.get(r);if(Pi(r)){const e=r.match(fi);if(e){const[r,n]=e;if(t.$keyFor(n))return r=>t.$set(n,r)}}return()=>{throw Si("no action named",{name:r})}}})}var Vi=t=>class extends t{constructor(t,r,...e){super(t,r,...e),r&&this.$_configActions(r),this.$on(ui,({fn:t,args:r},e,n)=>{if(!e.isStopped){n.$_addToChangeBuffer(e);try{t(n,...r)}catch(t){e.error(t)}n.$send(ai,e,!0)}})}get $_actions(){return this.$__actions||(this.$__actions=new Map),this.$__actions}get $isInAction(){return!!this.$_allBuffers.find(({type:t,committed:r})=>!r&&t===ui)}$addAction(t,r){this.$_actions.set(t,(...t)=>this.$act(r,t)),"undefined"==typeof Proxy&&delete this.$_do}$act(t,r){const e=this.$send(ui,{fn:t,args:r},!0);if(e.hasError)throw e.thrownError}get $do(){return this.$_do||(this.$_do=Fi(this)),this.$_do}$_configActions(t){if(!wi(t))return;const{actions:r}=t;wi(r)&&Object.keys(r).forEach(t=>{this.$addAction(t,r[t])})}$mutate(t){if(!Oi(t))throw e("$mutate expects function",{source:"$mutate",fn:t});let{value:r}=this;switch(this.$type){case Go:case Jo:case Wo:r=sr(this.value,t);break;default:r=t(r)}this.next(r)}},Ri=t=>class extends t{constructor(t,r,...e){super(t,r,...e),this.$_configProps(r),this.$_hasSelectors&&this.next(this.$_withSelectors(this.value))}$_configProps(t){if(!wi(t))return;const{fixed:r,selectors:e}=t;this.$isFixed=!!r,e&&Ii(e).forEach((t,r)=>{Oi(t)&&Pi(r,!0)&&this.$addSelector(r,t)})}get $type(){return Ai(this.getValue())}$set(t,r){const e=this.$keyFor(t);let n=this.value;switch(this.$type){case Go:n=sr(n,t=>{t[e]=r});break;case Wo:n=sr(n,t=>{t.set(e,r)});break;case Jo:n=sr(n,t=>{t[e]=r});break;default:throw Si("$set is not appropriate for this type of target",{key:t,value:r,target:this})}this.next(n)}$keyFor(t){const r=(""+t).toLowerCase();let e=t;switch(this.$type){case Go:e=t in this.value?t:Array.from(Object.keys(this.value)).reduce((t,e)=>(""+e).toLowerCase()===r?e:t,t);break;case Wo:e=this.value.has(t)?t:Array.from(this.value.keys()).reduce((t,e)=>(""+e).toLowerCase()===r?e:t,t);break;case Jo:if(!Ti(t))throw Si("non-whole key for array",{key:t});e=t}return e}$addSelector(t,r){this.$_selectors.set(t,r)}get $_selectors(){return this.$__selectors||(this.$__selectors=new Map),this.$__selectors}get $_hasSelectors(){return this.$__selectors&&this.$__selectors.size>0}$get(t){return Ci(this.value,t)}$_withSelectors(t){if(!this.$_hasSelectors)return t;const r=this,e=Ai(t);return sr(t,n=>{r.$_selectors.forEach((o,i)=>{try{const a=o(t,r,i);switch(e){case Wo:n.set(i,a);break;case Go:n[i]=a;break;case Jo:n[i]=a}}catch(t){console.warn("cannot compute ",i,":",t)}})})}},Ui=t=>class extends t{constructor(t,r,...e){super(t,r,...e),r&&this.$_configChildren(r),this.$on(ti,(t,r,e)=>{if(!e.$_hasChildren)return;const n=Ai(t);e.$children.forEach((e,o)=>{if(!r.hasError&&xi(t,o,n)){const i=e.$send(ni,Ci(t,o,n));i.hasError&&r.error({error:i.thrownError,target:o,type:"clean"});const a=i.value;if(e.value===a||Mn(e.value,a))return;const u=e.$send(ti,a,!0);u.hasError?(e.$send(ii,u.$order),r.error({error:u.thrownError,target:o})):e.$send(ci,u)}})}),this.$on(ci,(t,r,e)=>{e.$_hasChildren&&!t.hasError&&e.$children.forEach(r=>{t.hasError||r.$send(ci,t)})})}get $root(){return this.$parent?this.$parent.$root:this}get $children(){return this.$_children||(this.$_children=new Map),this.$_children}get $_hasChildren(){return!!this.$_children&&this.$children.size}$hasChild(t){return!!this.$_hasChildren&&this.$children.has(t)}$addChild(t,r,e){bi(r)||(r=_i(r,e)),r.$parent=this,r.$name=t;const n=this;this.$children.set(t,r),r.subscribe({next(r){if(n.$lastChange){if(Ci(n.$lastChange.value,t)!==r)try{ki(n.$lastChange.value,t,r)}catch(e){n.$lastChange.value=sr(n.$lastChange.value,e=>{ki(e,t,r)})}}else{Ci(n.value,t)!==r&&n.next(sr(n.value,e=>{ki(e,t,r)}))}}})}$_withChildValues(t=Zo){t===Zo&&(t=this._value);const r=Ai(t);return this.$_hasChildren&&this.$children.forEach((e,n)=>{const o=e.value;Ci(t,n,r)!==o&&(t=sr(t,t=>{ki(t,n,o,r)}))}),t}$_configChildren(t){if(!wi(t))return;const{children:r}=t;if(r)switch(Ai(r)){case Go:Object.keys(r).forEach(t=>{const e=r[t];this.$addChild(t,e)});break;case Wo:r.forEach((t,r)=>{this.$addChild(r,t)});break;default:console.warn("strange child type ",r)}}},Li=t=>class extends t{constructor(t,r,...e){super(t,r,...e),this.$_configCleaner(r)}$_configCleaner(t){if(!wi(t))return;const{cleaner:r}=t;r&&this.$addCleaner(r)}$addCleaner(t){if(!Oi(t))throw Si("cannot add handler: not a function",{handler:t});const r=this.$on(ni,(r,e)=>{if(!e.hasErrors)try{e.value=t(e.value)}catch(t){e.error(t)}}),e=this.$send(this.value);if(e.hasError)throw console.log("cannot add cleaner: ",t,"initial value is invalid"),e.thrownError;return r}};class Yi extends(Ui(Li(Ri(Vi(Bi(M)))))){constructor(t,r){super(Ni(t),r),this.$_config(r)}$_config(t){if(!wi(t))return;const{test:r,name:e,debug:n=!1,cleaners:o}=t;Oi(r)&&this.$addTest(r),this.$name=Pi(e,!0)?e:lt(),this.$_debug=n,wi(o)&&Ii(o).forEach((t,r)=>{this.$hasChild(r)||this.$addChild(r,this.$get(r),{cleaner:t})})}get $debug(){return!!this.$_debug||!!this.$parent&&this.$parent.$debug}$note(t,r=null){this.$debug&&(this.$debug>1&&console.log("target: ",this.$name,t,r),this.$send(ei,{msg:t,target:this.$name,value:r}))}$update(t,r=0){const e=this.$type,n=Ai(t);if(n!==e)throw Si("Bad update:",{values:t,target:this,expectedType:e,valueType:n});if(![Wo,Go,Jo].includes(e))return console.warn("bad type for update: ",{target:this,type:e}),this.next(t);const o=sr(this.value,n=>{switch(e){case Wo:t.forEach((t,r)=>{n.set(r,t)});break;case Go:Object.keys(t).forEach(r=>{n[r]=t[r]});break;case Jo:t.forEach((t,e)=>{n[e+r]=t})}});return this.next(o)}next(t){const r=this.$send(ni,t);if(r.hasError)throw Si("cleaning error for next value",{target:this,value:t,error:r.thrownError});let e=r.value;const n=this.$send(ti,e);if(this.$_hasChildren&&(e=this.$_withChildValues(e)),this.$_hasSelectors&&(e=this.$_withSelectors(e)),n.value=e,this.$root.$send(ci,n),this.$send(ai,n,!0),n.hasError)throw n.thrownError}$addTest(t){return this.$on(ci,(r,e,n)=>{if(!r.isStopped){const e=n.getValue();let o=null;try{o=t(e,n)}catch(t){o=t}o&&r.error({target:n.$name,error:o})}})}$next(t){super.next(t)}getValue(){return this.$lastChange?this.$_withChildValues(this.$lastChange.value):super.getValue()}}return Object.assign(Yi.prototype,Bi),yi=Yi,{...vi,...ht,idGen:ht,utils:Di,Mirror:Yi,isMirror:bi,create:_i}}));
