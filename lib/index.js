!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self)["@wonderlandlabs/mirror"]=e()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};function e(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function r(t){return"function"==typeof t}var n=!1,o={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;n=t},get useDeprecatedSynchronousErrorHandling(){return n}};function i(t){setTimeout((function(){throw t}),0)}var s={closed:!0,next:function(t){},error:function(t){if(o.useDeprecatedSynchronousErrorHandling)throw t;i(t)},complete:function(){}},c=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function u(t){return null!==t&&"object"==typeof t}var a=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),h=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this._parentOrParents,o=this._ctorUnsubscribe,i=this._unsubscribe,s=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(var h=0;h<n.length;++h){n[h].remove(this)}if(r(i)){o&&(this._unsubscribe=void 0);try{i.call(this)}catch(t){e=t instanceof a?l(t.errors):[t]}}if(c(s)){h=-1;for(var p=s.length;++h<p;){var f=s[h];if(u(f))try{f.unsubscribe()}catch(t){e=e||[],t instanceof a?e=e.concat(l(t.errors)):e.push(t)}}}if(e)throw new a(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var n=r;(r=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var o=r._parentOrParents;if(null===o)r._parentOrParents=this;else if(o instanceof t){if(o===this)return r;r._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return r;o.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[r]:i.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function l(t){return t.reduce((function(t,e){return t.concat(e instanceof a?e.errors:e)}),[])}var p=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),f=function(t){function r(e,n,o){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=s;break;case 1:if(!e){i.destination=s;break}if("object"==typeof e){e instanceof r?(i.syncErrorThrowable=e.syncErrorThrowable,i.destination=e,e.add(i)):(i.syncErrorThrowable=!0,i.destination=new d(i,e));break}default:i.syncErrorThrowable=!0,i.destination=new d(i,e,n,o)}return i}return e(r,t),r.prototype[p]=function(){return this},r.create=function(t,e,n){var o=new r(t,e,n);return o.syncErrorThrowable=!1,o},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},r}(h),d=function(t){function n(e,n,o,i){var c,u=t.call(this)||this;u._parentSubscriber=e;var a=u;return r(n)?c=n:n&&(c=n.next,o=n.error,i=n.complete,n!==s&&(r((a=Object.create(n)).unsubscribe)&&u.add(a.unsubscribe.bind(a)),a.unsubscribe=u.unsubscribe.bind(u))),u._context=a,u._next=c,u._error=o,u._complete=i,u}return e(n,t),n.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},n.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=o.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):i(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;i(t)}}},n.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},n.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw t;i(t)}},n.prototype.__tryOrSetError=function(t,e,r){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return o.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(i(e),!0)}return!1},n.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},n}(f);var b=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function y(t){return t}function v(t){return 0===t.length?y:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var _=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,i=function(t,e,r){if(t){if(t instanceof f)return t;if(t[p])return t[p]()}return t||e||r?new f(t,e,r):new f(s)}(t,e,r);if(n?i.add(n.call(i,this.source)):i.add(this.source||o.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),o.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){o.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,r=e.closed,n=e.destination,o=e.isStopped;if(r||o)return!1;t=n&&n instanceof f?n:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=$(e))((function(e,n){var o;o=r.subscribe((function(e){try{t(e)}catch(t){n(t),o&&o.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[b]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:v(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=$(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function $(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}var w=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),g=function(t){function r(e,r){var n=t.call(this)||this;return n.subject=e,n.subscriber=r,n.closed=!1,n}return e(r,t),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},r}(h),m=function(t){function r(e){var r=t.call(this,e)||this;return r.destination=e,r}return e(r,t),r}(f),S=function(t){function r(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return e(r,t),r.prototype[p]=function(){return new m(this)},r.prototype.lift=function(t){var e=new x(this,this);return e.operator=t,e},r.prototype.next=function(t){if(this.closed)throw new w;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].next(t)},r.prototype.error=function(t){if(this.closed)throw new w;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].error(t);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new w;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;n<e;n++)r[n].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},r.prototype._trySubscribe=function(e){if(this.closed)throw new w;return t.prototype._trySubscribe.call(this,e)},r.prototype._subscribe=function(t){if(this.closed)throw new w;return this.hasError?(t.error(this.thrownError),h.EMPTY):this.isStopped?(t.complete(),h.EMPTY):(this.observers.push(t),new g(this,t))},r.prototype.asObservable=function(){var t=new _;return t.source=this,t},r.create=function(t,e){return new x(t,e)},r}(_),x=function(t){function r(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return e(r,t),r.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},r.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},r.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},r.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):h.EMPTY},r}(S);function E(){return function(t){return t.lift(new j(t))}}var j=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var r=this.connectable;r._refCount++;var n=new O(t,r),o=e.subscribe(n);return n.closed||(n.connection=r.connect()),o},t}(),O=function(t){function r(e,r){var n=t.call(this,e)||this;return n.connectable=r,n}return e(r,t),r.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var r=this.connection,n=t._connection;this.connection=null,!n||r&&n!==r||n.unsubscribe()}}else this.connection=null},r}(f),C=function(t){function r(e,r){var n=t.call(this)||this;return n.source=e,n.subjectFactory=r,n._refCount=0,n._isComplete=!1,n}return e(r,t),r.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},r.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},r.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new h).add(this.source.subscribe(new P(this.getSubject(),this))),t.closed&&(this._connection=null,t=h.EMPTY)),t},r.prototype.refCount=function(){return E()(this)},r}(_),T=function(){var t=C.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}}(),P=function(t){function r(e,r){var n=t.call(this,e)||this;return n.connectable=r,n}return e(r,t),r.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},r.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},r.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},r}(m),A=function(t){function r(e){var r=t.call(this)||this;return r._value=e,r}return e(r,t),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(e){var r=t.prototype._subscribe.call(this,e);return r&&!r.closed&&e.next(this._value),r},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new w;return this._value},r.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},r}(S);function M(t){return t&&"function"==typeof t.schedule}var k=function(t){return function(e){for(var r=0,n=t.length;r<n&&!e.closed;r++)e.next(t[r]);e.complete()}};function N(t,e){return new _((function(r){var n=new h,o=0;return n.add(e.schedule((function(){o!==t.length?(r.next(t[o++]),r.closed||n.add(this.schedule())):r.complete()}))),n}))}function I(t,e){return e?N(t,e):new _(k(t))}function U(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[t.length-1];return M(r)?(t.pop(),N(t,r)):I(t)}function H(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new D(t,e))}}var D=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new z(t,this.project,this.thisArg))},t}(),z=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.project=r,o.count=0,o.thisArg=n||o,o}return e(r,t),r.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},r}(f),F=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.notifyNext=function(t,e,r,n,o){this.destination.next(e)},r.prototype.notifyError=function(t,e){this.destination.error(t)},r.prototype.notifyComplete=function(t){this.destination.complete()},r}(f),R=function(t){function r(e,r,n){var o=t.call(this)||this;return o.parent=e,o.outerValue=r,o.outerIndex=n,o.index=0,o}return e(r,t),r.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},r.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(f);function V(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var Y=V(),K=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function L(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var W=function(t){if(t&&"function"==typeof t[b])return n=t,function(t){var e=n[b]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(K(t))return k(t);if(L(t))return r=t,function(t){return r.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,i),t};if(t&&"function"==typeof t[Y])return e=t,function(t){for(var r=e[Y]();;){var n=void 0;try{n=r.next()}catch(e){return t.error(e),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof r.return&&t.add((function(){r.return&&r.return()})),t};var e,r,n,o=u(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+o+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function q(t,e,r,n,o){if(void 0===o&&(o=new R(t,r,n)),!o.closed)return e instanceof _?e.subscribe(o):W(e)(o)}var B={};var G=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new J(t,this.resultSelector))},t}(),J=function(t){function r(e,r){var n=t.call(this,e)||this;return n.resultSelector=r,n.active=0,n.values=[],n.observables=[],n}return e(r,t),r.prototype._next=function(t){this.values.push(B),this.observables.push(t)},r.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var r=0;r<e;r++){var n=t[r];this.add(q(this,n,void 0,r))}}},r.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},r.prototype.notifyNext=function(t,e,r){var n=this.values,o=n[r],i=this.toRespond?o===B?--this.toRespond:this.toRespond:0;n[r]=e,0===i&&(this.resultSelector?this._tryResultSelector(n):this.destination.next(n.slice()))},r.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},r}(F);function X(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[b]}(t))return function(t,e){return new _((function(r){var n=new h;return n.add(e.schedule((function(){var o=t[b]();n.add(o.subscribe({next:function(t){n.add(e.schedule((function(){return r.next(t)})))},error:function(t){n.add(e.schedule((function(){return r.error(t)})))},complete:function(){n.add(e.schedule((function(){return r.complete()})))}}))}))),n}))}(t,e);if(L(t))return function(t,e){return new _((function(r){var n=new h;return n.add(e.schedule((function(){return t.then((function(t){n.add(e.schedule((function(){r.next(t),n.add(e.schedule((function(){return r.complete()})))})))}),(function(t){n.add(e.schedule((function(){return r.error(t)})))}))}))),n}))}(t,e);if(K(t))return N(t,e);if(function(t){return t&&"function"==typeof t[Y]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new _((function(r){var n,o=new h;return o.add((function(){n&&"function"==typeof n.return&&n.return()})),o.add(e.schedule((function(){n=t[Y](),o.add(e.schedule((function(){if(!r.closed){var t,e;try{var o=n.next();t=o.value,e=o.done}catch(t){return void r.error(t)}e?r.complete():(r.next(t),this.schedule())}})))}))),o}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function Q(t,e){return e?X(t,e):t instanceof _?t:new _(W(t))}var Z=function(t){function r(e){var r=t.call(this)||this;return r.parent=e,r}return e(r,t),r.prototype._next=function(t){this.parent.notifyNext(t)},r.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},r}(f),tt=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.notifyNext=function(t){this.destination.next(t)},r.prototype.notifyError=function(t){this.destination.error(t)},r.prototype.notifyComplete=function(){this.destination.complete()},r}(f);function et(t,e){if(!e.closed)return t instanceof _?t.subscribe(e):W(t)(e)}var rt=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new nt(t,this.project,this.concurrent))},t}(),nt=function(t){function r(e,r,n){void 0===n&&(n=Number.POSITIVE_INFINITY);var o=t.call(this,e)||this;return o.project=r,o.concurrent=n,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return e(r,t),r.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},r.prototype._tryNext=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e)},r.prototype._innerSub=function(t){var e=new Z(this),r=this.destination;r.add(e);var n=et(t,e);n!==e&&r.add(n)},r.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},r.prototype.notifyNext=function(t){this.destination.next(t)},r.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},r}(tt),ot=function t(e,r,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof r?function(o){return o.pipe(t((function(t,n){return Q(e(t,n)).pipe(H((function(e,o){return r(t,e,n,o)})))}),n))}:("number"==typeof r&&(n=r),function(t){return t.lift(new rt(e,n))})};function it(t,e){return function(r){return r.lift(new st(t,e))}}var st=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new ct(t,this.predicate,this.thisArg))},t}(),ct=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.predicate=r,o.thisArg=n,o.count=0,o}return e(r,t),r.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},r}(f);var ut=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new at(t,this.selector,this.caught))},t}(),at=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.selector=r,o.caught=n,o}return e(r,t),r.prototype.error=function(e){if(!this.isStopped){var r=void 0;try{r=this.selector(e,this.caught)}catch(e){return void t.prototype.error.call(this,e)}this._unsubscribeAndRecycle();var n=new Z(this);this.add(n);var o=et(r,n);o!==n&&this.add(o)}},r}(tt);function ht(t,e){return function(r){return r.lift(new lt(t,e))}}var lt=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new pt(t,this.compare,this.keySelector))},t}(),pt=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.keySelector=n,o.hasKey=!1,"function"==typeof r&&(o.compare=r),o}return e(r,t),r.prototype.compare=function(t,e){return t===e},r.prototype._next=function(t){var e;try{var r=this.keySelector;e=r?r(t):t}catch(t){return this.destination.error(t)}var n=!1;if(this.hasKey)try{n=(0,this.compare)(this.key,e)}catch(t){return this.destination.error(t)}else this.hasKey=!0;n||(this.key=e,this.destination.next(t))},r}(f);var ft=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var r=this.selector,n=this.subjectFactory(),o=r(n).subscribe(t);return o.add(e.subscribe(n)),o},t}();function dt(){return new S}function bt(){return function(t){return E()((e=dt,function(t){var n;if(n="function"==typeof e?e:function(){return e},"function"==typeof r)return t.lift(new ft(n,r));var o=Object.create(t,T);return o.source=t,o.subjectFactory=n,o})(t));var e,r}}var yt=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new vt(t,this.project))},t}(),vt=function(t){function r(e,r){var n=t.call(this,e)||this;return n.project=r,n.index=0,n}return e(r,t),r.prototype._next=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this._innerSub(e)},r.prototype._innerSub=function(t){var e=this.innerSubscription;e&&e.unsubscribe();var r=new Z(this),n=this.destination;n.add(r),this.innerSubscription=et(t,r),this.innerSubscription!==r&&n.add(this.innerSubscription)},r.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},r.prototype._unsubscribe=function(){this.innerSubscription=void 0},r.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},r.prototype.notifyNext=function(t){this.destination.next(t)},r}(tt),_t=Array.isArray,$t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function wt(t,e){return t(e={exports:{}},e.exports),e.exports}var gt="object"==typeof $t&&$t&&$t.Object===Object&&$t,mt="object"==typeof self&&self&&self.Object===Object&&self,St=gt||mt||Function("return this")(),xt=St.Symbol,Et=Object.prototype,jt=Et.hasOwnProperty,Ot=Et.toString,Ct=xt?xt.toStringTag:void 0;var Tt=function(t){var e=jt.call(t,Ct),r=t[Ct];try{t[Ct]=void 0;var n=!0}catch(t){}var o=Ot.call(t);return n&&(e?t[Ct]=r:delete t[Ct]),o},Pt=Object.prototype.toString;var At=function(t){return Pt.call(t)},Mt="[object Null]",kt="[object Undefined]",Nt=xt?xt.toStringTag:void 0;var It=function(t){return null==t?void 0===t?kt:Mt:Nt&&Nt in Object(t)?Tt(t):At(t)};var Ut=function(t){return null!=t&&"object"==typeof t},Ht="[object Symbol]";var Dt=function(t){return"symbol"==typeof t||Ut(t)&&It(t)==Ht},zt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ft=/^\w*$/;var Rt=function(t,e){if(_t(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!Dt(t))||(Ft.test(t)||!zt.test(t)||null!=e&&t in Object(e))};var Vt=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},Yt="[object AsyncFunction]",Kt="[object Function]",Lt="[object GeneratorFunction]",Wt="[object Proxy]";var qt,Bt=function(t){if(!Vt(t))return!1;var e=It(t);return e==Kt||e==Lt||e==Yt||e==Wt},Gt=St["__core-js_shared__"],Jt=(qt=/[^.]+$/.exec(Gt&&Gt.keys&&Gt.keys.IE_PROTO||""))?"Symbol(src)_1."+qt:"";var Xt=function(t){return!!Jt&&Jt in t},Qt=Function.prototype.toString;var Zt=function(t){if(null!=t){try{return Qt.call(t)}catch(t){}try{return t+""}catch(t){}}return""},te=/^\[object .+?Constructor\]$/,ee=Function.prototype,re=Object.prototype,ne=ee.toString,oe=re.hasOwnProperty,ie=RegExp("^"+ne.call(oe).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var se=function(t){return!(!Vt(t)||Xt(t))&&(Bt(t)?ie:te).test(Zt(t))};var ce=function(t,e){return null==t?void 0:t[e]};var ue=function(t,e){var r=ce(t,e);return se(r)?r:void 0},ae=ue(Object,"create");var he=function(){this.__data__=ae?ae(null):{},this.size=0};var le=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},pe="__lodash_hash_undefined__",fe=Object.prototype.hasOwnProperty;var de=function(t){var e=this.__data__;if(ae){var r=e[t];return r===pe?void 0:r}return fe.call(e,t)?e[t]:void 0},be=Object.prototype.hasOwnProperty;var ye=function(t){var e=this.__data__;return ae?void 0!==e[t]:be.call(e,t)},ve="__lodash_hash_undefined__";var _e=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=ae&&void 0===e?ve:e,this};function $e(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}$e.prototype.clear=he,$e.prototype.delete=le,$e.prototype.get=de,$e.prototype.has=ye,$e.prototype.set=_e;var we=$e;var ge=function(){this.__data__=[],this.size=0};var me=function(t,e){return t===e||t!=t&&e!=e};var Se=function(t,e){for(var r=t.length;r--;)if(me(t[r][0],e))return r;return-1},xe=Array.prototype.splice;var Ee=function(t){var e=this.__data__,r=Se(e,t);return!(r<0)&&(r==e.length-1?e.pop():xe.call(e,r,1),--this.size,!0)};var je=function(t){var e=this.__data__,r=Se(e,t);return r<0?void 0:e[r][1]};var Oe=function(t){return Se(this.__data__,t)>-1};var Ce=function(t,e){var r=this.__data__,n=Se(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function Te(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Te.prototype.clear=ge,Te.prototype.delete=Ee,Te.prototype.get=je,Te.prototype.has=Oe,Te.prototype.set=Ce;var Pe=Te,Ae=ue(St,"Map");var Me=function(){this.size=0,this.__data__={hash:new we,map:new(Ae||Pe),string:new we}};var ke=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Ne=function(t,e){var r=t.__data__;return ke(e)?r["string"==typeof e?"string":"hash"]:r.map};var Ie=function(t){var e=Ne(this,t).delete(t);return this.size-=e?1:0,e};var Ue=function(t){return Ne(this,t).get(t)};var He=function(t){return Ne(this,t).has(t)};var De=function(t,e){var r=Ne(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function ze(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ze.prototype.clear=Me,ze.prototype.delete=Ie,ze.prototype.get=Ue,ze.prototype.has=He,ze.prototype.set=De;var Fe=ze,Re="Expected a function";function Ve(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(Re);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var s=t.apply(this,n);return r.cache=i.set(o,s)||i,s};return r.cache=new(Ve.Cache||Fe),r}Ve.Cache=Fe;var Ye=Ve,Ke=500;var Le=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,We=/\\(\\)?/g,qe=function(t){var e=Ye(t,(function(t){return r.size===Ke&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Le,(function(t,r,n,o){e.push(n?o.replace(We,"$1"):r||t)})),e}));var Be=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},Ge=1/0,Je=xt?xt.prototype:void 0,Xe=Je?Je.toString:void 0;var Qe=function t(e){if("string"==typeof e)return e;if(_t(e))return Be(e,t)+"";if(Dt(e))return Xe?Xe.call(e):"";var r=e+"";return"0"==r&&1/e==-Ge?"-0":r};var Ze=function(t){return null==t?"":Qe(t)};var tr=function(t,e){return _t(t)?t:Rt(t,e)?[t]:qe(Ze(t))},er=1/0;var rr=function(t){if("string"==typeof t||Dt(t))return t;var e=t+"";return"0"==e&&1/t==-er?"-0":e};var nr=function(t,e){for(var r=0,n=(e=tr(e,t)).length;null!=t&&r<n;)t=t[rr(e[r++])];return r&&r==n?t:void 0};var or=function(t,e,r){var n=null==t?void 0:nr(t,e);return void 0===n?r:n};const ir=Symbol("action-next"),sr=Symbol("skip"),cr="requires an event as the second parameter",ur=t=>t,ar=Symbol("action-update"),hr=Symbol("action-child-error"),lr=Symbol("do-action-unhandled"),pr=-2,fr=0,dr=1,br=[pr,-1,fr,dr];var yr=Object.freeze({__proto__:null,ACTION_NEXT:ir,SKIP:sr,errorWrapperParamErrorMsg:cr,identity:ur,ACTION_CHANGE_KEYS:ar,ACTION_CHILD_ERROR:hr,UNHANDLED:lr,PHASE_INIT:pr,PHASE_PRE:-1,PHASE_ON:fr,PHASE_POST:dr,PHASE_DEFAULT_LIST:br});class vr extends A{constructor(t,e,r){super(t),this._action=e,this._target=r,this._last=t;const n=this;this.phase=pr,this.subscribe({next(t){n._last=t},error(){}})}get last(){return this._last}get action(){return this._action}get target(){return this._target}toJSON(){return{value:this.value,phase:this.phase,action:this.action}}}function _r(t,e){if(t instanceof Map)return e?new Map(t):t;const r=new Map;return Object.keys(t).forEach(e=>r.set(e,t[e])),r}function $r(t){return t&&"object"==typeof t}function wr(t,e){if(!(t instanceof Map))return e?{...t}:t;const r={};return t.forEach((t,e)=>{try{r[e]=t}catch(t){}}),r}function gr(t){if("string"!=typeof t)throw new Error("bad user action");for(;"$$"!==t.substr(0,2);)t=`$${t}`;return t}vr.eventsMatch=(t,e)=>t instanceof vr&&e instanceof vr&&(t.action===e.action&&t.phase===e.phase&&t.value===e.value);var mr=Object.freeze({__proto__:null,asMap:_r,isObject:$r,asObject:wr,asUserAction:gr});class Sr extends A{constructor(t,e){super(t),e&&this._$config(e),this._$watchNext(),this._$watchErrors(),this._$constructed=!0,this._$value=t}_$watchErrors(){const t=this;this.$events.subscribe({next(e){e&&e.subscribe&&e.subscribe({error(e){console.log("error in mirror: ",or(t,"name",t),":",or(e,"message",e)),e&&e.thrown&&console.log("thrown:",e.thrownError)}})},error(){}})}_$config(t){if("string"==typeof t)this.name=t;else if("object"==typeof t){const{name:e,actions:r}=t;e&&(this.name=e),r&&"object"==typeof r&&this.$addActs(r)}}next(t){return this.$send(ir,t)}$send(t,e,r=br){const n=new vr(e,t,this);return n.$phases=r,this.$events.next(n),n.isStopped||n.complete(),n}$act(t,...e){const r=this.$send(gr(t),{args:e,result:lr});if(r){if(r.thrownError)throw r.thrownError;return r.value.result===lr&&console.warn("unhandled user action",t,"called with ",...e),r.value.result}console.warn("$act did not return event.")}$addAct(t,e){if("function"!=typeof e)throw new Error(`$act requires function for ${t}`);const r=this,n=this.$on(gr(t),t=>{const{args:n}=t.value,o=e(r,...n);t.next({...t.value,result:o})},fr);this.$remAct(t);this._$acts.set(t,{name:t,handler:e,sub:n,proxy:(...e)=>r.$act(t,...e)})}get _$acts(){return this._$$acts||(this._$$acts=new Map),this._$$acts}$hasAction(t){return this._$$acts&&this._$$acts.has(t)}$addActs(t){Object.keys(t).forEach(e=>{const r=t[e];"function"==typeof r&&this.$addAct(e,r)})}$remAct(t){if(this._$$acts&&this._$acts.has(t)){const{sub:e}=this._$acts;e&&e.unsubscribe(),this._$acts.delete(t)}}get $events(){return this._$events||(this._$events=(new S).pipe(ot(t=>U(...br).pipe(H(e=>t.isStopped?sr:Object.assign(t,{phase:e})))),it(t=>!t.isStopped&&!t.hasError&&t!==sr),ht(vr.eventsMatch,t=>t instanceof vr?t.toJSON():t))),this._$events}$on(t,e,r=fr){return this.$events.subscribe({next(n){if(!n.isStopped&&n.action===t&&n.phase===r)try{e(n)}catch(t){console.log("$on handler --- thrown error from ",e.toString()),console.log("thrown: ",t),n.isStopped||n.error(n)}}})}get _$transStream(){return this._$$transStream||(this._$$transStream=new A(new Set)),this._$$transStream}$remTrans(t){const e=this._$activeTrans;e.delete(t),this._$transStream.next(e)}get _$activeTrans(){const t=new Set;return this._$transStream.value.forEach(e=>{e.isStopped||t.add(e)}),t}$trans(t){if(!t||t.isStopped)return this.$trans(new S);const e=this._$activeTrans;e.add(t);const r=this;this.$subject;return t.subscribe({complete(){r.$remTrans(t)},error(){r.$remTrans(t)}}),this._$transStream.next(e),t}$transact(t,e,...r){const n=this.$trans(e);try{t(this,...r),n.complete()}catch(t){n.error(t)}}get $subject(){if(!this._$$outThrottled){const t=this;this._$$outThrottled=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=void 0,n=void 0;return M(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&c(t[0])&&(t=t[0]),I(t,n).lift(new G(r))}(this._$transStream,t).pipe(it(([t])=>!t.size),H(t=>t[1]),ht()),this._$$outThrottled.subscribe(e=>{t._$value=e},ur)}return this._$$outThrottled}get $value(){return this._$value}$subscribe(...t){return this.$subject.subscribe(...t)}get $proxy(){return this.$p}get $p(){return this._$p||(this._$p=new Proxy(this,{get(t,e){if("$base"===e)return t;try{if(t._$$acts&&t._$$acts.has(e)){const r=t._$acts.get(e);if(r)return r.proxy}return t[e]}catch(r){return console.log("error getting",e),console.log("from",t),void console.warn(r)}}})),this._$p}get $do(){return this._$do||(this._$do=new Proxy(this,{get:(t,e)=>t.$hasAction(e)?t._$acts.get(e).proxy:ur})),this._$do}get do(){return console.warn("`.do` is deprecated: use $do or $p"),this.$do}_$watchNext(){this.$on(ir,t=>{t.subscribe({complete:()=>{super.next(t.value)},error:()=>{}})})}}var xr=function(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(r=r>o?o:r)<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var i=Array(o);++n<o;)i[n]=t[n+e];return i};var Er=function(t,e,r){var n=t.length;return r=void 0===r?n:r,!e&&r>=n?t:xr(t,e,r)},jr=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Or=function(t){return jr.test(t)};var Cr=function(t){return t.split("")},Tr="[\\ud800-\\udfff]",Pr="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Ar="\\ud83c[\\udffb-\\udfff]",Mr="[^\\ud800-\\udfff]",kr="(?:\\ud83c[\\udde6-\\uddff]){2}",Nr="[\\ud800-\\udbff][\\udc00-\\udfff]",Ir="(?:"+Pr+"|"+Ar+")"+"?",Ur="[\\ufe0e\\ufe0f]?"+Ir+("(?:\\u200d(?:"+[Mr,kr,Nr].join("|")+")[\\ufe0e\\ufe0f]?"+Ir+")*"),Hr="(?:"+[Mr+Pr+"?",Pr,kr,Nr,Tr].join("|")+")",Dr=RegExp(Ar+"(?="+Ar+")|"+Hr+Ur,"g");var zr=function(t){return t.match(Dr)||[]};var Fr=function(t){return Or(t)?zr(t):Cr(t)};var Rr=function(t){return function(e){e=Ze(e);var r=Or(e)?Fr(e):void 0,n=r?r[0]:e.charAt(0),o=r?Er(r,1).join(""):e.slice(1);return n[t]()+o}},Vr=Rr("toUpperCase"),Yr=Rr("toLowerCase"),Kr=(function(){try{var t=ue(Object,"defineProperty");t({},"",{})}catch(t){}}(),"[object Arguments]");var Lr=function(t){return Ut(t)&&It(t)==Kr},Wr=Object.prototype,qr=Wr.hasOwnProperty,Br=Wr.propertyIsEnumerable;Lr(function(){return arguments}());var Gr=function(){return!1},Jr=(wt((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?St.Buffer:void 0,i=(o?o.isBuffer:void 0)||Gr;t.exports=i})),wt((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&gt.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i}))),Xr=(Jr&&Jr.isTypedArray,wt((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?St.Buffer:void 0,i=o?o.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var r=t.length,n=i?i(r):new t.constructor(r);return t.copy(n),n}})),ue(St,"DataView")),Qr=ue(St,"Promise"),Zr=ue(St,"Set"),tn=ue(St,"WeakMap"),en=Zt(Xr),rn=Zt(Ae),nn=Zt(Qr),on=Zt(Zr),sn=Zt(tn),cn=It;(Xr&&"[object DataView]"!=cn(new Xr(new ArrayBuffer(1)))||Ae&&"[object Map]"!=cn(new Ae)||Qr&&"[object Promise]"!=cn(Qr.resolve())||Zr&&"[object Set]"!=cn(new Zr)||tn&&"[object WeakMap]"!=cn(new tn))&&(cn=function(t){var e=It(t),r="[object Object]"==e?t.constructor:void 0,n=r?Zt(r):"";if(n)switch(n){case en:return"[object DataView]";case rn:return"[object Map]";case nn:return"[object Promise]";case on:return"[object Set]";case sn:return"[object WeakMap]"}return e});St.Uint8Array;var un=xt?xt.prototype:void 0;un&&un.valueOf,Jr&&Jr.isMap,Jr&&Jr.isSet;class an extends Sr{constructor(t,e={}){var r;super(t,e),this._$isMap=t instanceof Map,this.$children=new Map,this._$collectionOptions(e),(r=this).$on(ar,t=>{t?t.isStopped||t.thrownError?console.warn("changeKeys --- already has error: ",t.thrownError):r.$changeKeys(t.value):console.warn("---- WTF? no event to ACK")},dr)}_$collectionOptions(t){if(!$r(t))return;const{children:e={},collections:r={}}=t;_r(e).forEach((t,e)=>{this.$addChild({key:e,value:t})}),Object.keys(r).forEach(t=>{this.$addChild({key:t,value:r[t],type:"collection"})})}$has(t){return!this.isStopped&&(!!this.$hasChild(t)||(this._$isMap?this.value.has(t):t in this.value))}$hasChild(t){return this.$children.has(t)}$changeKeys(t){if(this.isStopped)return null;const e=_r(this.value);return _r(t).forEach((r,n)=>{try{e.set(n,r)}catch(o){console.log("error with revision setting ",n,"to",r,"from",t,"to",e)}}),this.$next(this._$convert(e))}next(t){return this.$send(ar,_r(t))}_$convert(t,e){return this._$isMap?_r(t,e):wr(t,e)}get _$updatingChildren(){return this.__$updatingChildren||(this.__$updatingChildren=new Set),this.__$updatingChildren}$isUpdatingChild(t){let e=0;return this._$updatingChildren.forEach(r=>{r.isStopped||r.value!==t||(e+=1)}),e}_$unUpdateChild(t){t.isStopped||t.complete(),this._$updatingChildren.delete(t)}$updateChildSubject(t){const e=new A(t);e.$count=this.$isUpdatingChild(t),this._$updatingChildren.add(e);const r=this;return e.subscribe({complete(){r._$unUpdateChild(e)},error(){r._$unUpdateChild(e)}}),e}$updateChild(t,e){if(!this.$hasChild(t))return e;const r=this.$children.get(t);if(r.value!==e){if(this.$isUpdatingChild(t))return r.value;const n=this.$updateChildSubject(t);try{r.next(e),n.complete()}catch(t){n.error(t)}}return r.value}$next(t){if(this.isStopped)return void console.log("attempt to send value ",t,"to stopped mirror",this.name);const e=this.$trans();try{const r=_r(t),n=new Map(r);r.forEach((t,e)=>{this.$hasChild(e)&&(this.$isUpdatingChild(e)?this.$debug&&console.log("not calling updateChild: is updating ",t):n.set(e,this.$updateChild(e,t)))}),n.size&&super.next(this._$convert(n)),e.complete()}catch(r){console.log("error in $next",r,"from",t),e.error(r)}}$get(t){if(this.$has(t))return this.$hasChild(t)?this.$children.get(t).$value:this._$isMap?this.value.get(t):this.value[t]}$set(t,e){return this.$hasChild(t)?this.$children.get(t).next(e):this.next(new Map([[t,e]]))}get object(){return"undefined"==typeof Proxy?wr(this.value):(this._$$objectProxy||(this._$$objectProxy=new Proxy(this,{get:(t,e)=>t.$hasChild(e)?t.$children.get(e).value:t.value.has(e)?t.value.get(e):void 0})),this._$$objectProxy)}$addChild({key:t,value:e,type:r="value"}){let n;switch(this.$has(t)&&this.$delete(t),r){case"collection":n=new an(e,{name:t});break;default:n=new Sr(e,{name:t})}this.$children.set(t,n);const o=this;return n.$subscribe({next(e){if(!o.$isUpdatingChild(t)){const r=o.$updateChildSubject(t);try{o.next(new Map([[t,e]])),r.complete()}catch(t){r.error(t)}}},error(e){o.$send(...function(t,{child:e,key:r,root:n}){return[hr,{error:t,child:e,key:r,root:n}]}(e,{child:n,key:t,root:this}))},complete(){o._$deleting!==t&&o.delete(t)}}),n}$delete(t=sr){if(t===sr||!this.$has(t)||this.isStopped)return;this._$deleting=t;const e=this.$trans();if(this.$hasChild(t)){const e=this.$children.get(t);e.isStopped||e.complete(),this.$children.delete(t)}let r=this.getValue();this._$isMap?(r=new Map(r)).delete(t):delete r[t],this.$send(ir,r),delete this._$deleting,e.complete()}get $p(){return this._$p||(this._$p=new Proxy(this,{get(t,e){if("$base"===e)return t;try{if(t.$has(e))return t.$get(e);if(t._$$acts&&t._$$acts.has(e)){const r=t._$acts.get(e);if(r)return r.proxy}return console.warn("--- cannot proxy ",e,"from",t),console.warn("returning raw value:",t[e]),t[e]}catch(r){console.log("error getting",e),console.log("from",t),console.warn(r)}},set:(t,e,r)=>t.$set(e,r)})),this._$p}get $do(){return this._$do||(this._$do=new Proxy(this,{get:(t,e)=>t.$hasAction(e)?t._$acts.get(e).proxy:/^set/i.test(e)?t._$trySet(e):(console.warn("$do-- cannot find action",e),null)})),this._$do}_$trySet(t){const e=this;try{const r=Yr(`${t}`.replace(/^set/i,""));if(this.$has(r))return t=>this.$set(r,t);const n=r.toLowerCase(),o=[...this.$children.keys(),..._r(this.value).keys()].reduce((r,o)=>{if(r)return r;return`${o}`.toLowerCase()===n?(console.warn(`found key, wrong case: ${t} should be "set${Vr(`${o}`)}".`),t=>e.$set(o,t)):void 0},null);if(o)return o;console.warn("trySet -- cannot match value ",n)}catch(e){console.warn("error trySetting key",t,":",e)}return ur}get $my(){return this.$p}get my(){return console.warn("my is deprecated; use $my or $p"),this.$p}}return{ErrorWrapper:class{constructor(t,e){if(!(e instanceof vr))throw new Error(cr);this.error=t,this.event=e}get message(){return"string"==typeof this.error?this.error:this.error.message}},Event:vr,MirrorCollection:an,mapEmitter:function(t=sr,e=ur,r=(t=>t)){return new A(t).pipe(function t(e,r){return"function"==typeof r?function(n){return n.pipe(t((function(t,n){return Q(e(t,n)).pipe(H((function(e,o){return r(t,e,n,o)})))})))}:function(t){return t.lift(new yt(e))}}(t=>U(t).pipe(H(e),function(t){return function(e){var r=new ut(t),n=e.lift(r);return r.caught=n}}(t=>U(r(t))))),it(t=>t!==sr),bt())},Mirror:Sr,...yr,...mr}}));
