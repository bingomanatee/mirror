!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("crypto"),require("buffer")):"function"==typeof define&&define.amd?define(["crypto","buffer"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["@wonderlandlabs/mirror"]=e(t.crypto,t.buffer)}(this,(function(t,e){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=r(t),o=r(e),i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function u(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function c(t,e){for(var r=0,n=e.length,o=t.length;r<n;r++,o++)t[o]=e[r];return t}function f(t){return"function"==typeof t}function l(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var h=l((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function p(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var v=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}var e;return t.prototype.unsubscribe=function(){var t,e,r,n,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var a=u(i),l=a.next();!l.done;l=a.next()){l.value.remove(this)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}else i.remove(this);var p=this.initialTeardown;if(f(p))try{p()}catch(t){o=t instanceof h?t.errors:[t]}var v=this._teardowns;if(v){this._teardowns=null;try{for(var d=u(v),y=d.next();!y.done;y=d.next()){var _=y.value;try{b(_)}catch(t){o=null!=o?o:[],t instanceof h?o=c(c([],s(o)),s(t.errors)):o.push(t)}}}catch(t){r={error:t}}finally{try{y&&!y.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}}if(o)throw new h(o)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)b(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(r=this._teardowns)&&void 0!==r?r:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&p(e,t)},t.prototype.remove=function(e){var r=this._teardowns;r&&p(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}(),d=v.EMPTY;function y(t){return t instanceof v||t&&"closed"in t&&f(t.remove)&&f(t.add)&&f(t.unsubscribe)}function b(t){f(t)?t():t.unsubscribe()}var _={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},g={setTimeout:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=g.delegate;return((null==r?void 0:r.setTimeout)||setTimeout).apply(void 0,c([],s(t)))},clearTimeout:function(t){var e=g.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function m(t){g.setTimeout((function(){throw t}))}function $(){}var w=null;function E(t){if(_.useDeprecatedSynchronousErrorHandling){var e=!w;if(e&&(w={errorThrown:!1,error:null}),t(),e){var r=w,n=r.errorThrown,o=r.error;if(w=null,n)throw o}}else t()}var j=function(t){function e(e){var r=t.call(this)||this;return r.isStopped=!1,e?(r.destination=e,y(e)&&e.add(r)):r.destination=P,r}return a(e,t),e.create=function(t,e,r){return new O(t,e,r)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(v),O=function(t){function e(e,r,n){var o,i=t.call(this)||this;if(f(e))o=e;else if(e){var a;o=e.next,r=e.error,n=e.complete,i&&_.useDeprecatedNextContext?(a=Object.create(e)).unsubscribe=function(){return i.unsubscribe()}:a=e,o=null==o?void 0:o.bind(a),r=null==r?void 0:r.bind(a),n=null==n?void 0:n.bind(a)}return i.destination={next:o?S(o):$,error:S(null!=r?r:A),complete:n?S(n):$},i}return a(e,t),e}(j);function S(t,e){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];try{t.apply(void 0,c([],s(e)))}catch(t){m(t)}}}function A(t){throw t}var P={closed:!0,next:$,error:A,complete:$},x="function"==typeof Symbol&&Symbol.observable||"@@observable";function T(t){return t}function C(t){return 0===t.length?T:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var k=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n,o=this,i=(n=t)&&n instanceof j||function(t){return t&&f(t.next)&&f(t.error)&&f(t.complete)}(n)&&y(n)?t:new O(t,e,r);return E((function(){var t=o,e=t.operator,r=t.source;i.add(e?e.call(i,r):r?o._subscribe(i):o._trySubscribe(i))})),i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=I(e))((function(e,n){var o;o=r.subscribe((function(e){try{t(e)}catch(t){n(t),null==o||o.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[x]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return C(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=I(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function I(t){var e;return null!==(e=null!=t?t:_.Promise)&&void 0!==e?e:Promise}function N(t){return function(e){if(function(t){return f(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}var D=function(t){function e(e,r,n,o,i){var a=t.call(this,e)||this;return a.onFinalize=i,a._next=r?function(t){try{r(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=o?function(t){try{o(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return a(e,t),e.prototype.unsubscribe=function(){var e,r=this.closed;t.prototype.unsubscribe.call(this),!r&&(null===(e=this.onFinalize)||void 0===e||e.call(this))},e}(j),M=l((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),z=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return a(e,t),e.prototype.lift=function(t){var e=new B(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new M},e.prototype.next=function(t){var e=this;E((function(){var r,n;if(e._throwIfClosed(),!e.isStopped){var o=e.observers.slice();try{for(var i=u(o),a=i.next();!a.done;a=i.next()){a.value.next(t)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}}}))},e.prototype.error=function(t){var e=this;E((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var r=e.observers;r.length;)r.shift().error(t)}}))},e.prototype.complete=function(){var t=this;E((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this.hasError,r=this.isStopped,n=this.observers;return e||r?d:(n.push(t),new v((function(){return p(n,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this.hasError,r=this.thrownError,n=this.isStopped;e?t.error(r):n&&t.complete()},e.prototype.asObservable=function(){var t=new k;return t.source=this,t},e.create=function(t,e){return new B(t,e)},e}(k),B=function(t){function e(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return a(e,t),e.prototype.next=function(t){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===r||r.call(e,t)},e.prototype.error=function(t){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===r||r.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,r;return null!==(r=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==r?r:d},e}(z),F=function(t){function e(e){var r=t.call(this)||this;return r._value=e,r}return a(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(e){var r=t.prototype._subscribe.call(this,e);return!r.closed&&e.next(this._value),r},e.prototype.getValue=function(){var t=this.hasError,e=this.thrownError,r=this._value;if(t)throw e;return this._throwIfClosed(),r},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(z);const V=new Uint8Array(256);let R=V.length;function U(){return R>V.length-16&&(n.default.randomFillSync(V),R=0),V.slice(R,R+=16)}var L=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Y(t){return"string"==typeof t&&L.test(t)}const q=[];for(let t=0;t<256;++t)q.push((t+256).toString(16).substr(1));function K(t,e=0){const r=(q[t[e+0]]+q[t[e+1]]+q[t[e+2]]+q[t[e+3]]+"-"+q[t[e+4]]+q[t[e+5]]+"-"+q[t[e+6]]+q[t[e+7]]+"-"+q[t[e+8]]+q[t[e+9]]+"-"+q[t[e+10]]+q[t[e+11]]+q[t[e+12]]+q[t[e+13]]+q[t[e+14]]+q[t[e+15]]).toLowerCase();if(!Y(r))throw TypeError("Stringified UUID is invalid");return r}let W,G,H=0,J=0;function X(t){if(!Y(t))throw TypeError("Invalid UUID");let e;const r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=255&e,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=255&e,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=255&e,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=255&e,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=255&e,r}function Q(t,e,r){function n(t,n,o,i){if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));const e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}(t)),"string"==typeof n&&(n=X(n)),16!==n.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let a=new Uint8Array(16+t.length);if(a.set(n),a.set(t,n.length),a=r(a),a[6]=15&a[6]|e,a[8]=63&a[8]|128,o){i=i||0;for(let t=0;t<16;++t)o[i+t]=a[t];return o}return K(a)}try{n.name=t}catch(t){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n}var Z=Q("v3",48,(function(t){return Array.isArray(t)?t=Buffer.from(t):"string"==typeof t&&(t=Buffer.from(t,"utf8")),n.default.createHash("md5").update(t).digest()}));var tt=Q("v5",80,(function(t){return Array.isArray(t)?t=Buffer.from(t):"string"==typeof t&&(t=Buffer.from(t,"utf8")),n.default.createHash("sha1").update(t).digest()}));for(var et=Object.freeze({__proto__:null,v1:function(t,e,r){let n=e&&r||0;const o=e||new Array(16);let i=(t=t||{}).node||W,a=void 0!==t.clockseq?t.clockseq:G;if(null==i||null==a){const e=t.random||(t.rng||U)();null==i&&(i=W=[1|e[0],e[1],e[2],e[3],e[4],e[5]]),null==a&&(a=G=16383&(e[6]<<8|e[7]))}let u=void 0!==t.msecs?t.msecs:Date.now(),s=void 0!==t.nsecs?t.nsecs:J+1;const c=u-H+(s-J)/1e4;if(c<0&&void 0===t.clockseq&&(a=a+1&16383),(c<0||u>H)&&void 0===t.nsecs&&(s=0),s>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");H=u,J=s,G=a,u+=122192928e5;const f=(1e4*(268435455&u)+s)%4294967296;o[n++]=f>>>24&255,o[n++]=f>>>16&255,o[n++]=f>>>8&255,o[n++]=255&f;const l=u/4294967296*1e4&268435455;o[n++]=l>>>8&255,o[n++]=255&l,o[n++]=l>>>24&15|16,o[n++]=l>>>16&255,o[n++]=a>>>8|128,o[n++]=255&a;for(let t=0;t<6;++t)o[n+t]=i[t];return e||K(o)},v3:Z,v4:function(t,e,r){const n=(t=t||{}).random||(t.rng||U)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){r=r||0;for(let t=0;t<16;++t)e[r+t]=n[t];return e}return K(n)},v5:tt,NIL:"00000000-0000-0000-0000-000000000000",version:function(t){if(!Y(t))throw TypeError("Invalid UUID");return parseInt(t.substr(14,1),16)},validate:Y,stringify:K,parse:X}),rt="function"==typeof n.default.randomUUID?n.default.randomUUID:et.v4,nt=[],ot={},it=0;it<256;it++)nt[it]=(it+256).toString(16).substr(1),ot[nt[it]]=it;var at={parse:function(t,e,r){var n=e&&r||0,o=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,(function(t){o<16&&(e[n+o++]=ot[t])}));o<16;)e[n+o++]=0;return e},unparse:function(t,e){var r=e||0,n=nt;return n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]}};const ut=Math.pow(2,31)-1,st=o.default.Buffer;function ct(t,e){let r=st.from(at.parse(t)).toString("base64");const n=r.length;return e?("="===r[n-2]&&"="===r[n-1]&&(r=r.substr(0,n-2)+"-"),r.replace(/\+/g,"_").replace(/\//g,"-")):"="===r[n-2]&&"="===r[n-1]?r.substr(0,n-2)+"/":r}function ft(t,e){!!(e=e||{}).urlSafe&&(t=t.replace(/-/g,"/").replace(/_/g,"+"));const r=t.lastIndexOf("/");if(-1===r)return null;const n=t.substring(0,r),o=Number(t.substring(r+1));if(!n||isNaN(o))return null;return{uuid:at.unparse(st.from(n+"==","base64")),count:o}}var lt=function(t){let e=!1,r=!1;"boolean"==typeof t?e=t:(r=!!(t=t||{}).urlSafe,e=!!t.fixedLength),i.uuid=rt(),i.decode=ft;let n=ct(i.uuid,r),o=Math.floor(t.startFrom||0);if(isNaN(o)||!(ut>o&&o>=0))throw new Error([`when passed, opts.startFrom must be a number between 0 and ${ut}.`,"Only the integer part matters.","- got: "+t.startFrom].join("\n"));return i;function i(){const t=e?n+function(t){return t<10?"000000000"+t:t<100?"00000000"+t:t<1e3?"0000000"+t:t<1e4?"000000"+t:t<1e5?"00000"+t:t<1e6?"0000"+t:t<1e7?"000"+t:t<1e8?"00"+t:t<1e9?"0"+t:t}(o++):n+o++;return o===ut&&(i.uuid=rt(),n=ct(i.uuid,r),o=0),t}},ht=ft;lt.decode=ht;const pt=lt();function vt(){return pt()}var dt=Object.freeze({__proto__:null,default:vt});function yt(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];if("production"!==process.env.NODE_ENV){var o=oe[t],i=o?"function"==typeof o?o.apply(null,r):o:"unknown error nr: "+t;throw Error("[Immer] "+i)}throw Error("[Immer] minified error nr: "+t+(r.length?" "+r.map((function(t){return"'"+t+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function bt(t){return!!t&&!!t[re]}function _t(t){return!!t&&(function(t){if(!t||"object"!=typeof t)return!1;var e=Object.getPrototypeOf(t);if(null===e)return!0;var r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===ie}(t)||Array.isArray(t)||!!t[ee]||!!t.constructor[ee]||Et(t)||jt(t))}function gt(t,e,r){void 0===r&&(r=!1),0===mt(t)?(r?Object.keys:ae)(t).forEach((function(n){r&&"symbol"==typeof n||e(n,t[n],t)})):t.forEach((function(r,n){return e(n,r,t)}))}function mt(t){var e=t[re];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:Et(t)?2:jt(t)?3:0}function $t(t,e){return 2===mt(t)?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function wt(t,e,r){var n=mt(t);2===n?t.set(e,r):3===n?(t.delete(e),t.add(r)):t[e]=r}function Et(t){return Xt&&t instanceof Map}function jt(t){return Qt&&t instanceof Set}function Ot(t){return t.o||t.t}function St(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=ue(t);delete e[re];for(var r=ae(e),n=0;n<r.length;n++){var o=r[n],i=e[o];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(e[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:t[o]})}return Object.create(Object.getPrototypeOf(t),e)}function At(t,e){return void 0===e&&(e=!1),xt(t)||bt(t)||!_t(t)||(mt(t)>1&&(t.set=t.add=t.clear=t.delete=Pt),Object.freeze(t),e&&gt(t,(function(t,e){return At(e,!0)}),!0)),t}function Pt(){yt(2)}function xt(t){return null==t||"object"!=typeof t||Object.isFrozen(t)}function Tt(t){var e=se[t];return e||yt(18,t),e}function Ct(){return"production"===process.env.NODE_ENV||Ht||yt(0),Ht}function kt(t,e){e&&(Tt("Patches"),t.u=[],t.s=[],t.v=e)}function It(t){Nt(t),t.p.forEach(Mt),t.p=null}function Nt(t){t===Ht&&(Ht=t.l)}function Dt(t){return Ht={p:[],l:Ht,h:t,m:!0,_:0}}function Mt(t){var e=t[re];0===e.i||1===e.i?e.j():e.O=!0}function zt(t,e){e._=e.p.length;var r=e.p[0],n=void 0!==t&&t!==r;return e.h.g||Tt("ES5").S(e,t,n),n?(r[re].P&&(It(e),yt(4)),_t(t)&&(t=Bt(e,t),e.l||Vt(e,t)),e.u&&Tt("Patches").M(r[re],t,e.u,e.s)):t=Bt(e,r,[]),It(e),e.u&&e.v(e.u,e.s),t!==te?t:void 0}function Bt(t,e,r){if(xt(e))return e;var n=e[re];if(!n)return gt(e,(function(o,i){return Ft(t,n,e,o,i,r)}),!0),e;if(n.A!==t)return e;if(!n.P)return Vt(t,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var o=4===n.i||5===n.i?n.o=St(n.k):n.o;gt(3===n.i?new Set(o):o,(function(e,i){return Ft(t,n,o,e,i,r)})),Vt(t,o,!1),r&&t.u&&Tt("Patches").R(n,r,t.u,t.s)}return n.o}function Ft(t,e,r,n,o,i){if("production"!==process.env.NODE_ENV&&o===r&&yt(5),bt(o)){var a=Bt(t,o,i&&e&&3!==e.i&&!$t(e.D,n)?i.concat(n):void 0);if(wt(r,n,a),!bt(a))return;t.m=!1}if(_t(o)&&!xt(o)){if(!t.h.F&&t._<1)return;Bt(t,o),e&&e.A.l||Vt(t,o)}}function Vt(t,e,r){void 0===r&&(r=!1),t.h.F&&t.m&&At(e,r)}function Rt(t,e){var r=t[re];return(r?Ot(r):t)[e]}function Ut(t,e){if(e in t)for(var r=Object.getPrototypeOf(t);r;){var n=Object.getOwnPropertyDescriptor(r,e);if(n)return n;r=Object.getPrototypeOf(r)}}function Lt(t){t.P||(t.P=!0,t.l&&Lt(t.l))}function Yt(t){t.o||(t.o=St(t.t))}function qt(t,e,r){var n=Et(e)?Tt("MapSet").N(e,r):jt(e)?Tt("MapSet").T(e,r):t.g?function(t,e){var r=Array.isArray(t),n={i:r?1:0,A:e?e.A:Ct(),P:!1,I:!1,D:{},l:e,t:t,k:null,o:null,j:null,C:!1},o=n,i=ce;r&&(o=[n],i=fe);var a=Proxy.revocable(o,i),u=a.revoke,s=a.proxy;return n.k=s,n.j=u,s}(e,r):Tt("ES5").J(e,r);return(r?r.A:Ct()).p.push(n),n}function Kt(t){return bt(t)||yt(22,t),function t(e){if(!_t(e))return e;var r,n=e[re],o=mt(e);if(n){if(!n.P&&(n.i<4||!Tt("ES5").K(n)))return n.t;n.I=!0,r=Wt(e,o),n.I=!1}else r=Wt(e,o);return gt(r,(function(e,o){n&&function(t,e){return 2===mt(t)?t.get(e):t[e]}(n.t,e)===o||wt(r,e,t(o))})),3===o?new Set(r):r}(t)}function Wt(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return St(t)}var Gt,Ht,Jt="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),Xt="undefined"!=typeof Map,Qt="undefined"!=typeof Set,Zt="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,te=Jt?Symbol.for("immer-nothing"):((Gt={})["immer-nothing"]=!0,Gt),ee=Jt?Symbol.for("immer-draftable"):"__$immer_draftable",re=Jt?Symbol.for("immer-state"):"__$immer_state",ne="undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator",oe={0:"Illegal state",1:"Immer drafts cannot have computed properties",2:"This object has been frozen and should not be mutated",3:function(t){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+t},4:"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.",5:"Immer forbids circular references",6:"The first or second argument to `produce` must be a function",7:"The third argument to `produce` must be a function or undefined",8:"First argument to `createDraft` must be a plain object, an array, or an immerable object",9:"First argument to `finishDraft` must be a draft returned by `createDraft`",10:"The given draft is already finalized",11:"Object.defineProperty() cannot be used on an Immer draft",12:"Object.setPrototypeOf() cannot be used on an Immer draft",13:"Immer only supports deleting array indices",14:"Immer only supports setting array indices and the 'length' property",15:function(t){return"Cannot apply patch, path doesn't resolve: "+t},16:'Sets cannot have "replace" patches.',17:function(t){return"Unsupported patch operation: "+t},18:function(t){return"The plugin for '"+t+"' has not been loaded into Immer. To enable the plugin, import and call `enable"+t+"()` when initializing your application."},20:"Cannot use proxies if Proxy, Proxy.revocable or Reflect are not available",21:function(t){return"produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '"+t+"'"},22:function(t){return"'current' expects a draft, got: "+t},23:function(t){return"'original' expects a draft, got: "+t},24:"Patching reserved attributes like __proto__, prototype and constructor is not allowed"},ie=""+Object.prototype.constructor,ae="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,ue=Object.getOwnPropertyDescriptors||function(t){var e={};return ae(t).forEach((function(r){e[r]=Object.getOwnPropertyDescriptor(t,r)})),e},se={},ce={get:function(t,e){if(e===re)return t;var r=Ot(t);if(!$t(r,e))return function(t,e,r){var n,o=Ut(e,r);return o?"value"in o?o.value:null===(n=o.get)||void 0===n?void 0:n.call(t.k):void 0}(t,r,e);var n=r[e];return t.I||!_t(n)?n:n===Rt(t.t,e)?(Yt(t),t.o[e]=qt(t.A.h,n,t)):n},has:function(t,e){return e in Ot(t)},ownKeys:function(t){return Reflect.ownKeys(Ot(t))},set:function(t,e,r){var n=Ut(Ot(t),e);if(null==n?void 0:n.set)return n.set.call(t.k,r),!0;if(!t.P){var o=Rt(Ot(t),e),i=null==o?void 0:o[re];if(i&&i.t===r)return t.o[e]=r,t.D[e]=!1,!0;if(function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}(r,o)&&(void 0!==r||$t(t.t,e)))return!0;Yt(t),Lt(t)}return t.o[e]===r&&"number"!=typeof r&&(void 0!==r||e in t.o)||(t.o[e]=r,t.D[e]=!0,!0)},deleteProperty:function(t,e){return void 0!==Rt(t.t,e)||e in t.t?(t.D[e]=!1,Yt(t),Lt(t)):delete t.D[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var r=Ot(t),n=Reflect.getOwnPropertyDescriptor(r,e);return n?{writable:!0,configurable:1!==t.i||"length"!==e,enumerable:n.enumerable,value:r[e]}:n},defineProperty:function(){yt(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){yt(12)}},fe={};gt(ce,(function(t,e){fe[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}})),fe.deleteProperty=function(t,e){return"production"!==process.env.NODE_ENV&&isNaN(parseInt(e))&&yt(13),ce.deleteProperty.call(this,t[0],e)},fe.set=function(t,e,r){return"production"!==process.env.NODE_ENV&&"length"!==e&&isNaN(parseInt(e))&&yt(14),ce.set.call(this,t[0],e,r,t[0])};var le=new(function(){function t(t){var e=this;this.g=Zt,this.F=!0,this.produce=function(t,r,n){if("function"==typeof t&&"function"!=typeof r){var o=r;r=t;var i=e;return function(t){var e=this;void 0===t&&(t=o);for(var n=arguments.length,a=Array(n>1?n-1:0),u=1;u<n;u++)a[u-1]=arguments[u];return i.produce(t,(function(t){var n;return(n=r).call.apply(n,[e,t].concat(a))}))}}var a;if("function"!=typeof r&&yt(6),void 0!==n&&"function"!=typeof n&&yt(7),_t(t)){var u=Dt(e),s=qt(e,t,void 0),c=!0;try{a=r(s),c=!1}finally{c?It(u):Nt(u)}return"undefined"!=typeof Promise&&a instanceof Promise?a.then((function(t){return kt(u,n),zt(t,u)}),(function(t){throw It(u),t})):(kt(u,n),zt(a,u))}if(!t||"object"!=typeof t){if((a=r(t))===te)return;return void 0===a&&(a=t),e.F&&At(a,!0),a}yt(21,t)},this.produceWithPatches=function(t,r){return"function"==typeof t?function(r){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];return e.produceWithPatches(r,(function(e){return t.apply(void 0,[e].concat(o))}))}:[e.produce(t,r,(function(t,e){n=t,o=e})),n,o];var n,o},"boolean"==typeof(null==t?void 0:t.useProxies)&&this.setUseProxies(t.useProxies),"boolean"==typeof(null==t?void 0:t.autoFreeze)&&this.setAutoFreeze(t.autoFreeze)}var e=t.prototype;return e.createDraft=function(t){_t(t)||yt(8),bt(t)&&(t=Kt(t));var e=Dt(this),r=qt(this,t,void 0);return r[re].C=!0,Nt(e),r},e.finishDraft=function(t,e){var r=t&&t[re];"production"!==process.env.NODE_ENV&&(r&&r.C||yt(9),r.I&&yt(10));var n=r.A;return kt(n,e),zt(void 0,n)},e.setAutoFreeze=function(t){this.F=t},e.setUseProxies=function(t){t&&!Zt&&yt(20),this.g=t},e.applyPatches=function(t,e){var r;for(r=e.length-1;r>=0;r--){var n=e[r];if(0===n.path.length&&"replace"===n.op){t=n.value;break}}var o=Tt("Patches").$;return bt(t)?o(t,e):this.produce(t,(function(t){return o(t,e.slice(r+1))}))},t}()),he=le.produce;le.produceWithPatches.bind(le),le.setAutoFreeze.bind(le),le.setUseProxies.bind(le),le.applyPatches.bind(le),le.createDraft.bind(le),le.finishDraft.bind(le);var pe=function(){this.__data__=[],this.size=0};var ve=function(t,e){return t===e||t!=t&&e!=e};var de=function(t,e){for(var r=t.length;r--;)if(ve(t[r][0],e))return r;return-1},ye=Array.prototype.splice;var be=function(t){var e=this.__data__,r=de(e,t);return!(r<0)&&(r==e.length-1?e.pop():ye.call(e,r,1),--this.size,!0)};var _e=function(t){var e=this.__data__,r=de(e,t);return r<0?void 0:e[r][1]};var ge=function(t){return de(this.__data__,t)>-1};var me=function(t,e){var r=this.__data__,n=de(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function $e(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}$e.prototype.clear=pe,$e.prototype.delete=be,$e.prototype.get=_e,$e.prototype.has=ge,$e.prototype.set=me;var we=$e;var Ee=function(){this.__data__=new we,this.size=0};var je=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var Oe=function(t){return this.__data__.get(t)};var Se=function(t){return this.__data__.has(t)},Ae="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Pe(t,e){return t(e={exports:{}},e.exports),e.exports}var xe="object"==typeof Ae&&Ae&&Ae.Object===Object&&Ae,Te="object"==typeof self&&self&&self.Object===Object&&self,Ce=xe||Te||Function("return this")(),ke=Ce.Symbol,Ie=Object.prototype,Ne=Ie.hasOwnProperty,De=Ie.toString,Me=ke?ke.toStringTag:void 0;var ze=function(t){var e=Ne.call(t,Me),r=t[Me];try{t[Me]=void 0;var n=!0}catch(t){}var o=De.call(t);return n&&(e?t[Me]=r:delete t[Me]),o},Be=Object.prototype.toString;var Fe=function(t){return Be.call(t)},Ve=ke?ke.toStringTag:void 0;var Re=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Ve&&Ve in Object(t)?ze(t):Fe(t)};var Ue=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var Le,Ye=function(t){if(!Ue(t))return!1;var e=Re(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},qe=Ce["__core-js_shared__"],Ke=(Le=/[^.]+$/.exec(qe&&qe.keys&&qe.keys.IE_PROTO||""))?"Symbol(src)_1."+Le:"";var We=function(t){return!!Ke&&Ke in t},Ge=Function.prototype.toString;var He=function(t){if(null!=t){try{return Ge.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Je=/^\[object .+?Constructor\]$/,Xe=Function.prototype,Qe=Object.prototype,Ze=Xe.toString,tr=Qe.hasOwnProperty,er=RegExp("^"+Ze.call(tr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var rr=function(t){return!(!Ue(t)||We(t))&&(Ye(t)?er:Je).test(He(t))};var nr=function(t,e){return null==t?void 0:t[e]};var or=function(t,e){var r=nr(t,e);return rr(r)?r:void 0},ir=or(Ce,"Map"),ar=or(Object,"create");var ur=function(){this.__data__=ar?ar(null):{},this.size=0};var sr=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},cr=Object.prototype.hasOwnProperty;var fr=function(t){var e=this.__data__;if(ar){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return cr.call(e,t)?e[t]:void 0},lr=Object.prototype.hasOwnProperty;var hr=function(t){var e=this.__data__;return ar?void 0!==e[t]:lr.call(e,t)};var pr=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=ar&&void 0===e?"__lodash_hash_undefined__":e,this};function vr(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}vr.prototype.clear=ur,vr.prototype.delete=sr,vr.prototype.get=fr,vr.prototype.has=hr,vr.prototype.set=pr;var dr=vr;var yr=function(){this.size=0,this.__data__={hash:new dr,map:new(ir||we),string:new dr}};var br=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var _r=function(t,e){var r=t.__data__;return br(e)?r["string"==typeof e?"string":"hash"]:r.map};var gr=function(t){var e=_r(this,t).delete(t);return this.size-=e?1:0,e};var mr=function(t){return _r(this,t).get(t)};var $r=function(t){return _r(this,t).has(t)};var wr=function(t,e){var r=_r(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function Er(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Er.prototype.clear=yr,Er.prototype.delete=gr,Er.prototype.get=mr,Er.prototype.has=$r,Er.prototype.set=wr;var jr=Er;var Or=function(t,e){var r=this.__data__;if(r instanceof we){var n=r.__data__;if(!ir||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new jr(n)}return r.set(t,e),this.size=r.size,this};function Sr(t){var e=this.__data__=new we(t);this.size=e.size}Sr.prototype.clear=Ee,Sr.prototype.delete=je,Sr.prototype.get=Oe,Sr.prototype.has=Se,Sr.prototype.set=Or;var Ar=Sr;var Pr=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var xr=function(t){return this.__data__.has(t)};function Tr(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new jr;++e<r;)this.add(t[e])}Tr.prototype.add=Tr.prototype.push=Pr,Tr.prototype.has=xr;var Cr=Tr;var kr=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1};var Ir=function(t,e){return t.has(e)};var Nr=function(t,e,r,n,o,i){var a=1&r,u=t.length,s=e.length;if(u!=s&&!(a&&s>u))return!1;var c=i.get(t),f=i.get(e);if(c&&f)return c==e&&f==t;var l=-1,h=!0,p=2&r?new Cr:void 0;for(i.set(t,e),i.set(e,t);++l<u;){var v=t[l],d=e[l];if(n)var y=a?n(d,v,l,e,t,i):n(v,d,l,t,e,i);if(void 0!==y){if(y)continue;h=!1;break}if(p){if(!kr(e,(function(t,e){if(!Ir(p,e)&&(v===t||o(v,t,r,n,i)))return p.push(e)}))){h=!1;break}}else if(v!==d&&!o(v,d,r,n,i)){h=!1;break}}return i.delete(t),i.delete(e),h},Dr=Ce.Uint8Array;var Mr=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r};var zr=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},Br=ke?ke.prototype:void 0,Fr=Br?Br.valueOf:void 0;var Vr=function(t,e,r,n,o,i,a){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new Dr(t),new Dr(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ve(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var u=Mr;case"[object Set]":var s=1&n;if(u||(u=zr),t.size!=e.size&&!s)return!1;var c=a.get(t);if(c)return c==e;n|=2,a.set(t,e);var f=Nr(u(t),u(e),n,o,i,a);return a.delete(t),f;case"[object Symbol]":if(Fr)return Fr.call(t)==Fr.call(e)}return!1};var Rr=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},Ur=Array.isArray;var Lr=function(t,e,r){var n=e(t);return Ur(t)?n:Rr(n,r(t))};var Yr=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[o++]=a)}return i};var qr=function(){return[]},Kr=Object.prototype.propertyIsEnumerable,Wr=Object.getOwnPropertySymbols,Gr=Wr?function(t){return null==t?[]:(t=Object(t),Yr(Wr(t),(function(e){return Kr.call(t,e)})))}:qr;var Hr=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var Jr=function(t){return null!=t&&"object"==typeof t};var Xr=function(t){return Jr(t)&&"[object Arguments]"==Re(t)},Qr=Object.prototype,Zr=Qr.hasOwnProperty,tn=Qr.propertyIsEnumerable,en=Xr(function(){return arguments}())?Xr:function(t){return Jr(t)&&Zr.call(t,"callee")&&!tn.call(t,"callee")};var rn=function(){return!1},nn=Pe((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?Ce.Buffer:void 0,i=(o?o.isBuffer:void 0)||rn;t.exports=i})),on=/^(?:0|[1-9]\d*)$/;var an=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&on.test(t))&&t>-1&&t%1==0&&t<e};var un=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},sn={};sn["[object Float32Array]"]=sn["[object Float64Array]"]=sn["[object Int8Array]"]=sn["[object Int16Array]"]=sn["[object Int32Array]"]=sn["[object Uint8Array]"]=sn["[object Uint8ClampedArray]"]=sn["[object Uint16Array]"]=sn["[object Uint32Array]"]=!0,sn["[object Arguments]"]=sn["[object Array]"]=sn["[object ArrayBuffer]"]=sn["[object Boolean]"]=sn["[object DataView]"]=sn["[object Date]"]=sn["[object Error]"]=sn["[object Function]"]=sn["[object Map]"]=sn["[object Number]"]=sn["[object Object]"]=sn["[object RegExp]"]=sn["[object Set]"]=sn["[object String]"]=sn["[object WeakMap]"]=!1;var cn=function(t){return Jr(t)&&un(t.length)&&!!sn[Re(t)]};var fn=function(t){return function(e){return t(e)}},ln=Pe((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&xe.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),hn=ln&&ln.isTypedArray,pn=hn?fn(hn):cn,vn=Object.prototype.hasOwnProperty;var dn=function(t,e){var r=Ur(t),n=!r&&en(t),o=!r&&!n&&nn(t),i=!r&&!n&&!o&&pn(t),a=r||n||o||i,u=a?Hr(t.length,String):[],s=u.length;for(var c in t)!e&&!vn.call(t,c)||a&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||an(c,s))||u.push(c);return u},yn=Object.prototype;var bn=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||yn)};var _n=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),gn=Object.prototype.hasOwnProperty;var mn=function(t){if(!bn(t))return _n(t);var e=[];for(var r in Object(t))gn.call(t,r)&&"constructor"!=r&&e.push(r);return e};var $n=function(t){return null!=t&&un(t.length)&&!Ye(t)};var wn=function(t){return $n(t)?dn(t):mn(t)};var En=function(t){return Lr(t,wn,Gr)},jn=Object.prototype.hasOwnProperty;var On=function(t,e,r,n,o,i){var a=1&r,u=En(t),s=u.length;if(s!=En(e).length&&!a)return!1;for(var c=s;c--;){var f=u[c];if(!(a?f in e:jn.call(e,f)))return!1}var l=i.get(t),h=i.get(e);if(l&&h)return l==e&&h==t;var p=!0;i.set(t,e),i.set(e,t);for(var v=a;++c<s;){var d=t[f=u[c]],y=e[f];if(n)var b=a?n(y,d,f,e,t,i):n(d,y,f,t,e,i);if(!(void 0===b?d===y||o(d,y,r,n,i):b)){p=!1;break}v||(v="constructor"==f)}if(p&&!v){var _=t.constructor,g=e.constructor;_==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof g&&g instanceof g||(p=!1)}return i.delete(t),i.delete(e),p},Sn=or(Ce,"DataView"),An=or(Ce,"Promise"),Pn=or(Ce,"Set"),xn=or(Ce,"WeakMap"),Tn=He(Sn),Cn=He(ir),kn=He(An),In=He(Pn),Nn=He(xn),Dn=Re;(Sn&&"[object DataView]"!=Dn(new Sn(new ArrayBuffer(1)))||ir&&"[object Map]"!=Dn(new ir)||An&&"[object Promise]"!=Dn(An.resolve())||Pn&&"[object Set]"!=Dn(new Pn)||xn&&"[object WeakMap]"!=Dn(new xn))&&(Dn=function(t){var e=Re(t),r="[object Object]"==e?t.constructor:void 0,n=r?He(r):"";if(n)switch(n){case Tn:return"[object DataView]";case Cn:return"[object Map]";case kn:return"[object Promise]";case In:return"[object Set]";case Nn:return"[object WeakMap]"}return e});var Mn=Dn,zn="[object Object]",Bn=Object.prototype.hasOwnProperty;var Fn=function(t,e,r,n,o,i){var a=Ur(t),u=Ur(e),s=a?"[object Array]":Mn(t),c=u?"[object Array]":Mn(e),f=(s="[object Arguments]"==s?zn:s)==zn,l=(c="[object Arguments]"==c?zn:c)==zn,h=s==c;if(h&&nn(t)){if(!nn(e))return!1;a=!0,f=!1}if(h&&!f)return i||(i=new Ar),a||pn(t)?Nr(t,e,r,n,o,i):Vr(t,e,s,r,n,o,i);if(!(1&r)){var p=f&&Bn.call(t,"__wrapped__"),v=l&&Bn.call(e,"__wrapped__");if(p||v){var d=p?t.value():t,y=v?e.value():e;return i||(i=new Ar),o(d,y,r,n,i)}}return!!h&&(i||(i=new Ar),On(t,e,r,n,o,i))};var Vn=function t(e,r,n,o,i){return e===r||(null==e||null==r||!Jr(e)&&!Jr(r)?e!=e&&r!=r:Fn(e,r,n,o,t,i))};var Rn=function(t,e){return Vn(t,e)};var Un=function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1};var Ln=function(t){return t!=t};var Yn=function(t,e,r){for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1};var qn=function(t,e,r){return e==e?Yn(t,e,r):Un(t,Ln,r)};var Kn=function(t,e){return!!(null==t?0:t.length)&&qn(t,e,0)>-1};var Wn=function(t,e,r){for(var n=-1,o=null==t?0:t.length;++n<o;)if(r(e,t[n]))return!0;return!1};var Gn=function(){},Hn=Pn&&1/zr(new Pn([,-0]))[1]==1/0?function(t){return new Pn(t)}:Gn;var Jn=function(t,e,r){var n=-1,o=Kn,i=t.length,a=!0,u=[],s=u;if(r)a=!1,o=Wn;else if(i>=200){var c=e?null:Hn(t);if(c)return zr(c);a=!1,o=Ir,s=new Cr}else s=e?[]:u;t:for(;++n<i;){var f=t[n],l=e?e(f):f;if(f=r||0!==f?f:0,a&&l==l){for(var h=s.length;h--;)if(s[h]===l)continue t;e&&s.push(l),u.push(f)}else o(s,l,r)||(s!==u&&s.push(l),u.push(f))}return u};var Xn=function(t){return t&&t.length?Jn(t):[]};var Qn=function(t){return"symbol"==typeof t||Jr(t)&&"[object Symbol]"==Re(t)},Zn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,to=/^\w*$/;var eo=function(t,e){if(Ur(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!Qn(t))||(to.test(t)||!Zn.test(t)||null!=e&&t in Object(e))};function ro(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var a=t.apply(this,n);return r.cache=i.set(o,a)||i,a};return r.cache=new(ro.Cache||jr),r}ro.Cache=jr;var no=ro;var oo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,io=/\\(\\)?/g,ao=function(t){var e=no(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(oo,(function(t,r,n,o){e.push(n?o.replace(io,"$1"):r||t)})),e}));var uo=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},so=ke?ke.prototype:void 0,co=so?so.toString:void 0;var fo=function t(e){if("string"==typeof e)return e;if(Ur(e))return uo(e,t)+"";if(Qn(e))return co?co.call(e):"";var r=e+"";return"0"==r&&1/e==-1/0?"-0":r};var lo=function(t){return null==t?"":fo(t)};var ho=function(t,e){return Ur(t)?t:eo(t,e)?[t]:ao(lo(t))};var po=function(t){if("string"==typeof t||Qn(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e};var vo=function(t,e){for(var r=0,n=(e=ho(e,t)).length;null!=t&&r<n;)t=t[po(e[r++])];return r&&r==n?t:void 0};var yo=function(t,e,r){var n=null==t?void 0:vo(t,e);return void 0===n?r:n},bo=ke?ke.isConcatSpreadable:void 0;var _o=function(t){return Ur(t)||en(t)||!!(bo&&t&&t[bo])};var go=function t(e,r,n,o,i){var a=-1,u=e.length;for(n||(n=_o),i||(i=[]);++a<u;){var s=e[a];r>0&&n(s)?r>1?t(s,r-1,n,o,i):Rr(i,s):o||(i[i.length]=s)}return i};var mo=function(t,e,r,n){var o=r.length,i=o,a=!n;if(null==t)return!i;for(t=Object(t);o--;){var u=r[o];if(a&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++o<i;){var s=(u=r[o])[0],c=t[s],f=u[1];if(a&&u[2]){if(void 0===c&&!(s in t))return!1}else{var l=new Ar;if(n)var h=n(c,f,s,t,e,l);if(!(void 0===h?Vn(f,c,3,n,l):h))return!1}}return!0};var $o=function(t){return t==t&&!Ue(t)};var wo=function(t){for(var e=wn(t),r=e.length;r--;){var n=e[r],o=t[n];e[r]=[n,o,$o(o)]}return e};var Eo=function(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}};var jo=function(t){var e=wo(t);return 1==e.length&&e[0][2]?Eo(e[0][0],e[0][1]):function(r){return r===t||mo(r,t,e)}};var Oo=function(t,e){return null!=t&&e in Object(t)};var So=function(t,e,r){for(var n=-1,o=(e=ho(e,t)).length,i=!1;++n<o;){var a=po(e[n]);if(!(i=null!=t&&r(t,a)))break;t=t[a]}return i||++n!=o?i:!!(o=null==t?0:t.length)&&un(o)&&an(a,o)&&(Ur(t)||en(t))};var Ao=function(t,e){return null!=t&&So(t,e,Oo)};var Po=function(t,e){return eo(t)&&$o(e)?Eo(po(t),e):function(r){var n=yo(r,t);return void 0===n&&n===e?Ao(r,t):Vn(e,n,3)}};var xo=function(t){return t};var To=function(t){return function(e){return null==e?void 0:e[t]}};var Co=function(t){return function(e){return vo(e,t)}};var ko=function(t){return eo(t)?To(po(t)):Co(t)};var Io=function(t){return"function"==typeof t?t:null==t?xo:"object"==typeof t?Ur(t)?Po(t[0],t[1]):jo(t):ko(t)};var No=function(t){return function(e,r,n){for(var o=-1,i=Object(e),a=n(e),u=a.length;u--;){var s=a[t?u:++o];if(!1===r(i[s],s,i))break}return e}}();var Do=function(t,e){return function(r,n){if(null==r)return r;if(!$n(r))return t(r,n);for(var o=r.length,i=e?o:-1,a=Object(r);(e?i--:++i<o)&&!1!==n(a[i],i,a););return r}}((function(t,e){return t&&No(t,e,wn)}));var Mo=function(t,e){var r=-1,n=$n(t)?Array(t.length):[];return Do(t,(function(t,o,i){n[++r]=e(t,o,i)})),n};var zo=function(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t};var Bo=function(t,e){if(t!==e){var r=void 0!==t,n=null===t,o=t==t,i=Qn(t),a=void 0!==e,u=null===e,s=e==e,c=Qn(e);if(!u&&!c&&!i&&t>e||i&&a&&s&&!u&&!c||n&&a&&s||!r&&s||!o)return 1;if(!n&&!i&&!c&&t<e||c&&r&&o&&!n&&!i||u&&r&&o||!a&&o||!s)return-1}return 0};var Fo=function(t,e,r){for(var n=-1,o=t.criteria,i=e.criteria,a=o.length,u=r.length;++n<a;){var s=Bo(o[n],i[n]);if(s)return n>=u?s:s*("desc"==r[n]?-1:1)}return t.index-e.index};var Vo=function(t,e,r){e=e.length?uo(e,(function(t){return Ur(t)?function(e){return vo(e,1===t.length?t[0]:t)}:t})):[xo];var n=-1;e=uo(e,fn(Io));var o=Mo(t,(function(t,r,o){return{criteria:uo(e,(function(e){return e(t)})),index:++n,value:t}}));return zo(o,(function(t,e){return Fo(t,e,r)}))};var Ro=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},Uo=Math.max;var Lo=function(t,e,r){return e=Uo(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=Uo(n.length-e,0),a=Array(i);++o<i;)a[o]=n[e+o];o=-1;for(var u=Array(e+1);++o<e;)u[o]=n[o];return u[e]=r(a),Ro(t,this,u)}};var Yo=function(t){return function(){return t}},qo=function(){try{var t=or(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Ko=qo?function(t,e){return qo(t,"toString",{configurable:!0,enumerable:!1,value:Yo(e),writable:!0})}:xo,Wo=Date.now;var Go=function(t){var e=0,r=0;return function(){var n=Wo(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(Ko);var Ho=function(t,e,r){if(!Ue(r))return!1;var n=typeof e;return!!("number"==n?$n(r)&&an(e,r.length):"string"==n&&e in r)&&ve(r[e],t)},Jo=function(t,e){return Go(Lo(t,e,xo),t+"")}((function(t,e){if(null==t)return[];var r=e.length;return r>1&&Ho(t,e[0],e[1])?e=[]:r>2&&Ho(e[0],e[1],e[2])&&(e=[e[0]]),Vo(t,go(e,1),[])}));var Xo=function(t){for(var e=-1,r=null==t?0:t.length,n=0,o=[];++e<r;){var i=t[e];i&&(o[n++]=i)}return o};const Qo=Symbol("type:map"),Zo=Symbol("type:object"),ti=Symbol("type:value"),ei=Symbol("type:array"),ri=Symbol("type:mirror"),ni=Symbol("unnamed"),oi=Symbol("ABSENT"),ii=Symbol("next"),ai=Symbol("set"),ui=Symbol("debug"),si=Symbol("clean"),ci=Symbol("event:acceptFrom"),fi=Symbol("event:removeFrom"),li=Symbol("event:commit"),hi=Symbol("event:action"),pi=Symbol("event:mutate"),vi=Symbol("event:validate"),di=/^set(.+)$/i,yi=Symbol("mirror-event-state:active"),bi=Symbol("mirror-state:error"),_i=Symbol("mirror-state:stopped"),gi=Symbol("mirror-state:complete");var mi=Object.freeze({__proto__:null,TYPE_MAP:Qo,TYPE_OBJECT:Zo,TYPE_VALUE:ti,TYPE_ARRAY:ei,TYPE_MIRROR:ri,NAME_UNNAMED:ni,ABSENT:oi,EVENT_TYPE_NEXT:ii,EVENT_TYPE_SET:ai,EVENT_TYPE_DEBUG:ui,EVENT_TYPE_CLEAN:si,EVENT_TYPE_ACCEPT_FROM:ci,EVENT_TYPE_REMOVE_FROM:fi,EVENT_TYPE_FLUSH_ACTIVE:li,EVENT_TYPE_ACTION:hi,EVENT_TYPE_MUTATE:pi,EVENT_TYPE_VALIDATE:vi,SET_RE:di,MIRROR_EVENT_STATE_ACTIVE:yi,MIRROR_EVENT_STATE_ERROR:bi,MIRROR_EVENT_STATE_STOPPED:_i,MIRROR_EVENT_STATE_COMPLETE:gi});let $i=null;const wi=t=>t instanceof $i,Ei=(...t)=>new $i(...t),ji=require("lodash/isNumber");function Oi(t){return![oi,ni,void 0].includes(t)}function Si(t){return ki(t,!0)?t.charAt(0).toUpperCase()+t.slice(1):""}function Ai(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!(t instanceof Map)}function Pi(t,e=!1){return Array.isArray(t)&&(!e||t.length)}const xi=t=>t&&t instanceof Map,Ti=t=>"function"==typeof t,Ci=(t,e={})=>("string"==typeof t&&(t=new Error(t)),Oi(e)?Ai(e)||(e={notes:e}):e={},Object.assign(t,e));function ki(t,e=!1){return"string"==typeof t&&(!e||!!t)}function Ii(t){if(wi(t))return ri;let e=ti;return xi(t)&&(e=Qo),Pi(t)&&(e=ei),Ai(t)&&(e=Zo),e}function Ni(t,e,r=null){r||(r=Ii(t));let n=!1;switch(r){case ti:n=!1;break;case Zo:n=e in t;break;case Qo:n=t.has(e);break;case ei:n=!(!Pi(t)||Di(e))&&e<t.length;break;default:n=!1}return n}function Di(t){return!!ji(t)&&(t>=0&&!(t%2))}function Mi(t,e,r=oi){Oi(r)||(r=Ii(t));let n=t;switch(r){case Qo:n=new Map(t),e.forEach((t,e)=>{n.set(e,t)});break;case Zo:n={...t},Object.keys(e).forEach(t=>{n[t]=e[t]});break;case ei:n=[...t],e.forEach((t,e)=>{n[e]=t})}return n}function zi(t,e=oi){Oi(e)||(e=Ii(t));let r=t;switch(e){case Qo:r=new Map(t);break;case Zo:r={...t};break;case ei:r=[...t]}return r}function Bi(t,e,r=null){r||(r=Ii(t));let n=null;switch(r){case ti:n=null;break;case Zo:n=t[e];break;case Qo:n=t.get(e);break;case ei:n=t[e];break;default:n=null}return n}function Fi(t,e,r,n=null){switch(n||(n=Ii(t)),n){case Zo:t[e]=r;break;case Qo:t.set(e,r);break;case ei:t[e]=r}return t}function Vi(t,e){if(t instanceof Map)return e?new Map(t):t;const r=new Map;return Object.keys(t).forEach(e=>r.set(e,t[e])),r}function Ri(t){try{return he(t,t=>t)}catch(e){return t}}var Ui=Object.freeze({__proto__:null,lazy:function(t,e,r){const n=r(t,e);return Object.defineProperty(t,e,{value:n}),n},produce:he,isEqual:Rn,uniq:Xn,lGet:yo,sortBy:Jo,asImmer:Ri,compact:Xo,getKey:Bi,setKey:Fi,isNumber:ji,isThere:Oi,ucFirst:Si,isObj:Ai,isArr:Pi,isMap:xi,isFn:Ti,e:Ci,isStr:ki,typeOfValue:Ii,hasKey:Ni,isWhole:Di,amend:Mi,clone:zi,toMap:Vi,toObj:function(t,e=!1){if(!Ai(t)&&!xi(t))throw Ci("cannot convert target to object",{target:t});let r=t;return Ai(t)?e&&(r={...t}):xi(t)&&(r={},t.forEach((e,n)=>{if(ji(e)||ki(e,!0))try{r[n]=e}catch(e){console.warn("toObj map/object conversion -- skipping exporting of child key",n,"of ",t)}})),r}});let Li=0;class Yi{constructor(t,e,r){this.value=t,this.$type=e,this.$target=r,this.$id=vt(),this.$order=Li,Li+=1,this._state=yi}get state(){return this._state}set state(t){this.isStopped||(this._state=t)}get hasError(){return this.state===bi}get isStopped(){return this.state!==yi}matches(t){return t===this||t===this.$id}$isAfter(t){return ji(t)?this.$order>t:t instanceof Yi&&this.$isAfter(t.$order)}$isBefore(t){return ji(t)?this.$order<t:t instanceof Yi&&this.$isBefore(t.$order)}error(t){this.state=bi,this.thrownError=t}complete(){this.state=gi}}var qi=t=>class extends t{constructor(...t){super(...t),this.$on(ii,(t,e,r)=>{r.$_addToChangeBuffer(e)}),this.$on(li,(t,e,r)=>{t.hasError&&(r.$root.$send(fi,t.$order,!0),e.error(t.thrownError)),r.$root.$send(ci,t.$order)}),this.$on(fi,(t,e,r)=>{r.$children.forEach(e=>{e.$send(fi,t,!0)}),r.$_removeFromBuffer(t,!0)}),this.$on(ci,(t,e,r)=>{if(r.$_allBuffers.find(e=>e.$type===hi&&e.$isBefore(t)))return;r.$children.forEach(e=>{e.$send(ci,t)});const n=r.$lastChange;n&&!n.$isBefore(t)&&r.$next(n.value),r.$_removeFromBuffer(t,!0)})}get $events(){return this.$_events||(this.$_events=new z),this.$_events}get $_changeBuffer(){return this.$__buffer||(this.$__buffer=[]),this.$__buffer}get $_allBuffers(){if(this.$parent)return this.$root.$_downBuffers;let t=[...this.$_changeBuffer];return this.$_hasChildren&&this.$children.forEach(e=>{t=[...t,...e.$_downBuffers]}),Xo(t)}get $_downBuffers(){let t=[...this.$_changeBuffer];return this.$_hasChildren&&this.$children.forEach(e=>{t=[...t,...e.$_downBuffers]}),Xo(t)}set $_changeBuffer(t){Pi(t)&&(this.$__buffer=t,this.$watchActive&&this.$watchActive(t))}$_removeFromBuffer(t,e=!1){let r=[...this.$_changeBuffer];r=e?r.filter(e=>e.$isBefore(t)):ji(t)?r.filter(e=>e.$order!==t):r.filter(e=>!e.matches(t)),r.length!==this.$_changeBuffer.length&&(this.$_changeBuffer=r)}$_addToChangeBuffer(t){return this.$_changeBuffer=[...this.$_changeBuffer,t],t}get $lastChange(){return this.$__buffer?this.$_changeBuffer.reduce((t,e)=>e.$type!==ii||e.hasError?t:e,null):null}$send(t,e,r=!1){const n=new Yi(e,t,this);return this.$events.next(n),r&&!n.isStopped&&n.complete(),n}$on(t,e){const r=this;return this.$events.pipe((n=e=>e.$type===t,N((function(t,e){var r=0;t.subscribe(new D(e,(function(t){return n.call(o,t,r++)&&e.next(t)})))})))).subscribe({next(t){if(!t.isStopped)try{e(t.value,t,r)}catch(e){console.log("--- error on handler: ",e),t.isStopped||t.error(e)}}});var n,o}};function Ki(t){return t.$_doProxy?t.$_doProxy:"undefined"==typeof Proxy?function(t){const e={};switch(t.$_actions.forEach((t,r)=>{try{e[r]=t}catch(t){}}),t.$type){case Zo:Object.keys(t.value).forEach(r=>{const n="set"+Si(r);e[n]=e=>t.$set(r,e)});break;case Qo:t.value.keys().forEach(r=>{const n="set"+Si(r);e[n]=e=>t.$set(r,e)})}return e}(t):new Proxy(t,{get(t,e){if(t.$_actions.has(e))return t.$_actions.get(e);if(ki(e)){const r=e.match(di);if(r){const[e,n]=r;if(t.$keyFor(n))return e=>t.$set(n,e)}}return()=>{throw Ci("no action named",{name:e})}}})}var Wi=t=>class extends t{constructor(t,e,...r){super(t,e,...r),this.$_configActions(e),this.$on(hi,({fn:t,args:e},r,n)=>{if(!r.isStopped){n.$_addToChangeBuffer(r);try{const o=t(n,...e);r.value={...r.value,result:o}}catch(t){r.error(t)}n.$send(li,r,!0)}})}get $_actions(){return this.$__actions||(this.$__actions=new Map),this.$__actions}get $isInAction(){return!!this.$_allBuffers.find(({type:t,committed:e})=>!e&&t===hi)}$addAction(t,e){this.$_actions.set(t,(...t)=>this.$act(e,t)),"undefined"==typeof Proxy&&delete this.$_do}$act(t,e){const r=this.$send(hi,{fn:t,args:e},!0);if(r.hasError)throw r.thrownError;return r.value.result}get $do(){return this.$_do||(this.$_do=Ki(this)),this.$_do}$_configActions(t){if(!Ai(t))return;const{actions:e}=t;Ai(e)&&Object.keys(e).forEach(t=>{this.$addAction(t,e[t])})}$mutate(t){if(!Ti(t))throw Ci("$mutate expects function",{source:"$mutate",fn:t});if(this.$_mutable)return this.next(t(zi(this.value)));let e=this.value;try{e=he(this.value,t)}catch(r){e=this.next(t(zi(this.value)))}this.next(e)}},Gi=t=>class extends t{constructor(t,e,...r){super(t,e,...r),this.$_configProps(e),this.$_hasSelectors&&this.next(this.$_withSelectors(this.value))}$_configProps(t){if(!Ai(t))return;const{fixed:e,selectors:r}=t;this.$isFixed=!!e,r&&Vi(r).forEach((t,e)=>{Ti(t)&&ki(e,!0)&&this.$addSelector(e,t)})}get $type(){return Ii(this.getValue())}$set(t,e){const r=this.$keyFor(t);let n=this.$_mutable?zi(this.value):this.value;this.$_mutable?Fi(n,r,e):n=he(n,t=>{Fi(t,r,e)}),this.next(n)}$keyFor(t){const e=(""+t).toLowerCase();let r=t;switch(this.$type){case Zo:r=t in this.value?t:Array.from(Object.keys(this.value)).reduce((t,r)=>(""+r).toLowerCase()===e?r:t,t);break;case Qo:r=this.value.has(t)?t:Array.from(this.value.keys()).reduce((t,r)=>(""+r).toLowerCase()===e?r:t,t);break;case ei:if(!Di(t))throw Ci("non-whole key for array",{key:t});r=t}return r}$addSelector(t,e){this.$_selectors.set(t,e)}get $_selectors(){return this.$__selectors||(this.$__selectors=new Map),this.$__selectors}get $_hasSelectors(){return this.$__selectors&&this.$__selectors.size>0}$get(t){return Bi(this.value,t)}$_withSelectors(t){if(!this.$_hasSelectors)return t;const e=this,r=Ii(t);if(this.$_mutable){const n=zi(t);return this.$_selectors.forEach((o,i)=>{try{const a=o(t,e,i);Fi(n,i,a,r)}catch(t){console.warn("cannot compute ",i,":",t),Fi(n,i,{$error:t})}}),n}return he(t,n=>{e.$_selectors.forEach((o,i)=>{try{const a=o(t,e,i);Fi(n,i,a,r)}catch(t){console.warn("cannot compute ",i,":",t)}})})}},Hi=t=>class extends t{constructor(t,e,...r){super(t,e,...r),this.$_configChildren(e),this.$on(ii,(t,e,r)=>{if(!r.$_hasChildren)return;const n=Ii(t);r.$children.forEach((r,o)=>{if(!e.hasError&&Ni(t,o,n)){const i=r.$send(si,Bi(t,o,n));i.hasError&&e.error({error:i.thrownError,target:o,type:"clean"});const a=i.value;if(r.value===a||Rn(r.value,a))return;const u=r.$send(ii,a,!0);u.hasError?(r.$send(fi,u.$order),e.error({error:u.thrownError,target:o})):r.$send(vi,u)}})}),this.$on(vi,(t,e,r)=>{r.$_hasChildren&&!t.hasError&&r.$children.forEach(e=>{t.hasError||e.$send(vi,t)})})}get $root(){return this.$parent?this.$parent.$root:this}get $children(){return this.$_children||(this.$_children=new Map),this.$_children}get $_hasChildren(){return!!this.$_children&&this.$children.size}$hasChild(t){return!!this.$_hasChildren&&this.$children.has(t)}$addChild(t,e,r){wi(e)||(e=Ei(e,r)),e.$parent=this,e.$name=t;const n=this;this.$children.set(t,e),e.subscribe({next(e){if(n.$lastChange){if(Bi(n.$lastChange.value,t)!==e)try{Fi(n.$lastChange.value,t,e)}catch(r){n.$_mutable?n.$lastChange.value=Fi(n.$lastChange.value,t,e):n.$lastChange.value=he(n.$lastChange.value,r=>{Fi(r,t,e)})}}else{Bi(n.value,t)!==e&&(n.$_mutable?n.next(Fi(zi(n.value),t,e)):n.next(he(n.value,r=>{Fi(r,t,e)})))}}})}$_withChildValues(t=oi){let e=t;t===oi&&(e=this._value);const r=Ii(t);return this.$_hasChildren&&(this.$_mutable?this.$children.forEach((t,n)=>{const o=t.value;Bi(e,n,r)!==o&&(e=Fi(zi(e,r),n,o,r))}):e=he(e,t=>{this.$children.forEach((n,o)=>{const i=n.value;Bi(e,o,r)!==i&&Fi(t,o,i,r)})})),e}$_configChildren(t){if(!Ai(t))return;const{children:e}=t;if(e)switch(Ii(e)){case Zo:Object.keys(e).forEach(t=>{const r=e[t];this.$addChild(t,r)});break;case Qo:e.forEach((t,e)=>{this.$addChild(e,t)});break;default:console.warn("strange child type ",e)}}$removeChild(t,e=!0){if(!this.$hasChild(t))return;const r=this.$children.get(t);return this.$children.remove(t),e&&this.$mutate(e=>{switch(this.$type){case Zo:delete e[t];break;case Qo:e.delete(t)}}),r.complete(),r}},Ji=t=>class extends t{constructor(t,e,...r){super(t,e,...r),this.$_configCleaner(e)}$_configCleaner(t){if(!Ai(t))return;const{cleaner:e}=t;e&&this.$addCleaner(e)}$addCleaner(t){if(!Ti(t))throw Ci("cannot add handler: not a function",{handler:t});const e=this.$on(si,(e,r)=>{if(!r.hasErrors)try{r.value=t(r.value)}catch(t){r.error(t)}}),r=this.$send(this.value);if(r.hasError)throw console.log("cannot add cleaner: ",t,"initial value is invalid"),r.thrownError;return e}};class Xi extends(Hi(Ji(Gi(Wi(qi(F)))))){constructor(t,e={}){super(yo(e,"mutable")?t:Ri(t),e),this.$_config(e)}$_config(t){if(!Ai(t))return;const{test:e,name:r,debug:n=!1,cleaners:o,mutable:i,assets:a}=t;this.$_mutable=!!i,Ti(e)&&this.$addTest(e),this.$name=ki(r,!0)?r:vt(),this.$_debug=n,Ai(o)&&Vi(o).forEach((t,e)=>{this.$hasChild(e)?this.$children.get(e).$addCleaner(t):this.$addChild(e,this.$get(e),{cleaner:t})}),Ai(a)&&(this.$_assets={...a})}get $assets(){return this.$_assets||(this.$_assets={}),this.$_assets}$setAsset(t,e){return this.$assets[t]=e,this}$_hasAssets(){return Oi(this.$_assets)}$asset(t){return this.$_hasAssets&&t in this.$assets?this.$asset[t]:null}get $debug(){return!!this.$_debug||!!this.$parent&&this.$parent.$debug}$note(t,e=null){this.$debug&&(this.$debug>1&&console.log("target: ",this.$name,t,e),this.$send(ui,{msg:t,target:this.$name,value:e}))}$update(t,e=0){const r=this.$type,n=Ii(t);if(n!==r)throw Ci("Bad update:",{values:t,target:this,expectedType:r,valueType:n});if(![Qo,Zo,ei].includes(r))return console.warn("bad type for update: ",{target:this,type:r}),this.next(t);if(this.$_mutable)return this.next(Mi(this.value,t));try{const n=he(this.value,n=>{switch(r){case Qo:t.forEach((t,e)=>{n.set(e,t)});break;case Zo:Object.keys(t).forEach(e=>{n[e]=t[e]});break;case ei:t.forEach((t,r)=>{n[r+e]=t})}});return this.next(n)}catch(e){return this.next(Mi(this.value,t))}}next(t){const e=this.$send(si,t);if(e.hasError)throw Ci("cleaning error for next value",{target:this,value:t,error:e.thrownError});let r=e.value;const n=this.$send(ii,r);if(this.$_hasChildren&&(r=this.$_withChildValues(r)),this.$_hasSelectors&&(r=this.$_withSelectors(r)),n.value=r,this.$root.$send(vi,n),this.$send(li,n,!0),n.hasError)throw n.thrownError}$addTest(t){return this.$on(vi,(e,r,n)=>{if(!e.isStopped){const r=n.getValue();let o=null;try{o=t(r,n)}catch(t){o=t}o&&e.error({target:n.$name,error:o})}})}$next(t){super.next(t)}getValue(){return this.$lastChange?this.$_withChildValues(this.$lastChange.value):super.getValue()}}return Object.assign(Xi.prototype,qi),function(){function t(t,e){function r(){this.constructor=t}o(t,e),t.prototype=(r.prototype=e.prototype,new r)}function e(t){t.o||(t.D=new Map,t.o=new Map(t.t))}function r(t){t.o||(t.o=new Set,t.t.forEach((function(e){if(_t(e)){var r=qt(t.A.h,e,t);t.p.set(e,r),t.o.add(r)}else t.o.add(e)})))}function n(t){t.O&&yt(3,JSON.stringify(Ot(t)))}var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},i=function(){function r(t,e){return this[re]={i:2,l:e,A:e?e.A:Ct(),P:!1,I:!1,o:void 0,D:void 0,t:t,k:this,C:!1,O:!1},this}t(r,Map);var o=r.prototype;return Object.defineProperty(o,"size",{get:function(){return Ot(this[re]).size}}),o.has=function(t){return Ot(this[re]).has(t)},o.set=function(t,r){var o=this[re];return n(o),Ot(o).has(t)&&Ot(o).get(t)===r||(e(o),Lt(o),o.D.set(t,!0),o.o.set(t,r),o.D.set(t,!0)),this},o.delete=function(t){if(!this.has(t))return!1;var r=this[re];return n(r),e(r),Lt(r),r.D.set(t,!1),r.o.delete(t),!0},o.clear=function(){var t=this[re];n(t),Ot(t).size&&(e(t),Lt(t),t.D=new Map,gt(t.t,(function(e){t.D.set(e,!1)})),t.o.clear())},o.forEach=function(t,e){var r=this;Ot(this[re]).forEach((function(n,o){t.call(e,r.get(o),o,r)}))},o.get=function(t){var r=this[re];n(r);var o=Ot(r).get(t);if(r.I||!_t(o))return o;if(o!==r.t.get(t))return o;var i=qt(r.A.h,o,r);return e(r),r.o.set(t,i),i},o.keys=function(){return Ot(this[re]).keys()},o.values=function(){var t,e=this,r=this.keys();return(t={})[ne]=function(){return e.values()},t.next=function(){var t=r.next();return t.done?t:{done:!1,value:e.get(t.value)}},t},o.entries=function(){var t,e=this,r=this.keys();return(t={})[ne]=function(){return e.entries()},t.next=function(){var t=r.next();if(t.done)return t;var n=e.get(t.value);return{done:!1,value:[t.value,n]}},t},o[ne]=function(){return this.entries()},r}(),a=function(){function e(t,e){return this[re]={i:3,l:e,A:e?e.A:Ct(),P:!1,I:!1,o:void 0,t:t,k:this,p:new Map,O:!1,C:!1},this}t(e,Set);var o=e.prototype;return Object.defineProperty(o,"size",{get:function(){return Ot(this[re]).size}}),o.has=function(t){var e=this[re];return n(e),e.o?!!e.o.has(t)||!(!e.p.has(t)||!e.o.has(e.p.get(t))):e.t.has(t)},o.add=function(t){var e=this[re];return n(e),this.has(t)||(r(e),Lt(e),e.o.add(t)),this},o.delete=function(t){if(!this.has(t))return!1;var e=this[re];return n(e),r(e),Lt(e),e.o.delete(t)||!!e.p.has(t)&&e.o.delete(e.p.get(t))},o.clear=function(){var t=this[re];n(t),Ot(t).size&&(r(t),Lt(t),t.o.clear())},o.values=function(){var t=this[re];return n(t),r(t),t.o.values()},o.entries=function(){var t=this[re];return n(t),r(t),t.o.entries()},o.keys=function(){return this.values()},o[ne]=function(){return this.values()},o.forEach=function(t,e){for(var r=this.values(),n=r.next();!n.done;)t.call(e,n.value,n.value,this),n=r.next()},e}();!function(t,e){se[t]||(se[t]=e)}("MapSet",{N:function(t,e){return new i(t,e)},T:function(t,e){return new a(t,e)}})}(),$i=Xi,{...mi,...dt,idGen:dt,utils:Ui,Mirror:Xi,isMirror:wi,create:Ei}}));
