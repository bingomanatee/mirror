!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t=t||self)["@wonderlandlabs/mirror"]=r()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(r,e)};function r(r,e){function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function e(t){return"function"==typeof t}var n=!1,o={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;n=t},get useDeprecatedSynchronousErrorHandling(){return n}};function i(t){setTimeout((function(){throw t}),0)}var s={closed:!0,next:function(t){},error:function(t){if(o.useDeprecatedSynchronousErrorHandling)throw t;i(t)},complete:function(){}},c=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function u(t){return null!==t&&"object"==typeof t}var a=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,r){return r+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),h=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var r;if(!this.closed){var n=this._parentOrParents,o=this._ctorUnsubscribe,i=this._unsubscribe,s=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(var h=0;h<n.length;++h){n[h].remove(this)}if(e(i)){o&&(this._unsubscribe=void 0);try{i.call(this)}catch(t){r=t instanceof a?f(t.errors):[t]}}if(c(s)){h=-1;for(var l=s.length;++h<l;){var p=s[h];if(u(p))try{p.unsubscribe()}catch(t){r=r||[],t instanceof a?r=r.concat(f(t.errors)):r.push(t)}}}if(r)throw new a(r)}},t.prototype.add=function(r){var e=r;if(!r)return t.EMPTY;switch(typeof r){case"function":e=new t(r);case"object":if(e===this||e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof t)){var n=e;(e=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+r+" added to Subscription.")}var o=e._parentOrParents;if(null===o)e._parentOrParents=this;else if(o instanceof t){if(o===this)return e;e._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return e;o.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[e]:i.push(e),e},t.prototype.remove=function(t){var r=this._subscriptions;if(r){var e=r.indexOf(t);-1!==e&&r.splice(e,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function f(t){return t.reduce((function(t,r){return t.concat(r instanceof a?r.errors:r)}),[])}var l=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),p=function(t){function e(r,n,o){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=s;break;case 1:if(!r){i.destination=s;break}if("object"==typeof r){r instanceof e?(i.syncErrorThrowable=r.syncErrorThrowable,i.destination=r,r.add(i)):(i.syncErrorThrowable=!0,i.destination=new b(i,r));break}default:i.syncErrorThrowable=!0,i.destination=new b(i,r,n,o)}return i}return r(e,t),e.prototype[l]=function(){return this},e.create=function(t,r,n){var o=new e(t,r,n);return o.syncErrorThrowable=!1,o},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(h),b=function(t){function n(r,n,o,i){var c,u=t.call(this)||this;u._parentSubscriber=r;var a=u;return e(n)?c=n:n&&(c=n.next,o=n.error,i=n.complete,n!==s&&(e((a=Object.create(n)).unsubscribe)&&u.add(a.unsubscribe.bind(a)),a.unsubscribe=u.unsubscribe.bind(u))),u._context=a,u._next=c,u._error=o,u._complete=i,u}return r(n,t),n.prototype.next=function(t){if(!this.isStopped&&this._next){var r=this._parentSubscriber;o.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable?this.__tryOrSetError(r,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},n.prototype.error=function(t){if(!this.isStopped){var r=this._parentSubscriber,e=o.useDeprecatedSynchronousErrorHandling;if(this._error)e&&r.syncErrorThrowable?(this.__tryOrSetError(r,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(r.syncErrorThrowable)e?(r.syncErrorValue=t,r.syncErrorThrown=!0):i(t),this.unsubscribe();else{if(this.unsubscribe(),e)throw t;i(t)}}},n.prototype.complete=function(){var t=this;if(!this.isStopped){var r=this._parentSubscriber;if(this._complete){var e=function(){return t._complete.call(t._context)};o.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable?(this.__tryOrSetError(r,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}},n.prototype.__tryOrUnsub=function(t,r){try{t.call(this._context,r)}catch(t){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw t;i(t)}},n.prototype.__tryOrSetError=function(t,r,e){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{r.call(this._context,e)}catch(r){return o.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0,!0):(i(r),!0)}return!1},n.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},n}(p);var d=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function y(t){return t}function v(t){return 0===t.length?y:1===t.length?t[0]:function(r){return t.reduce((function(t,r){return r(t)}),r)}}var _=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(r){var e=new t;return e.source=this,e.operator=r,e},t.prototype.subscribe=function(t,r,e){var n=this.operator,i=function(t,r,e){if(t){if(t instanceof p)return t;if(t[l])return t[l]()}return t||r||e?new p(t,r,e):new p(s)}(t,r,e);if(n?i.add(n.call(i,this.source)):i.add(this.source||o.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),o.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){o.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),!function(t){for(;t;){var r=t,e=r.closed,n=r.destination,o=r.isStopped;if(e||o)return!1;t=n&&n instanceof p?n:null}return!0}(t)?console.warn(r):t.error(r)}},t.prototype.forEach=function(t,r){var e=this;return new(r=w(r))((function(r,n){var o;o=e.subscribe((function(r){try{t(r)}catch(t){n(t),o&&o.unsubscribe()}}),n,r)}))},t.prototype._subscribe=function(t){var r=this.source;return r&&r.subscribe(t)},t.prototype[d]=function(){return this},t.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return 0===t.length?this:v(t)(this)},t.prototype.toPromise=function(t){var r=this;return new(t=w(t))((function(t,e){var n;r.subscribe((function(t){return n=t}),(function(t){return e(t)}),(function(){return t(n)}))}))},t.create=function(r){return new t(r)},t}();function w(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}var g=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),$=function(t){function e(r,e){var n=t.call(this)||this;return n.subject=r,n.subscriber=e,n.closed=!1,n}return r(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,r=t.observers;if(this.subject=null,r&&0!==r.length&&!t.isStopped&&!t.closed){var e=r.indexOf(this.subscriber);-1!==e&&r.splice(e,1)}}},e}(h),j=function(t){function e(r){var e=t.call(this,r)||this;return e.destination=r,e}return r(e,t),e}(p),m=function(t){function e(){var r=t.call(this)||this;return r.observers=[],r.closed=!1,r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return r(e,t),e.prototype[l]=function(){return new j(this)},e.prototype.lift=function(t){var r=new S(this,this);return r.operator=t,r},e.prototype.next=function(t){if(this.closed)throw new g;if(!this.isStopped)for(var r=this.observers,e=r.length,n=r.slice(),o=0;o<e;o++)n[o].next(t)},e.prototype.error=function(t){if(this.closed)throw new g;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var r=this.observers,e=r.length,n=r.slice(),o=0;o<e;o++)n[o].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new g;this.isStopped=!0;for(var t=this.observers,r=t.length,e=t.slice(),n=0;n<r;n++)e[n].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(r){if(this.closed)throw new g;return t.prototype._trySubscribe.call(this,r)},e.prototype._subscribe=function(t){if(this.closed)throw new g;return this.hasError?(t.error(this.thrownError),h.EMPTY):this.isStopped?(t.complete(),h.EMPTY):(this.observers.push(t),new $(this,t))},e.prototype.asObservable=function(){var t=new _;return t.source=this,t},e.create=function(t,r){return new S(t,r)},e}(_),S=function(t){function e(r,e){var n=t.call(this)||this;return n.destination=r,n.source=e,n}return r(e,t),e.prototype.next=function(t){var r=this.destination;r&&r.next&&r.next(t)},e.prototype.error=function(t){var r=this.destination;r&&r.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):h.EMPTY},e}(m);function x(){return function(t){return t.lift(new E(t))}}var E=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,r){var e=this.connectable;e._refCount++;var n=new O(t,e),o=r.subscribe(n);return n.closed||(n.connection=e.connect()),o},t}(),O=function(t){function e(r,e){var n=t.call(this,r)||this;return n.connectable=e,n}return r(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var r=t._refCount;if(r<=0)this.connection=null;else if(t._refCount=r-1,r>1)this.connection=null;else{var e=this.connection,n=t._connection;this.connection=null,!n||e&&n!==e||n.unsubscribe()}}else this.connection=null},e}(p),A=function(t){function e(r,e){var n=t.call(this)||this;return n.source=r,n.subjectFactory=e,n._refCount=0,n._isComplete=!1,n}return r(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new h).add(this.source.subscribe(new P(this.getSubject(),this))),t.closed&&(this._connection=null,t=h.EMPTY)),t},e.prototype.refCount=function(){return x()(this)},e}(_),T=function(){var t=A.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}}(),P=function(t){function e(r,e){var n=t.call(this,r)||this;return n.connectable=e,n}return r(e,t),e.prototype._error=function(r){this._unsubscribe(),t.prototype._error.call(this,r)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var r=t._connection;t._refCount=0,t._subject=null,t._connection=null,r&&r.unsubscribe()}},e}(j),C=function(t){function e(r){var e=t.call(this)||this;return e._value=r,e}return r(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(r){var e=t.prototype._subscribe.call(this,r);return e&&!e.closed&&r.next(this._value),e},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new g;return this._value},e.prototype.next=function(r){t.prototype.next.call(this,this._value=r)},e}(m);function M(t){return t&&"function"==typeof t.schedule}var I=function(t){return function(r){for(var e=0,n=t.length;e<n&&!r.closed;e++)r.next(t[e]);r.complete()}};function k(t,r){return new _((function(e){var n=new h,o=0;return n.add(r.schedule((function(){o!==t.length?(e.next(t[o++]),e.closed||n.add(this.schedule())):e.complete()}))),n}))}function N(t,r){return r?k(t,r):new _(I(t))}function U(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var e=t[t.length-1];return M(e)?(t.pop(),k(t,e)):N(t)}function z(t,r){return function(e){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return e.lift(new D(t,r))}}var D=function(){function t(t,r){this.project=t,this.thisArg=r}return t.prototype.call=function(t,r){return r.subscribe(new F(t,this.project,this.thisArg))},t}(),F=function(t){function e(r,e,n){var o=t.call(this,r)||this;return o.project=e,o.count=0,o.thisArg=n||o,o}return r(e,t),e.prototype._next=function(t){var r;try{r=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(r)},e}(p),H=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.notifyNext=function(t,r,e,n,o){this.destination.next(r)},e.prototype.notifyError=function(t,r){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(p),R=function(t){function e(r,e,n){var o=t.call(this)||this;return o.parent=r,o.outerValue=e,o.outerIndex=n,o.index=0,o}return r(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(p);function V(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var Y=V(),B=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function L(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var K=function(t){if(t&&"function"==typeof t[d])return n=t,function(t){var r=n[d]();if("function"!=typeof r.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(t)};if(B(t))return I(t);if(L(t))return e=t,function(t){return e.then((function(r){t.closed||(t.next(r),t.complete())}),(function(r){return t.error(r)})).then(null,i),t};if(t&&"function"==typeof t[Y])return r=t,function(t){for(var e=r[Y]();;){var n=void 0;try{n=e.next()}catch(r){return t.error(r),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof e.return&&t.add((function(){e.return&&e.return()})),t};var r,e,n,o=u(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+o+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function W(t,r,e,n,o){if(void 0===o&&(o=new R(t,e,n)),!o.closed)return r instanceof _?r.subscribe(o):K(r)(o)}var q={};var G=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,r){return r.subscribe(new J(t,this.resultSelector))},t}(),J=function(t){function e(r,e){var n=t.call(this,r)||this;return n.resultSelector=e,n.active=0,n.values=[],n.observables=[],n}return r(e,t),e.prototype._next=function(t){this.values.push(q),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,r=t.length;if(0===r)this.destination.complete();else{this.active=r,this.toRespond=r;for(var e=0;e<r;e++){var n=t[e];this.add(W(this,n,void 0,e))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,r,e){var n=this.values,o=n[e],i=this.toRespond?o===q?--this.toRespond:this.toRespond:0;n[e]=r,0===i&&(this.resultSelector?this._tryResultSelector(n):this.destination.next(n.slice()))},e.prototype._tryResultSelector=function(t){var r;try{r=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(r)},e}(H);function X(t,r){if(null!=t){if(function(t){return t&&"function"==typeof t[d]}(t))return function(t,r){return new _((function(e){var n=new h;return n.add(r.schedule((function(){var o=t[d]();n.add(o.subscribe({next:function(t){n.add(r.schedule((function(){return e.next(t)})))},error:function(t){n.add(r.schedule((function(){return e.error(t)})))},complete:function(){n.add(r.schedule((function(){return e.complete()})))}}))}))),n}))}(t,r);if(L(t))return function(t,r){return new _((function(e){var n=new h;return n.add(r.schedule((function(){return t.then((function(t){n.add(r.schedule((function(){e.next(t),n.add(r.schedule((function(){return e.complete()})))})))}),(function(t){n.add(r.schedule((function(){return e.error(t)})))}))}))),n}))}(t,r);if(B(t))return k(t,r);if(function(t){return t&&"function"==typeof t[Y]}(t)||"string"==typeof t)return function(t,r){if(!t)throw new Error("Iterable cannot be null");return new _((function(e){var n,o=new h;return o.add((function(){n&&"function"==typeof n.return&&n.return()})),o.add(r.schedule((function(){n=t[Y](),o.add(r.schedule((function(){if(!e.closed){var t,r;try{var o=n.next();t=o.value,r=o.done}catch(t){return void e.error(t)}r?e.complete():(e.next(t),this.schedule())}})))}))),o}))}(t,r)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function Q(t,r){return r?X(t,r):t instanceof _?t:new _(K(t))}var Z=function(t){function e(r){var e=t.call(this)||this;return e.parent=r,e}return r(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(p),tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(p);function rt(t,r){if(!r.closed)return t instanceof _?t.subscribe(r):K(t)(r)}var et=function(){function t(t,r){void 0===r&&(r=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=r}return t.prototype.call=function(t,r){return r.subscribe(new nt(t,this.project,this.concurrent))},t}(),nt=function(t){function e(r,e,n){void 0===n&&(n=Number.POSITIVE_INFINITY);var o=t.call(this,r)||this;return o.project=e,o.concurrent=n,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return r(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var r,e=this.index++;try{r=this.project(t,e)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(r)},e.prototype._innerSub=function(t){var r=new Z(this),e=this.destination;e.add(r);var n=rt(t,r);n!==r&&e.add(n)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(tt),ot=function t(r,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?function(o){return o.pipe(t((function(t,n){return Q(r(t,n)).pipe(z((function(r,o){return e(t,r,n,o)})))}),n))}:("number"==typeof e&&(n=e),function(t){return t.lift(new et(r,n))})};function it(t,r){return function(e){return e.lift(new st(t,r))}}var st=function(){function t(t,r){this.predicate=t,this.thisArg=r}return t.prototype.call=function(t,r){return r.subscribe(new ct(t,this.predicate,this.thisArg))},t}(),ct=function(t){function e(r,e,n){var o=t.call(this,r)||this;return o.predicate=e,o.thisArg=n,o.count=0,o}return r(e,t),e.prototype._next=function(t){var r;try{r=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}r&&this.destination.next(t)},e}(p);var ut=function(){function t(t){this.selector=t}return t.prototype.call=function(t,r){return r.subscribe(new at(t,this.selector,this.caught))},t}(),at=function(t){function e(r,e,n){var o=t.call(this,r)||this;return o.selector=e,o.caught=n,o}return r(e,t),e.prototype.error=function(r){if(!this.isStopped){var e=void 0;try{e=this.selector(r,this.caught)}catch(r){return void t.prototype.error.call(this,r)}this._unsubscribeAndRecycle();var n=new Z(this);this.add(n);var o=rt(e,n);o!==n&&this.add(o)}},e}(tt);function ht(t,r){return function(e){return e.lift(new ft(t,r))}}var ft=function(){function t(t,r){this.compare=t,this.keySelector=r}return t.prototype.call=function(t,r){return r.subscribe(new lt(t,this.compare,this.keySelector))},t}(),lt=function(t){function e(r,e,n){var o=t.call(this,r)||this;return o.keySelector=n,o.hasKey=!1,"function"==typeof e&&(o.compare=e),o}return r(e,t),e.prototype.compare=function(t,r){return t===r},e.prototype._next=function(t){var r;try{var e=this.keySelector;r=e?e(t):t}catch(t){return this.destination.error(t)}var n=!1;if(this.hasKey)try{n=(0,this.compare)(this.key,r)}catch(t){return this.destination.error(t)}else this.hasKey=!0;n||(this.key=r,this.destination.next(t))},e}(p);var pt=function(){function t(t,r){this.subjectFactory=t,this.selector=r}return t.prototype.call=function(t,r){var e=this.selector,n=this.subjectFactory(),o=e(n).subscribe(t);return o.add(r.subscribe(n)),o},t}();function bt(){return new m}function dt(){return function(t){return x()((r=bt,function(t){var n;if(n="function"==typeof r?r:function(){return r},"function"==typeof e)return t.lift(new pt(n,e));var o=Object.create(t,T);return o.source=t,o.subjectFactory=n,o})(t));var r,e}}var yt=function(){function t(t){this.project=t}return t.prototype.call=function(t,r){return r.subscribe(new vt(t,this.project))},t}(),vt=function(t){function e(r,e){var n=t.call(this,r)||this;return n.project=e,n.index=0,n}return r(e,t),e.prototype._next=function(t){var r,e=this.index++;try{r=this.project(t,e)}catch(t){return void this.destination.error(t)}this._innerSub(r)},e.prototype._innerSub=function(t){var r=this.innerSubscription;r&&r.unsubscribe();var e=new Z(this),n=this.destination;n.add(e),this.innerSubscription=rt(t,e),this.innerSubscription!==e&&n.add(this.innerSubscription)},e.prototype._complete=function(){var r=this.innerSubscription;r&&!r.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t){this.destination.next(t)},e}(tt);var _t=function(){this.__data__=[],this.size=0};var wt=function(t,r){return t===r||t!=t&&r!=r};var gt=function(t,r){for(var e=t.length;e--;)if(wt(t[e][0],r))return e;return-1},$t=Array.prototype.splice;var jt=function(t){var r=this.__data__,e=gt(r,t);return!(e<0)&&(e==r.length-1?r.pop():$t.call(r,e,1),--this.size,!0)};var mt=function(t){var r=this.__data__,e=gt(r,t);return e<0?void 0:r[e][1]};var St=function(t){return gt(this.__data__,t)>-1};var xt=function(t,r){var e=this.__data__,n=gt(e,t);return n<0?(++this.size,e.push([t,r])):e[n][1]=r,this};function Et(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}Et.prototype.clear=_t,Et.prototype.delete=jt,Et.prototype.get=mt,Et.prototype.has=St,Et.prototype.set=xt;var Ot=Et;var At=function(){this.__data__=new Ot,this.size=0};var Tt=function(t){var r=this.__data__,e=r.delete(t);return this.size=r.size,e};var Pt=function(t){return this.__data__.get(t)};var Ct=function(t){return this.__data__.has(t)},Mt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function It(t,r){return t(r={exports:{}},r.exports),r.exports}var kt="object"==typeof Mt&&Mt&&Mt.Object===Object&&Mt,Nt="object"==typeof self&&self&&self.Object===Object&&self,Ut=kt||Nt||Function("return this")(),zt=Ut.Symbol,Dt=Object.prototype,Ft=Dt.hasOwnProperty,Ht=Dt.toString,Rt=zt?zt.toStringTag:void 0;var Vt=function(t){var r=Ft.call(t,Rt),e=t[Rt];try{t[Rt]=void 0;var n=!0}catch(t){}var o=Ht.call(t);return n&&(r?t[Rt]=e:delete t[Rt]),o},Yt=Object.prototype.toString;var Bt=function(t){return Yt.call(t)},Lt="[object Null]",Kt="[object Undefined]",Wt=zt?zt.toStringTag:void 0;var qt=function(t){return null==t?void 0===t?Kt:Lt:Wt&&Wt in Object(t)?Vt(t):Bt(t)};var Gt=function(t){var r=typeof t;return null!=t&&("object"==r||"function"==r)},Jt="[object AsyncFunction]",Xt="[object Function]",Qt="[object GeneratorFunction]",Zt="[object Proxy]";var tr,rr=function(t){if(!Gt(t))return!1;var r=qt(t);return r==Xt||r==Qt||r==Jt||r==Zt},er=Ut["__core-js_shared__"],nr=(tr=/[^.]+$/.exec(er&&er.keys&&er.keys.IE_PROTO||""))?"Symbol(src)_1."+tr:"";var or=function(t){return!!nr&&nr in t},ir=Function.prototype.toString;var sr=function(t){if(null!=t){try{return ir.call(t)}catch(t){}try{return t+""}catch(t){}}return""},cr=/^\[object .+?Constructor\]$/,ur=Function.prototype,ar=Object.prototype,hr=ur.toString,fr=ar.hasOwnProperty,lr=RegExp("^"+hr.call(fr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var pr=function(t){return!(!Gt(t)||or(t))&&(rr(t)?lr:cr).test(sr(t))};var br=function(t,r){return null==t?void 0:t[r]};var dr=function(t,r){var e=br(t,r);return pr(e)?e:void 0},yr=dr(Ut,"Map"),vr=dr(Object,"create");var _r=function(){this.__data__=vr?vr(null):{},this.size=0};var wr=function(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r},gr="__lodash_hash_undefined__",$r=Object.prototype.hasOwnProperty;var jr=function(t){var r=this.__data__;if(vr){var e=r[t];return e===gr?void 0:e}return $r.call(r,t)?r[t]:void 0},mr=Object.prototype.hasOwnProperty;var Sr=function(t){var r=this.__data__;return vr?void 0!==r[t]:mr.call(r,t)},xr="__lodash_hash_undefined__";var Er=function(t,r){var e=this.__data__;return this.size+=this.has(t)?0:1,e[t]=vr&&void 0===r?xr:r,this};function Or(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}Or.prototype.clear=_r,Or.prototype.delete=wr,Or.prototype.get=jr,Or.prototype.has=Sr,Or.prototype.set=Er;var Ar=Or;var Tr=function(){this.size=0,this.__data__={hash:new Ar,map:new(yr||Ot),string:new Ar}};var Pr=function(t){var r=typeof t;return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t};var Cr=function(t,r){var e=t.__data__;return Pr(r)?e["string"==typeof r?"string":"hash"]:e.map};var Mr=function(t){var r=Cr(this,t).delete(t);return this.size-=r?1:0,r};var Ir=function(t){return Cr(this,t).get(t)};var kr=function(t){return Cr(this,t).has(t)};var Nr=function(t,r){var e=Cr(this,t),n=e.size;return e.set(t,r),this.size+=e.size==n?0:1,this};function Ur(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}Ur.prototype.clear=Tr,Ur.prototype.delete=Mr,Ur.prototype.get=Ir,Ur.prototype.has=kr,Ur.prototype.set=Nr;var zr=Ur,Dr=200;var Fr=function(t,r){var e=this.__data__;if(e instanceof Ot){var n=e.__data__;if(!yr||n.length<Dr-1)return n.push([t,r]),this.size=++e.size,this;e=this.__data__=new zr(n)}return e.set(t,r),this.size=e.size,this};function Hr(t){var r=this.__data__=new Ot(t);this.size=r.size}Hr.prototype.clear=At,Hr.prototype.delete=Tt,Hr.prototype.get=Pt,Hr.prototype.has=Ct,Hr.prototype.set=Fr;var Rr=Hr,Vr=Ut.Uint8Array,Yr=zt?zt.prototype:void 0;Yr&&Yr.valueOf;var Br=function(t,r){for(var e=-1,n=r.length,o=t.length;++e<n;)t[o+e]=r[e];return t},Lr=Array.isArray;var Kr=function(t,r,e){var n=r(t);return Lr(t)?n:Br(n,e(t))};var Wr=function(t,r){for(var e=-1,n=null==t?0:t.length,o=0,i=[];++e<n;){var s=t[e];r(s,e,t)&&(i[o++]=s)}return i};var qr=function(){return[]},Gr=Object.prototype.propertyIsEnumerable,Jr=Object.getOwnPropertySymbols,Xr=Jr?function(t){return null==t?[]:(t=Object(t),Wr(Jr(t),(function(r){return Gr.call(t,r)})))}:qr;var Qr=function(t,r){for(var e=-1,n=Array(t);++e<t;)n[e]=r(e);return n};var Zr=function(t){return null!=t&&"object"==typeof t},te="[object Arguments]";var re=function(t){return Zr(t)&&qt(t)==te},ee=Object.prototype,ne=ee.hasOwnProperty,oe=ee.propertyIsEnumerable,ie=re(function(){return arguments}())?re:function(t){return Zr(t)&&ne.call(t,"callee")&&!oe.call(t,"callee")};var se=function(){return!1},ce=It((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e?Ut.Buffer:void 0,i=(o?o.isBuffer:void 0)||se;t.exports=i})),ue=9007199254740991,ae=/^(?:0|[1-9]\d*)$/;var he=function(t,r){var e=typeof t;return!!(r=null==r?ue:r)&&("number"==e||"symbol"!=e&&ae.test(t))&&t>-1&&t%1==0&&t<r},fe=9007199254740991;var le=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=fe},pe={};pe["[object Float32Array]"]=pe["[object Float64Array]"]=pe["[object Int8Array]"]=pe["[object Int16Array]"]=pe["[object Int32Array]"]=pe["[object Uint8Array]"]=pe["[object Uint8ClampedArray]"]=pe["[object Uint16Array]"]=pe["[object Uint32Array]"]=!0,pe["[object Arguments]"]=pe["[object Array]"]=pe["[object ArrayBuffer]"]=pe["[object Boolean]"]=pe["[object DataView]"]=pe["[object Date]"]=pe["[object Error]"]=pe["[object Function]"]=pe["[object Map]"]=pe["[object Number]"]=pe["[object Object]"]=pe["[object RegExp]"]=pe["[object Set]"]=pe["[object String]"]=pe["[object WeakMap]"]=!1;var be=function(t){return Zr(t)&&le(t.length)&&!!pe[qt(t)]};var de=function(t){return function(r){return t(r)}},ye=It((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e&&kt.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),ve=ye&&ye.isTypedArray,_e=ve?de(ve):be,we=Object.prototype.hasOwnProperty;var ge=function(t,r){var e=Lr(t),n=!e&&ie(t),o=!e&&!n&&ce(t),i=!e&&!n&&!o&&_e(t),s=e||n||o||i,c=s?Qr(t.length,String):[],u=c.length;for(var a in t)!r&&!we.call(t,a)||s&&("length"==a||o&&("offset"==a||"parent"==a)||i&&("buffer"==a||"byteLength"==a||"byteOffset"==a)||he(a,u))||c.push(a);return c},$e=Object.prototype;var je=function(t){var r=t&&t.constructor;return t===("function"==typeof r&&r.prototype||$e)};var me=function(t,r){return function(e){return t(r(e))}},Se=me(Object.keys,Object),xe=Object.prototype.hasOwnProperty;var Ee=function(t){if(!je(t))return Se(t);var r=[];for(var e in Object(t))xe.call(t,e)&&"constructor"!=e&&r.push(e);return r};var Oe=function(t){return null!=t&&le(t.length)&&!rr(t)};var Ae=function(t){return Oe(t)?ge(t):Ee(t)};var Te=function(t){return Kr(t,Ae,Xr)},Pe=dr(Ut,"DataView"),Ce=dr(Ut,"Promise"),Me=dr(Ut,"Set"),Ie=dr(Ut,"WeakMap"),ke=sr(Pe),Ne=sr(yr),Ue=sr(Ce),ze=sr(Me),De=sr(Ie),Fe=qt;(Pe&&"[object DataView]"!=Fe(new Pe(new ArrayBuffer(1)))||yr&&"[object Map]"!=Fe(new yr)||Ce&&"[object Promise]"!=Fe(Ce.resolve())||Me&&"[object Set]"!=Fe(new Me)||Ie&&"[object WeakMap]"!=Fe(new Ie))&&(Fe=function(t){var r=qt(t),e="[object Object]"==r?t.constructor:void 0,n=e?sr(e):"";if(n)switch(n){case ke:return"[object DataView]";case Ne:return"[object Map]";case Ue:return"[object Promise]";case ze:return"[object Set]";case De:return"[object WeakMap]"}return r});var He=Fe;const Re=Symbol("action-next"),Ve=Symbol("skip"),Ye="requires an event as the second parameter",Be=t=>t,Le=Symbol("action-update"),Ke=Symbol("action-child-error"),We=Symbol("do-action-unhandled"),qe=null,Ge=0,Je=1,Xe=[-1,Ge,Je];var Qe=Object.freeze({__proto__:null,ACTION_NEXT:Re,SKIP:Ve,errorWrapperParamErrorMsg:Ye,identity:Be,ACTION_CHANGE_KEYS:Le,ACTION_CHILD_ERROR:Ke,UNHANDLED:We,PHASE_INIT:qe,PHASE_PRE:-1,PHASE_ON:Ge,PHASE_POST:Je,PHASE_DEFAULT_LIST:Xe});class Ze extends C{constructor(t,r,e){super(t),this._action=r,this._target=e,this._last=t;const n=this;this.phase=qe,this.subscribe({next(t){n._last=t},error(){}})}get last(){return this._last}get action(){return this._action}get target(){return this._target}toJSON(){return{value:this.value,phase:this.phase,action:this.action}}}Ze.eventsMatch=(t,r)=>t instanceof Ze&&r instanceof Ze&&(t.action===r.action&&t.phase===r.phase&&t.value===r.value);function tn(t){if(t instanceof Map)return new Map(t);const r=new Map;return Object.keys(t).forEach(e=>r.set(e,t[e])),r}function rn(t){if(!(t instanceof Map))return t;const r={};return t.forEach((t,e)=>{try{r[e]=t}catch(t){}}),r}function en(t){if("string"!=typeof t)throw new Error("bad user action");for(;"$$"!==t.substr(0,2);)t=`$${t}`;return t}var nn=Object.freeze({__proto__:null,asMap:tn,asObject:rn,asUserAction:en});class on extends C{constructor(t,r){super(t),r&&this._$config(r),this.$on(Re,t=>{t.subscribe({complete:()=>{super.next(t.value)},error:t=>{console.log("next aborted: ",t)}})});const e=this;this.$events.subscribe({next(t){t&&t.subscribe&&t.subscribe({error(t){console.log("error in mirror: ",t,e.name||e),t&&t.thrown&&console.log("thrown:",t.thrownError)}})},error(t){}}),this._$constructed=!0,this._$value=t}_$config(t){if("string"==typeof t)this.name=t;else if("object"==typeof t){const{name:r,actions:e}=t;r&&(this.name=r),e&&"object"==typeof e&&this.$addActs(e)}}next(t){this.$send(Re,t)}$send(t,r){const e=new Ze(r,t,this);return this.$events.next(e),e.isStopped||e.complete(),e}$act(t,...r){const e=this.$send(en(t),{args:r,result:We});if(e){if(e.thrownError)throw e.thrownError;return e.value.result===We&&console.warn("unhandled user action",t,"called with ",...r),e.value.result}console.warn("$act did not return event.")}$addAct(t,r){if("function"!=typeof r)throw new Error(`$act requires function for ${t}`);const e=this,n=this.$on(en(t),t=>{const{args:n}=t.value,o=r(e,...n);t.next({...t.value,result:o})},Ge);this.$remAct(t);this._$acts.set(t,{name:t,handler:r,sub:n,proxy:(...r)=>{const e=this.$act(t,...r);return e?e._value:void 0}})}get _$acts(){return this._$$acts||(this._$$acts=new Map),this._$$acts}$hasAction(t){return this._$$acts&&this._$$acts.has(t)}$addActs(t){Object.keys(t).forEach(r=>{const e=t[r];"function"==typeof e&&this.$addAct(r,e)})}$remAct(t){if(this._$$acts&&this._$acts.has(t)){const{sub:r}=this._$acts;r&&r.unsubscribe(),this._$acts.delete(t)}}get $events(){return this._$events||(this._$events=(new m).pipe(ot(t=>U(...Xe).pipe(z(r=>t.isStopped?Ve:Object.assign(t,{phase:r})))),it(t=>t!==Ve),ht(Ze.eventsMatch,t=>t instanceof Ze?t.toJSON():t))),this._$events}$on(t,r,e=Ge){return this.$events.subscribe({next(n){if(!n.isStopped&&n.action===t&&n.phase===e)try{r(n)}catch(t){console.log("$on hander --- thrown error from ",r.toString()),console.log("thrown: ",t),n.isStopped||n.error(n)}}})}get _$transStream(){return this._$$transStream||(this._$$transStream=new C(new Set)),this._$$transStream}$remTrans(t){const r=this._$activeTrans;r.delete(t),this._$transStream.next(r)}get _$activeTrans(){const t=new Set;return this._$transStream.value.forEach(r=>{r.isStopped||t.add(r)}),t}$trans(t){if(!t)return this.$trans(new m);const r=this._$activeTrans;r.add(t);const e=this;this.$subject;return t.subscribe({complete(){e.$remTrans(t)},error(){e.$remTrans(t)}}),this._$transStream.next(r),t}get $subject(){if(!this._$$outThrottled){const t=this;this._$$outThrottled=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var e=void 0,n=void 0;return M(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&c(t[0])&&(t=t[0]),N(t,n).lift(new G(e))}(this._$transStream,t).pipe(it(([t])=>!t.size),z(t=>t[1]),ht()),this._$$outThrottled.subscribe(r=>{t._$value=r},Be)}return this._$$outThrottled}get $value(){return this._$value}$subscribe(...t){return this.$subject.subscribe(...t)}get $proxy(){return this.$p}get $p(){return this._$p||(this._$p=new Proxy(this,{get(t,r){try{return t._$acts.has(r)?t._$acts.get(r).proxy:t[r]}catch(e){console.log("error getting",r),console.log("from",t),console.warn(e)}}})),this._$p}get $do(){return this._$do||(this._$do=new Proxy(this,{get:(t,r)=>t.$hasAction(r)?t._$acts.get(r).proxy:Be})),this._$do}get do(){return console.warn("deprecated: use $do or $p"),this.$do}get $my(){return this.$p}get my(){return console.warn("deprecated; use $my or $p"),this.$p}}var sn=function(t,r,e){var n=-1,o=t.length;r<0&&(r=-r>o?0:o+r),(e=e>o?o:e)<0&&(e+=o),o=r>e?0:e-r>>>0,r>>>=0;for(var i=Array(o);++n<o;)i[n]=t[n+r];return i};var cn=function(t,r,e){var n=t.length;return e=void 0===e?n:e,!r&&e>=n?t:sn(t,r,e)},un=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var an=function(t){return un.test(t)};var hn=function(t){return t.split("")},fn="[\\ud800-\\udfff]",ln="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",pn="\\ud83c[\\udffb-\\udfff]",bn="[^\\ud800-\\udfff]",dn="(?:\\ud83c[\\udde6-\\uddff]){2}",yn="[\\ud800-\\udbff][\\udc00-\\udfff]",vn="(?:"+ln+"|"+pn+")"+"?",_n="[\\ufe0e\\ufe0f]?"+vn+("(?:\\u200d(?:"+[bn,dn,yn].join("|")+")[\\ufe0e\\ufe0f]?"+vn+")*"),wn="(?:"+[bn+ln+"?",ln,dn,yn,fn].join("|")+")",gn=RegExp(pn+"(?="+pn+")|"+wn+_n,"g");var $n=function(t){return t.match(gn)||[]};var jn=function(t){return an(t)?$n(t):hn(t)};var mn=function(t,r){for(var e=-1,n=null==t?0:t.length,o=Array(n);++e<n;)o[e]=r(t[e],e,t);return o},Sn="[object Symbol]";var xn=function(t){return"symbol"==typeof t||Zr(t)&&qt(t)==Sn},En=1/0,On=zt?zt.prototype:void 0,An=On?On.toString:void 0;var Tn=function t(r){if("string"==typeof r)return r;if(Lr(r))return mn(r,t)+"";if(xn(r))return An?An.call(r):"";var e=r+"";return"0"==e&&1/r==-En?"-0":e};var Pn=function(t){return null==t?"":Tn(t)};var Cn=function(t){return function(r){r=Pn(r);var e=an(r)?jn(r):void 0,n=e?e[0]:r.charAt(0),o=e?cn(e,1).join(""):r.slice(1);return n[t]()+o}},Mn=Cn("toUpperCase"),In=Cn("toLowerCase");var kn=function(t,r){for(var e=-1,n=null==t?0:t.length;++e<n&&!1!==r(t[e],e,t););return t},Nn=function(){try{var t=dr(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var Un=function(t,r,e){"__proto__"==r&&Nn?Nn(t,r,{configurable:!0,enumerable:!0,value:e,writable:!0}):t[r]=e},zn=Object.prototype.hasOwnProperty;var Dn=function(t,r,e){var n=t[r];zn.call(t,r)&&wt(n,e)&&(void 0!==e||r in t)||Un(t,r,e)};var Fn=function(t,r,e,n){var o=!e;e||(e={});for(var i=-1,s=r.length;++i<s;){var c=r[i],u=n?n(e[c],t[c],c,e,t):void 0;void 0===u&&(u=t[c]),o?Un(e,c,u):Dn(e,c,u)}return e};var Hn=function(t,r){return t&&Fn(r,Ae(r),t)};var Rn=function(t){var r=[];if(null!=t)for(var e in Object(t))r.push(e);return r},Vn=Object.prototype.hasOwnProperty;var Yn=function(t){if(!Gt(t))return Rn(t);var r=je(t),e=[];for(var n in t)("constructor"!=n||!r&&Vn.call(t,n))&&e.push(n);return e};var Bn=function(t){return Oe(t)?ge(t,!0):Yn(t)};var Ln=function(t,r){return t&&Fn(r,Bn(r),t)},Kn=It((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e?Ut.Buffer:void 0,i=o?o.allocUnsafe:void 0;t.exports=function(t,r){if(r)return t.slice();var e=t.length,n=i?i(e):new t.constructor(e);return t.copy(n),n}}));var Wn=function(t,r){var e=-1,n=t.length;for(r||(r=Array(n));++e<n;)r[e]=t[e];return r};var qn=function(t,r){return Fn(t,Xr(t),r)},Gn=me(Object.getPrototypeOf,Object),Jn=Object.getOwnPropertySymbols?function(t){for(var r=[];t;)Br(r,Xr(t)),t=Gn(t);return r}:qr;var Xn=function(t,r){return Fn(t,Jn(t),r)};var Qn=function(t){return Kr(t,Bn,Jn)},Zn=Object.prototype.hasOwnProperty;var to=function(t){var r=t.length,e=new t.constructor(r);return r&&"string"==typeof t[0]&&Zn.call(t,"index")&&(e.index=t.index,e.input=t.input),e};var ro=function(t){var r=new t.constructor(t.byteLength);return new Vr(r).set(new Vr(t)),r};var eo=function(t,r){var e=r?ro(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.byteLength)},no=/\w*$/;var oo=function(t){var r=new t.constructor(t.source,no.exec(t));return r.lastIndex=t.lastIndex,r},io=zt?zt.prototype:void 0,so=io?io.valueOf:void 0;var co=function(t){return so?Object(so.call(t)):{}};var uo=function(t,r){var e=r?ro(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.length)},ao="[object Boolean]",ho="[object Date]",fo="[object Map]",lo="[object Number]",po="[object RegExp]",bo="[object Set]",yo="[object String]",vo="[object Symbol]",_o="[object ArrayBuffer]",wo="[object DataView]",go="[object Float32Array]",$o="[object Float64Array]",jo="[object Int8Array]",mo="[object Int16Array]",So="[object Int32Array]",xo="[object Uint8Array]",Eo="[object Uint8ClampedArray]",Oo="[object Uint16Array]",Ao="[object Uint32Array]";var To=function(t,r,e){var n=t.constructor;switch(r){case _o:return ro(t);case ao:case ho:return new n(+t);case wo:return eo(t,e);case go:case $o:case jo:case mo:case So:case xo:case Eo:case Oo:case Ao:return uo(t,e);case fo:return new n;case lo:case yo:return new n(t);case po:return oo(t);case bo:return new n;case vo:return co(t)}},Po=Object.create,Co=function(){function t(){}return function(r){if(!Gt(r))return{};if(Po)return Po(r);t.prototype=r;var e=new t;return t.prototype=void 0,e}}();var Mo=function(t){return"function"!=typeof t.constructor||je(t)?{}:Co(Gn(t))},Io="[object Map]";var ko=function(t){return Zr(t)&&He(t)==Io},No=ye&&ye.isMap,Uo=No?de(No):ko,zo="[object Set]";var Do=function(t){return Zr(t)&&He(t)==zo},Fo=ye&&ye.isSet,Ho=Fo?de(Fo):Do,Ro=1,Vo=2,Yo=4,Bo="[object Arguments]",Lo="[object Function]",Ko="[object GeneratorFunction]",Wo="[object Object]",qo={};qo[Bo]=qo["[object Array]"]=qo["[object ArrayBuffer]"]=qo["[object DataView]"]=qo["[object Boolean]"]=qo["[object Date]"]=qo["[object Float32Array]"]=qo["[object Float64Array]"]=qo["[object Int8Array]"]=qo["[object Int16Array]"]=qo["[object Int32Array]"]=qo["[object Map]"]=qo["[object Number]"]=qo[Wo]=qo["[object RegExp]"]=qo["[object Set]"]=qo["[object String]"]=qo["[object Symbol]"]=qo["[object Uint8Array]"]=qo["[object Uint8ClampedArray]"]=qo["[object Uint16Array]"]=qo["[object Uint32Array]"]=!0,qo["[object Error]"]=qo[Lo]=qo["[object WeakMap]"]=!1;var Go=function t(r,e,n,o,i,s){var c,u=e&Ro,a=e&Vo,h=e&Yo;if(n&&(c=i?n(r,o,i,s):n(r)),void 0!==c)return c;if(!Gt(r))return r;var f=Lr(r);if(f){if(c=to(r),!u)return Wn(r,c)}else{var l=He(r),p=l==Lo||l==Ko;if(ce(r))return Kn(r,u);if(l==Wo||l==Bo||p&&!i){if(c=a||p?{}:Mo(r),!u)return a?Xn(r,Ln(c,r)):qn(r,Hn(c,r))}else{if(!qo[l])return i?r:{};c=To(r,l,u)}}s||(s=new Rr);var b=s.get(r);if(b)return b;s.set(r,c),Ho(r)?r.forEach((function(o){c.add(t(o,e,n,o,r,s))})):Uo(r)&&r.forEach((function(o,i){c.set(i,t(o,e,n,i,r,s))}));var d=h?a?Qn:Te:a?keysIn:Ae,y=f?void 0:d(r);return kn(y||r,(function(o,i){y&&(o=r[i=o]),Dn(c,i,t(o,e,n,i,r,s))})),c},Jo=4;var Xo=function(t){return Go(t,Jo)};return{ErrorWrapper:class{constructor(t,r){if(!(r instanceof Ze))throw new Error(Ye);this.error=t,this.event=r}get message(){return"string"==typeof this.error?this.error:this.error.message}},Event:Ze,MirrorCollection:class extends on{constructor(t,r){var e;super(t,r),this._$isMap=t instanceof Map,this.$children=new Map,tn(t).forEach((t,r)=>{this.$addChild({key:r,value:t})}),(e=this).$on(Le,t=>{t?t.thrownError?console.warn("changeKeys --- already has error: ",t.thrownError):e.$changeKeys(t.value):console.warn("---- WTF? no event to ACK")},Je)}$has(t){return!this.isStopped&&(this._$isMap?this.value.has(t):t in this.value)}$hasChild(t){return this.$children.has(t)}$changeKeys(t){Xo(this.value);const r=tn(this.value);return tn(t).forEach((e,n)=>{try{r.set(n,e)}catch(o){console.log("error with revision setting ",n,"to",e,"from",t,"to",r)}}),this._$isMap?this.$next(r):this.$next(rn(r))}next(t){return this.$send(Le,tn(t))}$next(t){try{const r=this.$trans(),e=tn(t),n=new Map(e),o=new Map;e.forEach((t,r)=>{this.$hasChild(r)&&(o.set(r,t),this.$children.get(r).next(t),n.delete(r))}),n.size&&super.next(this._$isMap?n:rn(n)),r.complete()}catch(t){console.log("error in $next",t,"from map",z)}}$get(t){if(this.$has(t))return this.$hasChild(t)?this.$children.get(t).$value:this._$isMap?this.value.get(t):this.value[t]}$set(t,r){return this.$send(Le,new Map([[t,r]]))}get object(){return"undefined"==typeof Proxy?rn(this.value):(this._$$objectProxy||(this._$$objectProxy=new Proxy(this,{get:(t,r)=>t.$hasChild(r)?t.$children.get(r).value:t.value.has(r)?t.value.get(r):void 0})),this._$$objectProxy)}$addChild({key:t,value:r}){if(this.$has(t))return this.$set(t,r);const e=new on(r);this.$children.set(t,e);const n=this;return e.$subscribe({next(r){n.$send(Le,new Map([[t,r]]))},error(r){n.$send(...function(t,{child:r,key:e,root:n}){return[Ke,{error:t,child:r,key:e,root:n}]}(r,{child:e,key:t,root:this}))},complete(){n._$deleting!==t&&n.delete(t)}})}$delete(t=Ve){if(t===Ve||!this.$has(t)||this.isStopped)return;this._$deleting=t;const r=this.$trans();if(this.$hasChild(t)){const r=this.$children.get(t);r.isStopped||r.complete(),this.$children.delete(t)}let e=this.getValue();this._$isMap?(e=new Map(e)).delete(t):delete e[t],this.$send(Re,e),delete this._$deleting,r.complete()}get $p(){return this._$p||(this._$p=new Proxy(this,{get(t,r){try{if(t.$has(r))return t._$isMap?t.value.get(r):t.value[r];if(t._$$acts&&t._$$acts.has(r)){const e=t._$acts.get(r);if(e)return e.proxy}return console.warn("--- cannot proxy ",r,"from",t),console.warn("returning raw value:",t[r]),t[r]}catch(e){console.log("error getting",r),console.log("from",t),console.warn(e)}},set:(t,r,e)=>t.$set(r,e)})),this._$p}get $do(){return this._$do||(this._$do=new Proxy(this,{get:(t,r)=>t.$hasAction(r)?t._$acts.get(r).proxy:/^set/i.test(r)?t._$trySet(r):(console.warn("$do-- cannot find action",r),null)})),this._$do}_$trySet(t){const r=this;try{const e=In(`${t}`.replace(/^set/i,""));if(this.$has(e))return t=>this.$set(e,t);const n=e.toLowerCase(),o=[...this.$children.keys(),...tn(this.value).keys()].reduce((e,o)=>{if(e)return e;return`${o}`.toLowerCase()===n?(console.warn(`found key, wrong case: ${t} should be "set${Mn(`${o}`)}".`),t=>r.$set(o,t)):void 0},null);if(o)return o;console.warn("trySet -- cannot match value ",n)}catch(r){console.warn("error trySetting key",t,":",r)}return Be}},mapEmitter:function(t=Ve,r=Be,e=(t=>t)){return new C(t).pipe(function t(r,e){return"function"==typeof e?function(n){return n.pipe(t((function(t,n){return Q(r(t,n)).pipe(z((function(r,o){return e(t,r,n,o)})))})))}:function(t){return t.lift(new yt(r))}}(t=>U(t).pipe(z(r),function(t){return function(r){var e=new ut(t),n=r.lift(e);return e.caught=n}}(t=>U(e(t))))),it(t=>t!==Ve),dt())},Mirror:on,...Qe,...nn}}));
