!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("crypto"),require("buffer")):"function"==typeof define&&define.amd?define(["crypto","buffer"],e):(t=t||self)["@wonderlandlabs/mirror"]=e(t.crypto,t.buffer)}(this,(function(t,e){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function o(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function i(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function a(t,e){for(var r=0,n=e.length,o=t.length;r<n;r++,o++)t[o]=e[r];return t}function u(t){return"function"==typeof t}function c(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var s=c((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function f(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var l=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}var e;return t.prototype.unsubscribe=function(){var t,e,r,n,c;if(!this.closed){this.closed=!0;var f=this._parentage;if(f)if(this._parentage=null,Array.isArray(f))try{for(var l=o(f),h=l.next();!h.done;h=l.next()){h.value.remove(this)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}else f.remove(this);var p=this.initialTeardown;if(u(p))try{p()}catch(t){c=t instanceof s?t.errors:[t]}var d=this._teardowns;if(d){this._teardowns=null;try{for(var y=o(d),b=y.next();!b.done;b=y.next()){var _=b.value;try{v(_)}catch(t){c=null!=c?c:[],t instanceof s?c=a(a([],i(c)),i(t.errors)):c.push(t)}}}catch(t){r={error:t}}finally{try{b&&!b.done&&(n=y.return)&&n.call(y)}finally{if(r)throw r.error}}}if(c)throw new s(c)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)v(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(r=this._teardowns)&&void 0!==r?r:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&f(e,t)},t.prototype.remove=function(e){var r=this._teardowns;r&&f(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}(),h=l.EMPTY;function p(t){return t instanceof l||t&&"closed"in t&&u(t.remove)&&u(t.add)&&u(t.unsubscribe)}function v(t){u(t)?t():t.unsubscribe()}var d={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},y={setTimeout:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=y.delegate;return((null==r?void 0:r.setTimeout)||setTimeout).apply(void 0,a([],i(t)))},clearTimeout:function(t){var e=y.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function b(t){y.setTimeout((function(){throw t}))}function _(){}function g(t){t()}var m=function(t){function e(e){var r=t.call(this)||this;return r.isStopped=!1,e?(r.destination=e,p(e)&&e.add(r)):r.destination=E,r}return n(e,t),e.create=function(t,e,r){return new $(t,e,r)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(l),$=function(t){function e(e,r,n){var o,i=t.call(this)||this;if(u(e))o=e;else if(e){var a;o=e.next,r=e.error,n=e.complete,i&&d.useDeprecatedNextContext?(a=Object.create(e)).unsubscribe=function(){return i.unsubscribe()}:a=e,o=null==o?void 0:o.bind(a),r=null==r?void 0:r.bind(a),n=null==n?void 0:n.bind(a)}return i.destination={next:o?w(o):_,error:w(null!=r?r:j),complete:n?w(n):_},i}return n(e,t),e}(m);function w(t,e){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];try{t.apply(void 0,a([],i(e)))}catch(t){b(t)}}}function j(t){throw t}var E={closed:!0,next:_,error:j,complete:_},O="function"==typeof Symbol&&Symbol.observable||"@@observable";function A(t){return t}function S(t){return 0===t.length?A:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var P=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n,o=this,i=(n=t)&&n instanceof m||function(t){return t&&u(t.next)&&u(t.error)&&u(t.complete)}(n)&&p(n)?t:new $(t,e,r);return g((function(){var t=o,e=t.operator,r=t.source;i.add(e?e.call(i,r):r?o._subscribe(i):o._trySubscribe(i))})),i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=x(e))((function(e,n){var o;o=r.subscribe((function(e){try{t(e)}catch(t){n(t),null==o||o.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[O]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return S(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=x(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function x(t){var e;return null!==(e=null!=t?t:d.Promise)&&void 0!==e?e:Promise}function T(t){return function(e){if(function(t){return u(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}var k=function(t){function e(e,r,n,o,i){var a=t.call(this,e)||this;return a.onFinalize=i,a._next=r?function(t){try{r(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=o?function(t){try{o(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return n(e,t),e.prototype.unsubscribe=function(){var e,r=this.closed;t.prototype.unsubscribe.call(this),!r&&(null===(e=this.onFinalize)||void 0===e||e.call(this))},e}(m),C=c((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),I=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return n(e,t),e.prototype.lift=function(t){var e=new N(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new C},e.prototype.next=function(t){var e=this;g((function(){var r,n;if(e._throwIfClosed(),!e.isStopped){var i=e.observers.slice();try{for(var a=o(i),u=a.next();!u.done;u=a.next()){u.value.next(t)}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}}}))},e.prototype.error=function(t){var e=this;g((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var r=e.observers;r.length;)r.shift().error(t)}}))},e.prototype.complete=function(){var t=this;g((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this.hasError,r=this.isStopped,n=this.observers;return e||r?h:(n.push(t),new l((function(){return f(n,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this.hasError,r=this.thrownError,n=this.isStopped;e?t.error(r):n&&t.complete()},e.prototype.asObservable=function(){var t=new P;return t.source=this,t},e.create=function(t,e){return new N(t,e)},e}(P),N=function(t){function e(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return n(e,t),e.prototype.next=function(t){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===r||r.call(e,t)},e.prototype.error=function(t){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===r||r.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,r;return null!==(r=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==r?r:h},e}(I),F=function(t){function e(e){var r=t.call(this)||this;return r._value=e,r}return n(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(e){var r=t.prototype._subscribe.call(this,e);return!r.closed&&e.next(this._value),r},e.prototype.getValue=function(){var t=this.hasError,e=this.thrownError,r=this._value;if(t)throw e;return this._throwIfClosed(),r},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(I);const D=new Uint8Array(256);let z=D.length;function M(){return z>D.length-16&&(t.randomFillSync(D),z=0),D.slice(z,z+=16)}var V=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function R(t){return"string"==typeof t&&V.test(t)}const U=[];for(let t=0;t<256;++t)U.push((t+256).toString(16).substr(1));function B(t,e=0){const r=(U[t[e+0]]+U[t[e+1]]+U[t[e+2]]+U[t[e+3]]+"-"+U[t[e+4]]+U[t[e+5]]+"-"+U[t[e+6]]+U[t[e+7]]+"-"+U[t[e+8]]+U[t[e+9]]+"-"+U[t[e+10]]+U[t[e+11]]+U[t[e+12]]+U[t[e+13]]+U[t[e+14]]+U[t[e+15]]).toLowerCase();if(!R(r))throw TypeError("Stringified UUID is invalid");return r}let L,Y,q=0,K=0;function W(t){if(!R(t))throw TypeError("Invalid UUID");let e;const r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=255&e,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=255&e,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=255&e,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=255&e,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=255&e,r}function H(t,e,r){function n(t,n,o,i){if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));const e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}(t)),"string"==typeof n&&(n=W(n)),16!==n.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let a=new Uint8Array(16+t.length);if(a.set(n),a.set(t,n.length),a=r(a),a[6]=15&a[6]|e,a[8]=63&a[8]|128,o){i=i||0;for(let t=0;t<16;++t)o[i+t]=a[t];return o}return B(a)}try{n.name=t}catch(t){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n}const G=H("v3",48,(function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),t.createHash("md5").update(e).digest()}));const J=H("v5",80,(function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),t.createHash("sha1").update(e).digest()}));for(var X=Object.freeze({__proto__:null,v1:function(t,e,r){let n=e&&r||0;const o=e||new Array(16);let i=(t=t||{}).node||L,a=void 0!==t.clockseq?t.clockseq:Y;if(null==i||null==a){const e=t.random||(t.rng||M)();null==i&&(i=L=[1|e[0],e[1],e[2],e[3],e[4],e[5]]),null==a&&(a=Y=16383&(e[6]<<8|e[7]))}let u=void 0!==t.msecs?t.msecs:Date.now(),c=void 0!==t.nsecs?t.nsecs:K+1;const s=u-q+(c-K)/1e4;if(s<0&&void 0===t.clockseq&&(a=a+1&16383),(s<0||u>q)&&void 0===t.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");q=u,K=c,Y=a,u+=122192928e5;const f=(1e4*(268435455&u)+c)%4294967296;o[n++]=f>>>24&255,o[n++]=f>>>16&255,o[n++]=f>>>8&255,o[n++]=255&f;const l=u/4294967296*1e4&268435455;o[n++]=l>>>8&255,o[n++]=255&l,o[n++]=l>>>24&15|16,o[n++]=l>>>16&255,o[n++]=a>>>8|128,o[n++]=255&a;for(let t=0;t<6;++t)o[n+t]=i[t];return e||B(o)},v3:G,v4:function(t,e,r){const n=(t=t||{}).random||(t.rng||M)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){r=r||0;for(let t=0;t<16;++t)e[r+t]=n[t];return e}return B(n)},v5:J,NIL:"00000000-0000-0000-0000-000000000000",version:function(t){if(!R(t))throw TypeError("Invalid UUID");return parseInt(t.substr(14,1),16)},validate:R,stringify:B,parse:W}),Q="function"==typeof t.randomUUID?t.randomUUID:X.v4,Z=[],tt={},et=0;et<256;et++)Z[et]=(et+256).toString(16).substr(1),tt[Z[et]]=et;var rt={parse:function(t,e,r){var n=e&&r||0,o=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,(function(t){o<16&&(e[n+o++]=tt[t])}));o<16;)e[n+o++]=0;return e},unparse:function(t,e){var r=e||0,n=Z;return n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]}};const nt=Math.pow(2,31)-1,ot=e.Buffer;function it(t,e){let r=ot.from(rt.parse(t)).toString("base64");const n=r.length;return e?("="===r[n-2]&&"="===r[n-1]&&(r=r.substr(0,n-2)+"-"),r.replace(/\+/g,"_").replace(/\//g,"-")):"="===r[n-2]&&"="===r[n-1]?r.substr(0,n-2)+"/":r}function at(t,e){!!(e=e||{}).urlSafe&&(t=t.replace(/-/g,"/").replace(/_/g,"+"));const r=t.lastIndexOf("/");if(-1===r)return null;const n=t.substring(0,r),o=Number(t.substring(r+1));if(!n||isNaN(o))return null;return{uuid:rt.unparse(ot.from(n+"==","base64")),count:o}}var ut=function(t){let e=!1,r=!1;"boolean"==typeof t?e=t:(r=!!(t=t||{}).urlSafe,e=!!t.fixedLength),i.uuid=Q(),i.decode=at;let n=it(i.uuid,r),o=Math.floor(t.startFrom||0);if(isNaN(o)||!(nt>o&&o>=0))throw new Error([`when passed, opts.startFrom must be a number between 0 and ${nt}.`,"Only the integer part matters.","- got: "+t.startFrom].join("\n"));return i;function i(){const t=e?n+function(t){return t<10?"000000000"+t:t<100?"00000000"+t:t<1e3?"0000000"+t:t<1e4?"000000"+t:t<1e5?"00000"+t:t<1e6?"0000"+t:t<1e7?"000"+t:t<1e8?"00"+t:t<1e9?"0"+t:t}(o++):n+o++;return o===nt&&(i.uuid=Q(),n=it(i.uuid,r),o=0),t}},ct=at;ut.decode=ct;const st=ut();function ft(){return st()}var lt=Object.freeze({__proto__:null,default:ft});function ht(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];if("production"!==process.env.NODE_ENV){var o=Zt[t],i=o?"function"==typeof o?o.apply(null,r):o:"unknown error nr: "+t;throw Error("[Immer] "+i)}throw Error("[Immer] minified error nr: "+t+(r.length?" "+r.map((function(t){return"'"+t+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function pt(t){return!!t&&!!t[Qt]}function vt(t){return!!t&&(function(t){if(!t||"object"!=typeof t)return!1;var e=Object.getPrototypeOf(t);if(null===e)return!0;var r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===te}(t)||Array.isArray(t)||!!t[Xt]||!!t.constructor[Xt]||gt(t)||mt(t))}function dt(t,e,r){void 0===r&&(r=!1),0===yt(t)?(r?Object.keys:ee)(t).forEach((function(n){r&&"symbol"==typeof n||e(n,t[n],t)})):t.forEach((function(r,n){return e(n,r,t)}))}function yt(t){var e=t[Qt];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:gt(t)?2:mt(t)?3:0}function bt(t,e){return 2===yt(t)?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function _t(t,e,r){var n=yt(t);2===n?t.set(e,r):3===n?(t.delete(e),t.add(r)):t[e]=r}function gt(t){return Wt&&t instanceof Map}function mt(t){return Ht&&t instanceof Set}function $t(t){return t.o||t.t}function wt(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=re(t);delete e[Qt];for(var r=ee(e),n=0;n<r.length;n++){var o=r[n],i=e[o];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(e[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:t[o]})}return Object.create(Object.getPrototypeOf(t),e)}function jt(t,e){return void 0===e&&(e=!1),Ot(t)||pt(t)||!vt(t)||(yt(t)>1&&(t.set=t.add=t.clear=t.delete=Et),Object.freeze(t),e&&dt(t,(function(t,e){return jt(e,!0)}),!0)),t}function Et(){ht(2)}function Ot(t){return null==t||"object"!=typeof t||Object.isFrozen(t)}function At(t){var e=ne[t];return e||ht(18,t),e}function St(){return"production"===process.env.NODE_ENV||qt||ht(0),qt}function Pt(t,e){e&&(At("Patches"),t.u=[],t.s=[],t.v=e)}function xt(t){Tt(t),t.p.forEach(Ct),t.p=null}function Tt(t){t===qt&&(qt=t.l)}function kt(t){return qt={p:[],l:qt,h:t,m:!0,_:0}}function Ct(t){var e=t[Qt];0===e.i||1===e.i?e.j():e.O=!0}function It(t,e){e._=e.p.length;var r=e.p[0],n=void 0!==t&&t!==r;return e.h.g||At("ES5").S(e,t,n),n?(r[Qt].P&&(xt(e),ht(4)),vt(t)&&(t=Nt(e,t),e.l||Dt(e,t)),e.u&&At("Patches").M(r[Qt],t,e.u,e.s)):t=Nt(e,r,[]),xt(e),e.u&&e.v(e.u,e.s),t!==Jt?t:void 0}function Nt(t,e,r){if(Ot(e))return e;var n=e[Qt];if(!n)return dt(e,(function(o,i){return Ft(t,n,e,o,i,r)}),!0),e;if(n.A!==t)return e;if(!n.P)return Dt(t,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var o=4===n.i||5===n.i?n.o=wt(n.k):n.o;dt(3===n.i?new Set(o):o,(function(e,i){return Ft(t,n,o,e,i,r)})),Dt(t,o,!1),r&&t.u&&At("Patches").R(n,r,t.u,t.s)}return n.o}function Ft(t,e,r,n,o,i){if("production"!==process.env.NODE_ENV&&o===r&&ht(5),pt(o)){var a=Nt(t,o,i&&e&&3!==e.i&&!bt(e.D,n)?i.concat(n):void 0);if(_t(r,n,a),!pt(a))return;t.m=!1}if(vt(o)&&!Ot(o)){if(!t.h.F&&t._<1)return;Nt(t,o),e&&e.A.l||Dt(t,o)}}function Dt(t,e,r){void 0===r&&(r=!1),t.h.F&&t.m&&jt(e,r)}function zt(t,e){var r=t[Qt];return(r?$t(r):t)[e]}function Mt(t,e){if(e in t)for(var r=Object.getPrototypeOf(t);r;){var n=Object.getOwnPropertyDescriptor(r,e);if(n)return n;r=Object.getPrototypeOf(r)}}function Vt(t){t.P||(t.P=!0,t.l&&Vt(t.l))}function Rt(t){t.o||(t.o=wt(t.t))}function Ut(t,e,r){var n=gt(e)?At("MapSet").N(e,r):mt(e)?At("MapSet").T(e,r):t.g?function(t,e){var r=Array.isArray(t),n={i:r?1:0,A:e?e.A:St(),P:!1,I:!1,D:{},l:e,t:t,k:null,o:null,j:null,C:!1},o=n,i=oe;r&&(o=[n],i=ie);var a=Proxy.revocable(o,i),u=a.revoke,c=a.proxy;return n.k=c,n.j=u,c}(e,r):At("ES5").J(e,r);return(r?r.A:St()).p.push(n),n}function Bt(t){return pt(t)||ht(22,t),function t(e){if(!vt(e))return e;var r,n=e[Qt],o=yt(e);if(n){if(!n.P&&(n.i<4||!At("ES5").K(n)))return n.t;n.I=!0,r=Lt(e,o),n.I=!1}else r=Lt(e,o);return dt(r,(function(e,o){n&&function(t,e){return 2===yt(t)?t.get(e):t[e]}(n.t,e)===o||_t(r,e,t(o))})),3===o?new Set(r):r}(t)}function Lt(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return wt(t)}var Yt,qt,Kt="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),Wt="undefined"!=typeof Map,Ht="undefined"!=typeof Set,Gt="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,Jt=Kt?Symbol.for("immer-nothing"):((Yt={})["immer-nothing"]=!0,Yt),Xt=Kt?Symbol.for("immer-draftable"):"__$immer_draftable",Qt=Kt?Symbol.for("immer-state"):"__$immer_state",Zt={0:"Illegal state",1:"Immer drafts cannot have computed properties",2:"This object has been frozen and should not be mutated",3:function(t){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+t},4:"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.",5:"Immer forbids circular references",6:"The first or second argument to `produce` must be a function",7:"The third argument to `produce` must be a function or undefined",8:"First argument to `createDraft` must be a plain object, an array, or an immerable object",9:"First argument to `finishDraft` must be a draft returned by `createDraft`",10:"The given draft is already finalized",11:"Object.defineProperty() cannot be used on an Immer draft",12:"Object.setPrototypeOf() cannot be used on an Immer draft",13:"Immer only supports deleting array indices",14:"Immer only supports setting array indices and the 'length' property",15:function(t){return"Cannot apply patch, path doesn't resolve: "+t},16:'Sets cannot have "replace" patches.',17:function(t){return"Unsupported patch operation: "+t},18:function(t){return"The plugin for '"+t+"' has not been loaded into Immer. To enable the plugin, import and call `enable"+t+"()` when initializing your application."},20:"Cannot use proxies if Proxy, Proxy.revocable or Reflect are not available",21:function(t){return"produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '"+t+"'"},22:function(t){return"'current' expects a draft, got: "+t},23:function(t){return"'original' expects a draft, got: "+t},24:"Patching reserved attributes like __proto__, prototype and constructor is not allowed"},te=""+Object.prototype.constructor,ee="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,re=Object.getOwnPropertyDescriptors||function(t){var e={};return ee(t).forEach((function(r){e[r]=Object.getOwnPropertyDescriptor(t,r)})),e},ne={},oe={get:function(t,e){if(e===Qt)return t;var r=$t(t);if(!bt(r,e))return function(t,e,r){var n,o=Mt(e,r);return o?"value"in o?o.value:null===(n=o.get)||void 0===n?void 0:n.call(t.k):void 0}(t,r,e);var n=r[e];return t.I||!vt(n)?n:n===zt(t.t,e)?(Rt(t),t.o[e]=Ut(t.A.h,n,t)):n},has:function(t,e){return e in $t(t)},ownKeys:function(t){return Reflect.ownKeys($t(t))},set:function(t,e,r){var n=Mt($t(t),e);if(null==n?void 0:n.set)return n.set.call(t.k,r),!0;if(!t.P){var o=zt($t(t),e),i=null==o?void 0:o[Qt];if(i&&i.t===r)return t.o[e]=r,t.D[e]=!1,!0;if(function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}(r,o)&&(void 0!==r||bt(t.t,e)))return!0;Rt(t),Vt(t)}return t.o[e]===r&&"number"!=typeof r&&(void 0!==r||e in t.o)||(t.o[e]=r,t.D[e]=!0,!0)},deleteProperty:function(t,e){return void 0!==zt(t.t,e)||e in t.t?(t.D[e]=!1,Rt(t),Vt(t)):delete t.D[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var r=$t(t),n=Reflect.getOwnPropertyDescriptor(r,e);return n?{writable:!0,configurable:1!==t.i||"length"!==e,enumerable:n.enumerable,value:r[e]}:n},defineProperty:function(){ht(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){ht(12)}},ie={};dt(oe,(function(t,e){ie[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}})),ie.deleteProperty=function(t,e){return"production"!==process.env.NODE_ENV&&isNaN(parseInt(e))&&ht(13),oe.deleteProperty.call(this,t[0],e)},ie.set=function(t,e,r){return"production"!==process.env.NODE_ENV&&"length"!==e&&isNaN(parseInt(e))&&ht(14),oe.set.call(this,t[0],e,r,t[0])};var ae=new(function(){function t(t){var e=this;this.g=Gt,this.F=!0,this.produce=function(t,r,n){if("function"==typeof t&&"function"!=typeof r){var o=r;r=t;var i=e;return function(t){var e=this;void 0===t&&(t=o);for(var n=arguments.length,a=Array(n>1?n-1:0),u=1;u<n;u++)a[u-1]=arguments[u];return i.produce(t,(function(t){var n;return(n=r).call.apply(n,[e,t].concat(a))}))}}var a;if("function"!=typeof r&&ht(6),void 0!==n&&"function"!=typeof n&&ht(7),vt(t)){var u=kt(e),c=Ut(e,t,void 0),s=!0;try{a=r(c),s=!1}finally{s?xt(u):Tt(u)}return"undefined"!=typeof Promise&&a instanceof Promise?a.then((function(t){return Pt(u,n),It(t,u)}),(function(t){throw xt(u),t})):(Pt(u,n),It(a,u))}if(!t||"object"!=typeof t){if((a=r(t))===Jt)return;return void 0===a&&(a=t),e.F&&jt(a,!0),a}ht(21,t)},this.produceWithPatches=function(t,r){return"function"==typeof t?function(r){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];return e.produceWithPatches(r,(function(e){return t.apply(void 0,[e].concat(o))}))}:[e.produce(t,r,(function(t,e){n=t,o=e})),n,o];var n,o},"boolean"==typeof(null==t?void 0:t.useProxies)&&this.setUseProxies(t.useProxies),"boolean"==typeof(null==t?void 0:t.autoFreeze)&&this.setAutoFreeze(t.autoFreeze)}var e=t.prototype;return e.createDraft=function(t){vt(t)||ht(8),pt(t)&&(t=Bt(t));var e=kt(this),r=Ut(this,t,void 0);return r[Qt].C=!0,Tt(e),r},e.finishDraft=function(t,e){var r=t&&t[Qt];"production"!==process.env.NODE_ENV&&(r&&r.C||ht(9),r.I&&ht(10));var n=r.A;return Pt(n,e),It(void 0,n)},e.setAutoFreeze=function(t){this.F=t},e.setUseProxies=function(t){t&&!Gt&&ht(20),this.g=t},e.applyPatches=function(t,e){var r;for(r=e.length-1;r>=0;r--){var n=e[r];if(0===n.path.length&&"replace"===n.op){t=n.value;break}}var o=At("Patches").$;return pt(t)?o(t,e):this.produce(t,(function(t){return o(t,e.slice(r+1))}))},t}()),ue=ae.produce;ae.produceWithPatches.bind(ae),ae.setAutoFreeze.bind(ae),ae.setUseProxies.bind(ae),ae.applyPatches.bind(ae),ae.createDraft.bind(ae),ae.finishDraft.bind(ae);var ce=function(){this.__data__=[],this.size=0};var se=function(t,e){return t===e||t!=t&&e!=e};var fe=function(t,e){for(var r=t.length;r--;)if(se(t[r][0],e))return r;return-1},le=Array.prototype.splice;var he=function(t){var e=this.__data__,r=fe(e,t);return!(r<0)&&(r==e.length-1?e.pop():le.call(e,r,1),--this.size,!0)};var pe=function(t){var e=this.__data__,r=fe(e,t);return r<0?void 0:e[r][1]};var ve=function(t){return fe(this.__data__,t)>-1};var de=function(t,e){var r=this.__data__,n=fe(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function ye(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ye.prototype.clear=ce,ye.prototype.delete=he,ye.prototype.get=pe,ye.prototype.has=ve,ye.prototype.set=de;var be=ye;var _e=function(){this.__data__=new be,this.size=0};var ge=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var me=function(t){return this.__data__.get(t)};var $e=function(t){return this.__data__.has(t)},we="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function je(t,e){return t(e={exports:{}},e.exports),e.exports}var Ee="object"==typeof we&&we&&we.Object===Object&&we,Oe="object"==typeof self&&self&&self.Object===Object&&self,Ae=Ee||Oe||Function("return this")(),Se=Ae.Symbol,Pe=Object.prototype,xe=Pe.hasOwnProperty,Te=Pe.toString,ke=Se?Se.toStringTag:void 0;var Ce=function(t){var e=xe.call(t,ke),r=t[ke];try{t[ke]=void 0;var n=!0}catch(t){}var o=Te.call(t);return n&&(e?t[ke]=r:delete t[ke]),o},Ie=Object.prototype.toString;var Ne=function(t){return Ie.call(t)},Fe=Se?Se.toStringTag:void 0;var De=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Fe&&Fe in Object(t)?Ce(t):Ne(t)};var ze=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var Me,Ve=function(t){if(!ze(t))return!1;var e=De(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},Re=Ae["__core-js_shared__"],Ue=(Me=/[^.]+$/.exec(Re&&Re.keys&&Re.keys.IE_PROTO||""))?"Symbol(src)_1."+Me:"";var Be=function(t){return!!Ue&&Ue in t},Le=Function.prototype.toString;var Ye=function(t){if(null!=t){try{return Le.call(t)}catch(t){}try{return t+""}catch(t){}}return""},qe=/^\[object .+?Constructor\]$/,Ke=Function.prototype,We=Object.prototype,He=Ke.toString,Ge=We.hasOwnProperty,Je=RegExp("^"+He.call(Ge).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Xe=function(t){return!(!ze(t)||Be(t))&&(Ve(t)?Je:qe).test(Ye(t))};var Qe=function(t,e){return null==t?void 0:t[e]};var Ze=function(t,e){var r=Qe(t,e);return Xe(r)?r:void 0},tr=Ze(Ae,"Map"),er=Ze(Object,"create");var rr=function(){this.__data__=er?er(null):{},this.size=0};var nr=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},or=Object.prototype.hasOwnProperty;var ir=function(t){var e=this.__data__;if(er){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return or.call(e,t)?e[t]:void 0},ar=Object.prototype.hasOwnProperty;var ur=function(t){var e=this.__data__;return er?void 0!==e[t]:ar.call(e,t)};var cr=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=er&&void 0===e?"__lodash_hash_undefined__":e,this};function sr(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}sr.prototype.clear=rr,sr.prototype.delete=nr,sr.prototype.get=ir,sr.prototype.has=ur,sr.prototype.set=cr;var fr=sr;var lr=function(){this.size=0,this.__data__={hash:new fr,map:new(tr||be),string:new fr}};var hr=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var pr=function(t,e){var r=t.__data__;return hr(e)?r["string"==typeof e?"string":"hash"]:r.map};var vr=function(t){var e=pr(this,t).delete(t);return this.size-=e?1:0,e};var dr=function(t){return pr(this,t).get(t)};var yr=function(t){return pr(this,t).has(t)};var br=function(t,e){var r=pr(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function _r(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}_r.prototype.clear=lr,_r.prototype.delete=vr,_r.prototype.get=dr,_r.prototype.has=yr,_r.prototype.set=br;var gr=_r;var mr=function(t,e){var r=this.__data__;if(r instanceof be){var n=r.__data__;if(!tr||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new gr(n)}return r.set(t,e),this.size=r.size,this};function $r(t){var e=this.__data__=new be(t);this.size=e.size}$r.prototype.clear=_e,$r.prototype.delete=ge,$r.prototype.get=me,$r.prototype.has=$e,$r.prototype.set=mr;var wr=$r;var jr=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var Er=function(t){return this.__data__.has(t)};function Or(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new gr;++e<r;)this.add(t[e])}Or.prototype.add=Or.prototype.push=jr,Or.prototype.has=Er;var Ar=Or;var Sr=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1};var Pr=function(t,e){return t.has(e)};var xr=function(t,e,r,n,o,i){var a=1&r,u=t.length,c=e.length;if(u!=c&&!(a&&c>u))return!1;var s=i.get(t),f=i.get(e);if(s&&f)return s==e&&f==t;var l=-1,h=!0,p=2&r?new Ar:void 0;for(i.set(t,e),i.set(e,t);++l<u;){var v=t[l],d=e[l];if(n)var y=a?n(d,v,l,e,t,i):n(v,d,l,t,e,i);if(void 0!==y){if(y)continue;h=!1;break}if(p){if(!Sr(e,(function(t,e){if(!Pr(p,e)&&(v===t||o(v,t,r,n,i)))return p.push(e)}))){h=!1;break}}else if(v!==d&&!o(v,d,r,n,i)){h=!1;break}}return i.delete(t),i.delete(e),h},Tr=Ae.Uint8Array;var kr=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r};var Cr=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},Ir=Se?Se.prototype:void 0,Nr=Ir?Ir.valueOf:void 0;var Fr=function(t,e,r,n,o,i,a){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new Tr(t),new Tr(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return se(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var u=kr;case"[object Set]":var c=1&n;if(u||(u=Cr),t.size!=e.size&&!c)return!1;var s=a.get(t);if(s)return s==e;n|=2,a.set(t,e);var f=xr(u(t),u(e),n,o,i,a);return a.delete(t),f;case"[object Symbol]":if(Nr)return Nr.call(t)==Nr.call(e)}return!1};var Dr=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},zr=Array.isArray;var Mr=function(t,e,r){var n=e(t);return zr(t)?n:Dr(n,r(t))};var Vr=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[o++]=a)}return i};var Rr=function(){return[]},Ur=Object.prototype.propertyIsEnumerable,Br=Object.getOwnPropertySymbols,Lr=Br?function(t){return null==t?[]:(t=Object(t),Vr(Br(t),(function(e){return Ur.call(t,e)})))}:Rr;var Yr=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var qr=function(t){return null!=t&&"object"==typeof t};var Kr=function(t){return qr(t)&&"[object Arguments]"==De(t)},Wr=Object.prototype,Hr=Wr.hasOwnProperty,Gr=Wr.propertyIsEnumerable,Jr=Kr(function(){return arguments}())?Kr:function(t){return qr(t)&&Hr.call(t,"callee")&&!Gr.call(t,"callee")};var Xr=function(){return!1},Qr=je((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?Ae.Buffer:void 0,i=(o?o.isBuffer:void 0)||Xr;t.exports=i})),Zr=/^(?:0|[1-9]\d*)$/;var tn=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&Zr.test(t))&&t>-1&&t%1==0&&t<e};var en=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},rn={};rn["[object Float32Array]"]=rn["[object Float64Array]"]=rn["[object Int8Array]"]=rn["[object Int16Array]"]=rn["[object Int32Array]"]=rn["[object Uint8Array]"]=rn["[object Uint8ClampedArray]"]=rn["[object Uint16Array]"]=rn["[object Uint32Array]"]=!0,rn["[object Arguments]"]=rn["[object Array]"]=rn["[object ArrayBuffer]"]=rn["[object Boolean]"]=rn["[object DataView]"]=rn["[object Date]"]=rn["[object Error]"]=rn["[object Function]"]=rn["[object Map]"]=rn["[object Number]"]=rn["[object Object]"]=rn["[object RegExp]"]=rn["[object Set]"]=rn["[object String]"]=rn["[object WeakMap]"]=!1;var nn=function(t){return qr(t)&&en(t.length)&&!!rn[De(t)]};var on=function(t){return function(e){return t(e)}},an=je((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&Ee.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),un=an&&an.isTypedArray,cn=un?on(un):nn,sn=Object.prototype.hasOwnProperty;var fn=function(t,e){var r=zr(t),n=!r&&Jr(t),o=!r&&!n&&Qr(t),i=!r&&!n&&!o&&cn(t),a=r||n||o||i,u=a?Yr(t.length,String):[],c=u.length;for(var s in t)!e&&!sn.call(t,s)||a&&("length"==s||o&&("offset"==s||"parent"==s)||i&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||tn(s,c))||u.push(s);return u},ln=Object.prototype;var hn=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||ln)};var pn=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),vn=Object.prototype.hasOwnProperty;var dn=function(t){if(!hn(t))return pn(t);var e=[];for(var r in Object(t))vn.call(t,r)&&"constructor"!=r&&e.push(r);return e};var yn=function(t){return null!=t&&en(t.length)&&!Ve(t)};var bn=function(t){return yn(t)?fn(t):dn(t)};var _n=function(t){return Mr(t,bn,Lr)},gn=Object.prototype.hasOwnProperty;var mn=function(t,e,r,n,o,i){var a=1&r,u=_n(t),c=u.length;if(c!=_n(e).length&&!a)return!1;for(var s=c;s--;){var f=u[s];if(!(a?f in e:gn.call(e,f)))return!1}var l=i.get(t),h=i.get(e);if(l&&h)return l==e&&h==t;var p=!0;i.set(t,e),i.set(e,t);for(var v=a;++s<c;){var d=t[f=u[s]],y=e[f];if(n)var b=a?n(y,d,f,e,t,i):n(d,y,f,t,e,i);if(!(void 0===b?d===y||o(d,y,r,n,i):b)){p=!1;break}v||(v="constructor"==f)}if(p&&!v){var _=t.constructor,g=e.constructor;_==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof g&&g instanceof g||(p=!1)}return i.delete(t),i.delete(e),p},$n=Ze(Ae,"DataView"),wn=Ze(Ae,"Promise"),jn=Ze(Ae,"Set"),En=Ze(Ae,"WeakMap"),On=Ye($n),An=Ye(tr),Sn=Ye(wn),Pn=Ye(jn),xn=Ye(En),Tn=De;($n&&"[object DataView]"!=Tn(new $n(new ArrayBuffer(1)))||tr&&"[object Map]"!=Tn(new tr)||wn&&"[object Promise]"!=Tn(wn.resolve())||jn&&"[object Set]"!=Tn(new jn)||En&&"[object WeakMap]"!=Tn(new En))&&(Tn=function(t){var e=De(t),r="[object Object]"==e?t.constructor:void 0,n=r?Ye(r):"";if(n)switch(n){case On:return"[object DataView]";case An:return"[object Map]";case Sn:return"[object Promise]";case Pn:return"[object Set]";case xn:return"[object WeakMap]"}return e});var kn=Tn,Cn=Object.prototype.hasOwnProperty;var In=function(t,e,r,n,o,i){var a=zr(t),u=zr(e),c=a?"[object Array]":kn(t),s=u?"[object Array]":kn(e),f="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),l="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s),h=c==s;if(h&&Qr(t)){if(!Qr(e))return!1;a=!0,f=!1}if(h&&!f)return i||(i=new wr),a||cn(t)?xr(t,e,r,n,o,i):Fr(t,e,c,r,n,o,i);if(!(1&r)){var p=f&&Cn.call(t,"__wrapped__"),v=l&&Cn.call(e,"__wrapped__");if(p||v){var d=p?t.value():t,y=v?e.value():e;return i||(i=new wr),o(d,y,r,n,i)}}return!!h&&(i||(i=new wr),mn(t,e,r,n,o,i))};var Nn=function t(e,r,n,o,i){return e===r||(null==e||null==r||!qr(e)&&!qr(r)?e!=e&&r!=r:In(e,r,n,o,t,i))};var Fn=function(t,e){return Nn(t,e)};var Dn=function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1};var zn=function(t){return t!=t};var Mn=function(t,e,r){for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1};var Vn=function(t,e,r){return e==e?Mn(t,e,r):Dn(t,zn,r)};var Rn=function(t,e){return!!(null==t?0:t.length)&&Vn(t,e,0)>-1};var Un=function(t,e,r){for(var n=-1,o=null==t?0:t.length;++n<o;)if(r(e,t[n]))return!0;return!1};var Bn=function(){},Ln=jn&&1/Cr(new jn([,-0]))[1]==1/0?function(t){return new jn(t)}:Bn;var Yn=function(t,e,r){var n=-1,o=Rn,i=t.length,a=!0,u=[],c=u;if(r)a=!1,o=Un;else if(i>=200){var s=e?null:Ln(t);if(s)return Cr(s);a=!1,o=Pr,c=new Ar}else c=e?[]:u;t:for(;++n<i;){var f=t[n],l=e?e(f):f;if(f=r||0!==f?f:0,a&&l==l){for(var h=c.length;h--;)if(c[h]===l)continue t;e&&c.push(l),u.push(f)}else o(c,l,r)||(c!==u&&c.push(l),u.push(f))}return u};var qn=function(t){return t&&t.length?Yn(t):[]};var Kn=function(t){return"symbol"==typeof t||qr(t)&&"[object Symbol]"==De(t)},Wn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hn=/^\w*$/;var Gn=function(t,e){if(zr(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!Kn(t))||(Hn.test(t)||!Wn.test(t)||null!=e&&t in Object(e))};function Jn(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var a=t.apply(this,n);return r.cache=i.set(o,a)||i,a};return r.cache=new(Jn.Cache||gr),r}Jn.Cache=gr;var Xn=Jn;var Qn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Zn=/\\(\\)?/g,to=function(t){var e=Xn(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Qn,(function(t,r,n,o){e.push(n?o.replace(Zn,"$1"):r||t)})),e}));var eo=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},ro=Se?Se.prototype:void 0,no=ro?ro.toString:void 0;var oo=function t(e){if("string"==typeof e)return e;if(zr(e))return eo(e,t)+"";if(Kn(e))return no?no.call(e):"";var r=e+"";return"0"==r&&1/e==-1/0?"-0":r};var io=function(t){return null==t?"":oo(t)};var ao=function(t,e){return zr(t)?t:Gn(t,e)?[t]:to(io(t))};var uo=function(t){if("string"==typeof t||Kn(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e};var co=function(t,e){for(var r=0,n=(e=ao(e,t)).length;null!=t&&r<n;)t=t[uo(e[r++])];return r&&r==n?t:void 0};var so=function(t,e,r){var n=null==t?void 0:co(t,e);return void 0===n?r:n},fo=Se?Se.isConcatSpreadable:void 0;var lo=function(t){return zr(t)||Jr(t)||!!(fo&&t&&t[fo])};var ho=function t(e,r,n,o,i){var a=-1,u=e.length;for(n||(n=lo),i||(i=[]);++a<u;){var c=e[a];r>0&&n(c)?r>1?t(c,r-1,n,o,i):Dr(i,c):o||(i[i.length]=c)}return i};var po=function(t,e,r,n){var o=r.length,i=o,a=!n;if(null==t)return!i;for(t=Object(t);o--;){var u=r[o];if(a&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++o<i;){var c=(u=r[o])[0],s=t[c],f=u[1];if(a&&u[2]){if(void 0===s&&!(c in t))return!1}else{var l=new wr;if(n)var h=n(s,f,c,t,e,l);if(!(void 0===h?Nn(f,s,3,n,l):h))return!1}}return!0};var vo=function(t){return t==t&&!ze(t)};var yo=function(t){for(var e=bn(t),r=e.length;r--;){var n=e[r],o=t[n];e[r]=[n,o,vo(o)]}return e};var bo=function(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}};var _o=function(t){var e=yo(t);return 1==e.length&&e[0][2]?bo(e[0][0],e[0][1]):function(r){return r===t||po(r,t,e)}};var go=function(t,e){return null!=t&&e in Object(t)};var mo=function(t,e,r){for(var n=-1,o=(e=ao(e,t)).length,i=!1;++n<o;){var a=uo(e[n]);if(!(i=null!=t&&r(t,a)))break;t=t[a]}return i||++n!=o?i:!!(o=null==t?0:t.length)&&en(o)&&tn(a,o)&&(zr(t)||Jr(t))};var $o=function(t,e){return null!=t&&mo(t,e,go)};var wo=function(t,e){return Gn(t)&&vo(e)?bo(uo(t),e):function(r){var n=so(r,t);return void 0===n&&n===e?$o(r,t):Nn(e,n,3)}};var jo=function(t){return t};var Eo=function(t){return function(e){return null==e?void 0:e[t]}};var Oo=function(t){return function(e){return co(e,t)}};var Ao=function(t){return Gn(t)?Eo(uo(t)):Oo(t)};var So=function(t){return"function"==typeof t?t:null==t?jo:"object"==typeof t?zr(t)?wo(t[0],t[1]):_o(t):Ao(t)};var Po=function(t){return function(e,r,n){for(var o=-1,i=Object(e),a=n(e),u=a.length;u--;){var c=a[t?u:++o];if(!1===r(i[c],c,i))break}return e}}();var xo=function(t,e){return function(r,n){if(null==r)return r;if(!yn(r))return t(r,n);for(var o=r.length,i=e?o:-1,a=Object(r);(e?i--:++i<o)&&!1!==n(a[i],i,a););return r}}((function(t,e){return t&&Po(t,e,bn)}));var To=function(t,e){var r=-1,n=yn(t)?Array(t.length):[];return xo(t,(function(t,o,i){n[++r]=e(t,o,i)})),n};var ko=function(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t};var Co=function(t,e){if(t!==e){var r=void 0!==t,n=null===t,o=t==t,i=Kn(t),a=void 0!==e,u=null===e,c=e==e,s=Kn(e);if(!u&&!s&&!i&&t>e||i&&a&&c&&!u&&!s||n&&a&&c||!r&&c||!o)return 1;if(!n&&!i&&!s&&t<e||s&&r&&o&&!n&&!i||u&&r&&o||!a&&o||!c)return-1}return 0};var Io=function(t,e,r){for(var n=-1,o=t.criteria,i=e.criteria,a=o.length,u=r.length;++n<a;){var c=Co(o[n],i[n]);if(c)return n>=u?c:c*("desc"==r[n]?-1:1)}return t.index-e.index};var No=function(t,e,r){e=e.length?eo(e,(function(t){return zr(t)?function(e){return co(e,1===t.length?t[0]:t)}:t})):[jo];var n=-1;e=eo(e,on(So));var o=To(t,(function(t,r,o){return{criteria:eo(e,(function(e){return e(t)})),index:++n,value:t}}));return ko(o,(function(t,e){return Io(t,e,r)}))};var Fo=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},Do=Math.max;var zo=function(t,e,r){return e=Do(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=Do(n.length-e,0),a=Array(i);++o<i;)a[o]=n[e+o];o=-1;for(var u=Array(e+1);++o<e;)u[o]=n[o];return u[e]=r(a),Fo(t,this,u)}};var Mo=function(t){return function(){return t}},Vo=function(){try{var t=Ze(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Ro=Vo?function(t,e){return Vo(t,"toString",{configurable:!0,enumerable:!1,value:Mo(e),writable:!0})}:jo,Uo=Date.now;var Bo=function(t){var e=0,r=0;return function(){var n=Uo(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(Ro);var Lo=function(t,e,r){if(!ze(r))return!1;var n=typeof e;return!!("number"==n?yn(r)&&tn(e,r.length):"string"==n&&e in r)&&se(r[e],t)},Yo=function(t,e){return Bo(zo(t,e,jo),t+"")}((function(t,e){if(null==t)return[];var r=e.length;return r>1&&Lo(t,e[0],e[1])?e=[]:r>2&&Lo(e[0],e[1],e[2])&&(e=[e[0]]),No(t,ho(e,1),[])}));var qo=function(t){for(var e=-1,r=null==t?0:t.length,n=0,o=[];++e<r;){var i=t[e];i&&(o[n++]=i)}return o};const Ko=Symbol("type:map"),Wo=Symbol("type:object"),Ho=Symbol("type:value"),Go=Symbol("type:array"),Jo=Symbol("unnamed"),Xo=Symbol("ABSENT"),Qo=Symbol("CHILDREN"),Zo=/^set(.+)$/i;var ti=Object.freeze({__proto__:null,TYPE_MAP:Ko,TYPE_OBJECT:Wo,TYPE_VALUE:Ho,TYPE_ARRAY:Go,NAME_UNNAMED:Jo,ABSENT:Xo,CHILDREN:Qo,EVENT_TYPE_NEXT:"next",EVENT_TYPE_SET:"set",EVENT_TYPE_DEBUG:"debug",EVENT_TYPE_ACCEPT_FROM:"event:acceptFrom",EVENT_TYPE_REMOVE_FROM:"event:removeFrom",EVENT_TYPE_FLUSH_ACTIVE:"event:commit",EVENT_TYPE_ACTION:"event:action",EVENT_TYPE_MUTATE:"event:mutate",EVENT_TYPE_VALIDATE:"event:validate",SET_RE:Zo,MIRROR_EVENT_STATE_ACTIVE:"mirror-event-state:active",MIRROR_EVENT_STATE_ERROR:"mirror-state:error",MIRROR_EVENT_STATE_STOPPED:"mirror-state:stopped",MIRROR_EVENT_STATE_COMPLETE:"mirror-state:stopped"});const ei=require("lodash/isNumber");function ri(t){return![Xo,Jo,void 0].includes(t)}function ni(t){return ci(t,!0)?t.charAt(0).toUpperCase()+t.slice(1):""}function oi(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!(t instanceof Map)}function ii(t,e=!1){return Array.isArray(t)&&(!e||t.length)}const ai=t=>t&&t instanceof Map,ui=t=>"function"==typeof t;function ci(t,e=!1){return"string"==typeof t&&(!e||!!t)}function si(t){let e=Ho;return ai(t)&&(e=Ko),ii(t)&&(e=Go),oi(t)&&(e=Wo),e}function fi(t,e,r=null){r||(r=si(t));let n=!1;switch(r){case Ho:n=!1;break;case Wo:n=e in t;break;case Ko:n=t.has(e);break;case Go:n=!(!ii(t)||li(e))&&e<t.length;break;default:n=!1}return n}function li(t){return!!ei(t)&&(t>=0&&!(t%2))}function hi(t,e,r=null){r||(r=si(t));let n=null;switch(r){case Ho:n=null;break;case Wo:n=t[e];break;case Ko:n=t.get(e);break;case Go:n=t[e];break;default:n=null}return n}function pi(t,e,r,n=null){switch(n||(n=si(t)),n){case Wo:t[e]=r;break;case Ko:t.set(e,r);break;case Go:t[e]=r}return t}function vi(t,e){if(t instanceof Map)return e?new Map(t):t;const r=new Map;return Object.keys(t).forEach(e=>r.set(e,t[e])),r}function di(t){try{return ue(t,t=>t)}catch(e){return t}}var yi=Object.freeze({__proto__:null,lazy:function(t,e,r){const n=r(t,e);return Object.defineProperty(t,e,{value:n}),n},produce:ue,isEqual:Fn,uniq:qn,lGet:so,sortBy:Yo,asImmer:di,compact:qo,getKey:hi,setKey:pi,isNumber:ei,isThere:ri,ucFirst:ni,isObj:oi,isArr:ii,isMap:ai,isFn:ui,e:(t,e={})=>("string"==typeof t&&(t=new Error(t)),ri(e)?oi(e)||(e={notes:e}):e={},Object.assign(t,e)),isStr:ci,typeOfValue:si,hasKey:fi,isWhole:li,toMap:vi,toObj:function(t,e=!1){if(!oi(t)&&!ai(t))throw Object.assign(new Error("cannot convert target to object"),{target:t});let r=t;return oi(t)?e&&(r={...t}):ai(t)&&(r={},t.forEach((e,n)=>{if(ei(e)||ci(e,!0))try{r[n]=e}catch(e){console.warn("toObj map/object conversion -- skipping exporting of child key",n,"of ",t)}})),r}});let bi=0;class _i{constructor(t,e,r){this._value=t,this.$type=e,this.$target=r,this.$id=ft(),this.$order=bi,bi+=1,this._state="mirror-event-state:active"}get value(){return this._value}get state(){return this._state}set state(t){this.isStopped||(this._state=t)}watch(t){}get hasError(){return"mirror-state:error"===this.state}get isStopped(){return"mirror-event-state:active"!==this.state}matches(t){return t===this||t===this.$id}$isAfter(t){return ei(t)?this.$order>t:t instanceof _i&&this.$isAfter(t.$order)}$isBefore(t){return ei(t)?this.$order<t:t instanceof _i&&this.$isBefore(t.$order)}error(t){this.state="mirror-state:error",this.thrownError=t}complete(){this.state="mirror-state:stopped"}}var gi=t=>class extends t{constructor(...t){super(...t),this.$on("next",(t,e,r)=>{r.$_pushActive(e)}),this.$on("event:validate",(t,e,r)=>{!e.hasError&&r.$_hasChildren&&r.$children.forEach(r=>{e.hasError||r.$send("event:validate",t)})}),this.$on("event:commit",(t,e,r)=>{t.hasError&&(r.$root.$send("event:removeFrom",t.$order,!0),e.error(t.thrownError)),r.$root.$send("event:acceptFrom",t.$order)}),this.$on("event:removeFrom",(t,e,r)=>{r.$children.forEach(e=>{e.$send("event:removeFrom",t,!0)}),r.$_removeFromActive(t,!0)}),this.$on("event:acceptFrom",(t,e,r)=>{if(r.$_allActive.find(e=>"event:action"===e.$type&&e.$isBefore(t)))return;r.$children.forEach(e=>{e.$send("event:acceptFrom",t)});const n=r.$lastChange;n&&!n.$isBefore(t)&&r.$next(n.value),r.$_removeFromActive(t,!0)})}get $events(){return this.$_events||(this.$_events=new I),this.$_events}get $_active(){return this.$__active||(this.$__active=[]),this.$__active}get $_allActive(){if(this.$parent)return this.$root.$_downActive;let t=[...this.$_active];return this.$_hasChildren&&this.$children.forEach(e=>{t=qo([...t,...e.$_downActive])}),t}get $_downActive(){let t=[...this.$_active];return this.$_hasChildren&&this.$children.forEach(e=>{t=qo([...t,...e.$_downActive])}),t}set $_active(t){ii(t)&&(this.$__active=t,this.$watchActive&&this.$watchActive(t))}$_removeFromActive(t,e=!1){let r=[...this.$_active];r=e?r.filter(e=>e.$isBefore(t)):ei(t)?r.filter(e=>e.$order!==t):r.filter(e=>!e.matches(t)),r.length!==this.$_active.length&&(this.$_active=r)}$_pushActive(t){return this.$_active=[...this.$_active,t],t}get $_activeErrors(){return this.$_allActive.filter(t=>t.hasError)}get $lastChange(){return this.$__active?this.$_active.reduce((t,e)=>"next"!==e.$type||e.hasError?t:e,null):null}$send(t,e,r=!1){const n=new _i(e,t,this);return this.$events.next(n),r&&!n.isStopped&&n.complete(),n}$on(t,e){const r=this;return this.$events.pipe((n=e=>e.$type===t,T((function(t,e){var r=0;t.subscribe(new k(e,(function(t){return n.call(o,t,r++)&&e.next(t)})))})))).subscribe({next(t){if(!t.isStopped)try{e(t.value,t,r)}catch(e){console.log("--- error on handler: ",e),t.isStopped||t.error(e)}}});var n,o}};function mi(t){return t.$_doProxy?t.$_doProxy:"undefined"==typeof Proxy?function(t){const e={};switch(t.$_actions.forEach((t,r)=>{try{e[r]=t}catch(t){}}),t.$type){case Wo:Object.keys(t.value).forEach(r=>{const n="set"+ni(r);e[n]=e=>t.$set(r,e)});break;case Ko:t.value.keys().forEach(r=>{const n="set"+ni(r);e[n]=e=>t.$set(r,e)})}return e}(t):new Proxy(t,{get(t,e){if(t.$_actions.has(e))return t.$_actions.get(e);if(ci(e)){const r=e.match(Zo);if(r){const[e,n]=r;if(t.$keyFor(n))return e=>t.$set(n,e)}}return()=>{throw new Error("no action named "+e)}}})}var $i=t=>class extends t{constructor(t,e,...r){super(t,e,...r),e&&this.$_configActions(e),this.$on("event:action",({fn:t,args:e},r,n)=>{if(!r.isStopped){n.$_pushActive(r);try{t(n,...e)}catch(t){r.error(t)}}})}get $_actions(){return this.$__actions||(this.$__actions=new Map),this.$__actions}get $isInAction(){return!!this.$_allActive.find(({type:t,committed:e})=>!e&&"event:action"===t)}$addAction(t,e){this.$_actions.set(t,(...t)=>this.$act(e,t)),"undefined"==typeof Proxy&&delete this.$_do}$act(t,e){const r=this.$send("event:action",{fn:t,args:e},!0);if(this.$send("event:commit",r,!0),r.hasError)throw r.thrownError}get $do(){return this.$_do||(this.$_do=mi(this)),this.$_do}$_configActions(t){if(!oi(t))return;const{actions:e}=t;oi(e)&&Object.keys(e).forEach(t=>{this.$addAction(t,e[t])})}$mutate(t){if(!ui(t))throw new Error("$mutate expects function");this.next(t(this.value,this))}},wi=t=>class extends t{constructor(t,e,...r){super(t,e,...r),this.$_configProps(e),this.$_hasSelectors&&this.next(this.$_withSelectors(this.value))}$_configProps(t){if(!oi(t))return;const{fixed:e,selectors:r}=t;this.$isFixed=!!e,r&&vi(r).forEach((t,e)=>{ui(t)&&ci(e,!0)&&this.$addSelector(e,t)})}get $type(){return si(this.getValue())}$set(t,e){const r=this.$keyFor(t);let n=this.value;switch(this.$type){case Wo:n=ue(n,t=>{t[r]=e});break;case Ko:n=ue(n,t=>{t.set(r,e)});break;case Go:n=ue(n,t=>{t[r]=e});break;default:throw new Error("$set is not appropriate for this type of target")}this.next(n)}$keyFor(t){const e=(""+t).toLowerCase();let r=t;switch(this.$type){case Wo:r=t in this.value?t:Array.from(Object.keys(this.value)).reduce((t,r)=>(""+r).toLowerCase()===e?r:t,t);break;case Ko:r=this.value.has(t)?t:Array.from(this.value.keys()).reduce((t,r)=>(""+r).toLowerCase()===e?r:t,t);break;case Go:throw li(t)&&(r=t),new Error("bad key for array")}return r}$addSelector(t,e){this.$_selectors.set(t,e)}get $_selectors(){return this.$__selectors||(this.$__selectors=new Map),this.$__selectors}get $_hasSelectors(){return this.$__selectors&&this.$__selectors.size>0}$_withSelectors(t){if(!this.$_hasSelectors)return t;const e=this,r=si(t),n=ue(t,n=>{e.$_selectors.forEach((o,i)=>{try{const a=o(t,e,i);switch(r){case Ko:n.set(i,a);break;case Wo:n[i]=a;break;case Go:n[i]=a}}catch(t){console.warn("cannot compute ",i,":",t)}})});return console.log("with selector: ",n),n}},ji=t=>class extends t{constructor(t,e,...r){super(t,e,...r),e&&this.$_configChildren(e),this.$on("next",(t,e,r)=>{if(!r.$_hasChildren)return;const n=si(t);r.$children.forEach((o,i)=>{if(!e.hasError)if(fi(t,i,n)){const a=hi(t,i,n);if(r.$note("sending child value:",{key:i,childValue:a}),o.value===a||Fn(o.value,a))return;const u=o.$send("next",a,!0);u.hasError&&(e.error({error:u.thrownError,target:i}),o.$send("event:removeFrom",u.$order))}else r.$note("not updating child ",{key:i})})})}get $root(){return this.$parent?this.$parent.$root:this}get $children(){return this.$_children||(this.$_children=new Map),this.$_children}get $_hasChildren(){return!!this.$_children&&this.$children.size}$addChild(t,e){e.$parent=this,e.$name=t;const r=this;this.$children.set(t,e),e.subscribe({next(e){if(r.$lastChange){hi(r.$lastChange.value,t)!==e&&(r.$lastChange._value=ue(r.$lastChange.value,r=>{pi(r,t,e)}))}else{hi(r.value,t)!==e&&r.next(ue(r.value,r=>{pi(r,t,e)}))}}})}$_withChildValues(t=Xo){t===Xo&&(t=this._value);const e=si(t);return this.$_hasChildren&&this.$children.forEach((r,n)=>{const o=r.value;hi(t,n,e)!==o&&(t=ue(t,t=>{pi(t,n,o,e)}))}),t}$_configChildren(t){if(!oi(t))return;const{children:e}=t;if(e)switch(si(e)){case Wo:Object.keys(e).forEach(t=>{const r=e[t];this.$addChild(t,r)});break;case Ko:e.forEach((t,e)=>{this.$addChild(e,t)});break;default:console.warn("strange child type ",e)}}};class Ei extends(ji(wi($i(gi(F))))){constructor(t,e){super(di(t),e),this.$_config(e)}$_config(t){if(!oi(t))return;const{test:e,name:r,debug:n=!1}=t;ui(e)&&this.$addTest(e),this.$name=ci(r,!0)?r:ft(),this.$_debug=n}get $debug(){return!!this.$_debug||!!this.$parent&&this.$parent.$debug}$note(t,e=null){this.$debug&&(this.$debug>1&&console.log("target: ",this.$name,t,e),this.$send("debug",{msg:t,target:this.$name,value:e}))}next(t){const e=this.$send("next",t);if(e.isStopped||(this.$_hasChildren&&this.$_hasChildren&&(e._value=this.$_withChildValues(t)),this.$_hasSelectors&&(e._value=this.$_withSelectors(e.value)),this.$root.$send("event:validate",e)),e.isStopped||e.complete(),this.$send("event:commit",e,!0),e.hasError)throw e.thrownError}$addTest(t){return this.$on("event:validate",(e,r,n)=>{if(!e.isStopped){const r=n.getValue();let o=null;try{o=t(r,n)}catch(t){o=t}o&&(n.$note("error -- to event",{err:o,target:n.$name}),e.error({target:n.$name,error:o}))}})}$next(t){super.next(t)}getValue(){return this.$lastChange?this.$_withChildValues(this.$lastChange.value):super.getValue()}}return Object.assign(Ei.prototype,gi),{...ti,...lt,idGen:lt,utils:yi,Mirror:Ei}}));
